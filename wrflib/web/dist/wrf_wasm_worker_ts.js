/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["wrf"] = factory();
	else
		root["wrf"] = factory();
})(self, function() {
return /******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./cursor_map.ts":
/*!***********************!*\
  !*** ./cursor_map.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"cursorMap\": () => (/* binding */ cursorMap)\n/* harmony export */ });\n// Copyright (c) 2021-present, Cruise LLC\n//\n// This source code is licensed under the Apache License, Version 2.0,\n// found in the LICENSE-APACHE file in the root directory of this source tree.\n// You may not use this file except in compliance with the License.\n// Be sure to keep this in sync with cursor.rs!\nconst cursorMap = [\n    \"none\",\n    \"default\",\n    \"crosshair\",\n    \"pointer\",\n    \"default\",\n    \"move\",\n    \"text\",\n    \"wait\",\n    \"help\",\n    \"not-allowed\",\n    \"n-resize\",\n    \"ne-resize\",\n    \"e-resize\",\n    \"se-resize\",\n    \"s-resize\",\n    \"sw-resize\",\n    \"w-resize\",\n    \"nw-resize\",\n    \"ns-resize\",\n    \"nesw-resize\",\n    \"ew-resize\",\n    \"nwse-resize\",\n    \"col-resize\",\n    \"row-resize\", // RowResize=>23,\n];\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9jdXJzb3JfbWFwLnRzLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd3JmLy4vY3Vyc29yX21hcC50cz85YjhmIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAyMS1wcmVzZW50LCBDcnVpc2UgTExDXG4vL1xuLy8gVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLFxuLy8gZm91bmQgaW4gdGhlIExJQ0VOU0UtQVBBQ0hFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4vLyBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBCZSBzdXJlIHRvIGtlZXAgdGhpcyBpbiBzeW5jIHdpdGggY3Vyc29yLnJzIVxuZXhwb3J0IGNvbnN0IGN1cnNvck1hcCA9IFtcbiAgICBcIm5vbmVcIixcbiAgICBcImRlZmF1bHRcIixcbiAgICBcImNyb3NzaGFpclwiLFxuICAgIFwicG9pbnRlclwiLFxuICAgIFwiZGVmYXVsdFwiLFxuICAgIFwibW92ZVwiLFxuICAgIFwidGV4dFwiLFxuICAgIFwid2FpdFwiLFxuICAgIFwiaGVscFwiLFxuICAgIFwibm90LWFsbG93ZWRcIixcbiAgICBcIm4tcmVzaXplXCIsXG4gICAgXCJuZS1yZXNpemVcIixcbiAgICBcImUtcmVzaXplXCIsXG4gICAgXCJzZS1yZXNpemVcIixcbiAgICBcInMtcmVzaXplXCIsXG4gICAgXCJzdy1yZXNpemVcIixcbiAgICBcInctcmVzaXplXCIsXG4gICAgXCJudy1yZXNpemVcIixcbiAgICBcIm5zLXJlc2l6ZVwiLFxuICAgIFwibmVzdy1yZXNpemVcIixcbiAgICBcImV3LXJlc2l6ZVwiLFxuICAgIFwibndzZS1yZXNpemVcIixcbiAgICBcImNvbC1yZXNpemVcIixcbiAgICBcInJvdy1yZXNpemVcIiwgLy8gUm93UmVzaXplPT4yMyxcbl07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./cursor_map.ts\n");

/***/ }),

/***/ "./webgl_renderer.ts":
/*!***************************!*\
  !*** ./webgl_renderer.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"WebGLRenderer\": () => (/* binding */ WebGLRenderer)\n/* harmony export */ });\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./common */ \"./common.ts\");\n/* harmony import */ var _zerde__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./zerde */ \"./zerde.ts\");\n\n\nclass WebGLRenderer {\n    constructor(canvas, memory, sizingData, incompatibleBrowserCallback) {\n        this.uniformFnTable = {\n            float: function setFloat(self, loc, off) {\n                const slot = off >> 2;\n                self.gl.uniform1f(loc, self.basef32[slot]);\n            },\n            vec2: function setVec2(self, loc, off) {\n                const slot = off >> 2;\n                const basef32 = self.basef32;\n                self.gl.uniform2f(loc, basef32[slot], basef32[slot + 1]);\n            },\n            vec3: function setVec3(self, loc, off) {\n                const slot = off >> 2;\n                const basef32 = self.basef32;\n                self.gl.uniform3f(loc, basef32[slot], basef32[slot + 1], basef32[slot + 2]);\n            },\n            vec4: function setVec4(self, loc, off) {\n                const slot = off >> 2;\n                const basef32 = self.basef32;\n                self.gl.uniform4f(loc, basef32[slot], basef32[slot + 1], basef32[slot + 2], basef32[slot + 3]);\n            },\n            mat2: function setMat2(self, loc, off) {\n                self.gl.uniformMatrix2fv(loc, false, new Float32Array(self.memory.buffer, off, 4));\n            },\n            mat3: function setMat3(self, loc, off) {\n                self.gl.uniformMatrix3fv(loc, false, new Float32Array(self.memory.buffer, off, 9));\n            },\n            mat4: function setMat4(self, loc, off) {\n                const mat4 = new Float32Array(self.memory.buffer, off, 16);\n                self.gl.uniformMatrix4fv(loc, false, mat4);\n            },\n        };\n        // Array of function id's wasm can call on us; `self` is pointer to WebGLRenderer.\n        // Function names are suffixed with the index in the array, and annotated with\n        // their name in cx_webgl.rs, for easier matching.\n        this.sendFnTable = [\n            // end\n            function end0(_self) {\n                return true;\n            },\n            // compile_webgl_shader\n            function compileWebGLShader1(self) {\n                function parseShvarvec() {\n                    const len = self.zerdeParser.parseU32();\n                    const vars = [];\n                    for (let i = 0; i < len; i++) {\n                        vars.push({\n                            ty: self.zerdeParser.parseString(),\n                            name: self.zerdeParser.parseString(),\n                        });\n                    }\n                    return vars;\n                }\n                const ash = {\n                    shaderId: self.zerdeParser.parseU32(),\n                    fragment: self.zerdeParser.parseString(),\n                    vertex: self.zerdeParser.parseString(),\n                    geometrySlots: self.zerdeParser.parseU32(),\n                    instanceSlots: self.zerdeParser.parseU32(),\n                    passUniforms: parseShvarvec(),\n                    viewUniforms: parseShvarvec(),\n                    drawUniforms: parseShvarvec(),\n                    userUniforms: parseShvarvec(),\n                    textureSlots: parseShvarvec(),\n                };\n                self.compileWebGLShader(ash);\n            },\n            // alloc_array_buffer\n            function allocArrayBuffer2(self) {\n                const arrayBufferId = self.zerdeParser.parseU32();\n                const len = self.zerdeParser.parseU32();\n                const pointer = self.zerdeParser.parseU32();\n                const array = new Float32Array(self.memory.buffer, pointer, len);\n                self.allocArrayBuffer(arrayBufferId, array);\n            },\n            // alloc_index_buffer\n            function allocIndexBuffer3(self) {\n                const indexBufferId = self.zerdeParser.parseU32();\n                const len = self.zerdeParser.parseU32();\n                const pointer = self.zerdeParser.parseU32();\n                const array = new Uint32Array(self.memory.buffer, pointer, len);\n                self.allocIndexBuffer(indexBufferId, array);\n            },\n            // alloc_vao\n            function allocVao4(self) {\n                const vaoId = self.zerdeParser.parseU32();\n                const shaderId = self.zerdeParser.parseU32();\n                const geomIbId = self.zerdeParser.parseU32();\n                const geomVbId = self.zerdeParser.parseU32();\n                const instVbId = self.zerdeParser.parseU32();\n                self.allocVao(vaoId, shaderId, geomIbId, geomVbId, instVbId);\n            },\n            // draw_call\n            function drawCall5(self) {\n                const shaderId = self.zerdeParser.parseU32();\n                const vaoId = self.zerdeParser.parseU32();\n                const uniformsPassPtr = self.zerdeParser.parseU32();\n                const uniformsViewPtr = self.zerdeParser.parseU32();\n                const uniformsDrawPtr = self.zerdeParser.parseU32();\n                const uniformsUserPtr = self.zerdeParser.parseU32();\n                const textures = self.zerdeParser.parseU32();\n                self.drawCall(shaderId, vaoId, uniformsPassPtr, uniformsViewPtr, uniformsDrawPtr, uniformsUserPtr, textures);\n            },\n            // update_texture_image2d\n            function allocTexture6(self) {\n                const textureId = self.zerdeParser.parseU32();\n                const width = self.zerdeParser.parseU32();\n                const height = self.zerdeParser.parseU32();\n                const dataPtr = self.zerdeParser.parseU32();\n                self.allocTexture(textureId, width, height, dataPtr);\n            },\n            // begin_render_targets\n            function beginRenderTargets7(self) {\n                const passId = self.zerdeParser.parseU32();\n                const width = self.zerdeParser.parseU32();\n                const height = self.zerdeParser.parseU32();\n                self.beginRenderTargets(passId, width, height);\n            },\n            // add_color_target\n            function addColorTarget8(self) {\n                const textureId = self.zerdeParser.parseU32();\n                const initOnly = self.zerdeParser.parseU32();\n                const r = self.zerdeParser.parseF32();\n                const g = self.zerdeParser.parseF32();\n                const b = self.zerdeParser.parseF32();\n                const a = self.zerdeParser.parseF32();\n                self.addColorTarget(textureId, initOnly, r, g, b, a);\n            },\n            // set_depth_target\n            function setDepthTarget9(self) {\n                const textureId = self.zerdeParser.parseU32();\n                const initOnly = self.zerdeParser.parseU32();\n                const depth = self.zerdeParser.parseF32();\n                self.setDepthTarget(textureId, initOnly, depth);\n            },\n            // end_render_targets\n            function endRenderTargets10(self) {\n                self.endRenderTargets();\n            },\n            // set_default_depth_and_blend_mode\n            function setDefaultDepthAndBlendMode11(self) {\n                self.setDefaultDepthAndBlendMode();\n            },\n            // begin_main_canvas\n            function beginMainCanvas12(self) {\n                const r = self.zerdeParser.parseF32();\n                const g = self.zerdeParser.parseF32();\n                const b = self.zerdeParser.parseF32();\n                const a = self.zerdeParser.parseF32();\n                const depth = self.zerdeParser.parseF32();\n                self.beginMainCanvas(r, g, b, a, depth);\n            },\n        ];\n        this.canvas = canvas;\n        this.memory = memory;\n        this.sizingData = sizingData;\n        this.shaders = [];\n        this.indexBuffers = [];\n        this.arrayBuffers = [];\n        this.vaos = [];\n        this.textures = [];\n        this.framebuffers = [];\n        this.targetWidth = 0;\n        this.targetHeight = 0;\n        this.clearFlags = 0;\n        this.clearR = 0;\n        this.clearG = 0;\n        this.clearB = 0;\n        this.clearA = 0;\n        this.clearDepth = 0;\n        // this.isMainCanvas = false;\n        const options = {\n            preferLowPowerToHighPerformance: true,\n            // xrCompatible: true // TODO(JP): Bring back some day?\n        };\n        // @ts-ignore - TODO(Paras): Get proper support for OffscreenCanvas\n        this.gl =\n            // @ts-ignore\n            canvas.getContext(\"webgl\", options) ||\n                // @ts-ignore\n                canvas.getContext(\"webgl-experimental\", options) ||\n                // @ts-ignore\n                canvas.getContext(\"experimental-webgl\", options);\n        if (!this.gl) {\n            incompatibleBrowserCallback();\n            return;\n        }\n        this.OESVertexArrayObject = (0,_common__WEBPACK_IMPORTED_MODULE_0__.assertNotNull)(this.gl.getExtension(\"OES_vertex_array_object\"));\n        this.ANGLEInstancedArrays = (0,_common__WEBPACK_IMPORTED_MODULE_0__.assertNotNull)(this.gl.getExtension(\"ANGLE_instanced_arrays\"));\n        this.gl.getExtension(\"OES_standard_derivatives\");\n        this.gl.getExtension(\"OES_element_index_uint\");\n        this.resize(sizingData);\n    }\n    processMessages(zerdeParserPtr) {\n        this.zerdeParser = new _zerde__WEBPACK_IMPORTED_MODULE_1__.ZerdeParser(this.memory, zerdeParserPtr);\n        this.basef32 = new Float32Array(this.memory.buffer);\n        this.baseu32 = new Uint32Array(this.memory.buffer);\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            const msgType = this.zerdeParser.parseU32();\n            if (this.sendFnTable[msgType](this)) {\n                break;\n            }\n        }\n    }\n    resize(sizingData) {\n        this.sizingData = sizingData;\n        this.canvas.width = sizingData.width * sizingData.dpiFactor;\n        this.canvas.height = sizingData.height * sizingData.dpiFactor;\n    }\n    getAttribLocations(program, base, slots) {\n        const gl = this.gl;\n        const attribLocs = [];\n        let attribs = slots >> 2;\n        if ((slots & 3) != 0)\n            attribs++;\n        for (let i = 0; i < attribs; i++) {\n            let size = slots - i * 4;\n            if (size > 4)\n                size = 4;\n            attribLocs.push({\n                loc: gl.getAttribLocation(program, base + i),\n                offset: i * 16,\n                size: size,\n                stride: slots * 4,\n            });\n        }\n        return attribLocs;\n    }\n    getUniformLocations(program, uniforms) {\n        const gl = this.gl;\n        const uniformLocs = [];\n        let offset = 0;\n        for (let i = 0; i < uniforms.length; i++) {\n            const uniform = uniforms[i];\n            // lets align the uniform\n            const slots = uniformSizeTable[uniform.ty];\n            if ((offset & 3) != 0 && (offset & 3) + slots > 4) {\n                // goes over the boundary\n                offset += 4 - (offset & 3); // make jump to new slot\n            }\n            uniformLocs.push({\n                name: uniform.name,\n                offset: offset << 2,\n                ty: uniform.ty,\n                loc: gl.getUniformLocation(program, uniform.name),\n                fn: this.uniformFnTable[uniform.ty],\n            });\n            offset += slots;\n        }\n        return uniformLocs;\n    }\n    compileWebGLShader(ash) {\n        const gl = this.gl;\n        const vsh = (0,_common__WEBPACK_IMPORTED_MODULE_0__.assertNotNull)(gl.createShader(gl.VERTEX_SHADER));\n        gl.shaderSource(vsh, ash.vertex);\n        gl.compileShader(vsh);\n        if (!gl.getShaderParameter(vsh, gl.COMPILE_STATUS)) {\n            console.log(gl.getShaderInfoLog(vsh), addLineNumbersToString(ash.vertex));\n        }\n        // compile pixelshader\n        const fsh = (0,_common__WEBPACK_IMPORTED_MODULE_0__.assertNotNull)(gl.createShader(gl.FRAGMENT_SHADER));\n        gl.shaderSource(fsh, ash.fragment);\n        gl.compileShader(fsh);\n        if (!gl.getShaderParameter(fsh, gl.COMPILE_STATUS)) {\n            console.log(gl.getShaderInfoLog(fsh), addLineNumbersToString(ash.fragment));\n        }\n        const program = (0,_common__WEBPACK_IMPORTED_MODULE_0__.assertNotNull)(gl.createProgram());\n        gl.attachShader(program, vsh);\n        gl.attachShader(program, fsh);\n        gl.linkProgram(program);\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            console.log(gl.getProgramInfoLog(program), addLineNumbersToString(ash.vertex), addLineNumbersToString(ash.fragment));\n        }\n        // fetch all attribs and uniforms\n        this.shaders[ash.shaderId] = {\n            geomAttribs: this.getAttribLocations(program, \"mpsc_packed_geometry_\", ash.geometrySlots),\n            instAttribs: this.getAttribLocations(program, \"mpsc_packed_instance_\", ash.instanceSlots),\n            passUniforms: this.getUniformLocations(program, ash.passUniforms),\n            viewUniforms: this.getUniformLocations(program, ash.viewUniforms),\n            drawUniforms: this.getUniformLocations(program, ash.drawUniforms),\n            userUniforms: this.getUniformLocations(program, ash.userUniforms),\n            textureSlots: this.getUniformLocations(program, ash.textureSlots),\n            instanceSlots: ash.instanceSlots,\n            program: program,\n            ash: ash,\n        };\n    }\n    allocArrayBuffer(arrayBufferId, array) {\n        const gl = this.gl;\n        let buf = this.arrayBuffers[arrayBufferId];\n        if (buf === undefined) {\n            buf = this.arrayBuffers[arrayBufferId] = {\n                glBuf: (0,_common__WEBPACK_IMPORTED_MODULE_0__.assertNotNull)(gl.createBuffer()),\n                length: array.length,\n            };\n        }\n        else {\n            buf.length = array.length;\n        }\n        gl.bindBuffer(gl.ARRAY_BUFFER, buf.glBuf);\n        gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    }\n    allocIndexBuffer(indexBufferId, array) {\n        const gl = this.gl;\n        let buf = this.indexBuffers[indexBufferId];\n        if (buf === undefined) {\n            buf = this.indexBuffers[indexBufferId] = {\n                glBuf: (0,_common__WEBPACK_IMPORTED_MODULE_0__.assertNotNull)(gl.createBuffer()),\n                length: array.length,\n            };\n        }\n        else {\n            buf.length = array.length;\n        }\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buf.glBuf);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, array, gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    }\n    allocVao(vaoId, shaderId, geomIbId, geomVbId, instVbId) {\n        const gl = this.gl;\n        const oldVao = this.vaos[vaoId];\n        if (oldVao) {\n            this.OESVertexArrayObject.deleteVertexArrayOES(oldVao.glVao);\n        }\n        const glVao = (0,_common__WEBPACK_IMPORTED_MODULE_0__.assertNotNull)(this.OESVertexArrayObject.createVertexArrayOES());\n        const vao = (this.vaos[vaoId] = { glVao, geomIbId, geomVbId, instVbId });\n        this.OESVertexArrayObject.bindVertexArrayOES(vao.glVao);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.arrayBuffers[geomVbId].glBuf);\n        const shader = this.shaders[shaderId];\n        for (let i = 0; i < shader.geomAttribs.length; i++) {\n            const attr = shader.geomAttribs[i];\n            if (attr.loc < 0) {\n                continue;\n            }\n            gl.vertexAttribPointer(attr.loc, attr.size, gl.FLOAT, false, attr.stride, attr.offset);\n            gl.enableVertexAttribArray(attr.loc);\n            this.ANGLEInstancedArrays.vertexAttribDivisorANGLE(attr.loc, 0);\n        }\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.arrayBuffers[instVbId].glBuf);\n        for (let i = 0; i < shader.instAttribs.length; i++) {\n            const attr = shader.instAttribs[i];\n            if (attr.loc < 0) {\n                continue;\n            }\n            gl.vertexAttribPointer(attr.loc, attr.size, gl.FLOAT, false, attr.stride, attr.offset);\n            gl.enableVertexAttribArray(attr.loc);\n            this.ANGLEInstancedArrays.vertexAttribDivisorANGLE(attr.loc, 1);\n        }\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffers[geomIbId].glBuf);\n        this.OESVertexArrayObject.bindVertexArrayOES(null);\n    }\n    drawCall(shaderId, vaoId, passUniformsPtr, viewUniformsPtr, drawUniformsPtr, userUniformsPtr, texturesPtr) {\n        const gl = this.gl;\n        const shader = this.shaders[shaderId];\n        gl.useProgram(shader.program);\n        const vao = this.vaos[vaoId];\n        this.OESVertexArrayObject.bindVertexArrayOES(vao.glVao);\n        const indexBuffer = this.indexBuffers[vao.geomIbId];\n        const instanceBuffer = this.arrayBuffers[vao.instVbId];\n        // set up uniforms TODO do this a bit more incremental based on uniform layer\n        // also possibly use webGL2 uniform buffers. For now this will suffice for webGL 1 compat\n        const passUniforms = shader.passUniforms;\n        // if vr_presenting\n        const viewUniforms = shader.viewUniforms;\n        for (let i = 0; i < viewUniforms.length; i++) {\n            const uni = viewUniforms[i];\n            uni.fn(this, uni.loc, uni.offset + viewUniformsPtr);\n        }\n        const drawUniforms = shader.drawUniforms;\n        for (let i = 0; i < drawUniforms.length; i++) {\n            const uni = drawUniforms[i];\n            uni.fn(this, uni.loc, uni.offset + drawUniformsPtr);\n        }\n        const userUniforms = shader.userUniforms;\n        for (let i = 0; i < userUniforms.length; i++) {\n            const uni = userUniforms[i];\n            uni.fn(this, uni.loc, uni.offset + userUniformsPtr);\n        }\n        const textureSlots = shader.textureSlots;\n        for (let i = 0; i < textureSlots.length; i++) {\n            const texSlot = textureSlots[i];\n            const texId = this.baseu32[(texturesPtr >> 2) + i];\n            const texObj = this.textures[texId];\n            gl.activeTexture(gl.TEXTURE0 + i);\n            gl.bindTexture(gl.TEXTURE_2D, texObj);\n            gl.uniform1i(texSlot.loc, i);\n        }\n        const indices = indexBuffer.length;\n        const instances = instanceBuffer.length / shader.instanceSlots;\n        // if (this.isMainCanvas && xrIsPresenting) {\n        // for (let i = 3; i < pass_uniforms.length; i ++) {\n        //     let uni = pass_uniforms[i];\n        //     uni.fn(this, uni.loc, uni.offset + pass_uniforms_ptr);\n        // }\n        // // the first 2 matrices are project and view\n        // let left_viewport = this.xr_left_viewport;\n        // gl.viewport(left_viewport.x, left_viewport.y, left_viewport.width, left_viewport.height);\n        // gl.uniformMatrix4fv(pass_uniforms[0].loc, false, this.xr_left_projection_matrix);\n        // gl.uniformMatrix4fv(pass_uniforms[1].loc, false, this.xr_left_transform_matrix);\n        // gl.uniformMatrix4fv(pass_uniforms[2].loc, false, this.xr_left_invtransform_matrix);\n        // this.ANGLE_instanced_arrays.drawElementsInstancedANGLE(gl.TRIANGLES, indices, gl.UNSIGNED_INT, 0, instances);\n        // let right_viewport = this.xr_right_viewport;\n        // gl.viewport(right_viewport.x, right_viewport.y, right_viewport.width, right_viewport.height);\n        // gl.uniformMatrix4fv(pass_uniforms[0].loc, false, this.xr_right_projection_matrix);\n        // gl.uniformMatrix4fv(pass_uniforms[1].loc, false, this.xr_right_transform_matrix);\n        // gl.uniformMatrix4fv(pass_uniforms[2].loc, false, this.xr_right_invtransform_matrix);\n        // this.ANGLE_instanced_arrays.drawElementsInstancedANGLE(gl.TRIANGLES, indices, gl.UNSIGNED_INT, 0, instances);\n        // } else {\n        for (let i = 0; i < passUniforms.length; i++) {\n            const uni = passUniforms[i];\n            uni.fn(this, uni.loc, uni.offset + passUniformsPtr);\n        }\n        this.ANGLEInstancedArrays.drawElementsInstancedANGLE(gl.TRIANGLES, indices, gl.UNSIGNED_INT, 0, instances);\n        // }\n        this.OESVertexArrayObject.bindVertexArrayOES(null);\n    }\n    allocTexture(textureId, width, height, dataPtr) {\n        const gl = this.gl;\n        const glTex = this.textures[textureId] || gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, glTex);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        const data = new Uint8Array(this.memory.buffer, dataPtr, width * height * 4);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\n        this.textures[textureId] = glTex;\n    }\n    beginRenderTargets(passId, width, height) {\n        const gl = this.gl;\n        this.targetWidth = width;\n        this.targetHeight = height;\n        this.clearFlags = 0;\n        // this.isMainCanvas = false;\n        const glFramebuffer = this.framebuffers[passId] ||\n            (this.framebuffers[passId] = (0,_common__WEBPACK_IMPORTED_MODULE_0__.assertNotNull)(gl.createFramebuffer()));\n        gl.bindFramebuffer(gl.FRAMEBUFFER, glFramebuffer);\n    }\n    addColorTarget(textureId, initOnly, r, g, b, a) {\n        // if use_default\n        this.clearR = r;\n        this.clearG = g;\n        this.clearB = b;\n        this.clearA = a;\n        const gl = this.gl;\n        const glTex = this.textures[textureId] ||\n            (this.textures[textureId] = gl.createTexture());\n        // resize or create texture\n        if (glTex.mpWidth != this.targetWidth ||\n            glTex.mpHeight != this.targetHeight) {\n            gl.bindTexture(gl.TEXTURE_2D, glTex);\n            this.clearFlags |= gl.COLOR_BUFFER_BIT;\n            glTex.mpWidth = this.targetWidth;\n            glTex.mpHeight = this.targetHeight;\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, glTex.mpWidth, glTex.mpHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        }\n        else if (!initOnly) {\n            this.clearFlags |= gl.COLOR_BUFFER_BIT;\n        }\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, glTex, 0);\n    }\n    setDepthTarget(textureId, initOnly, depth) {\n        const gl = this.gl;\n        this.clearDepth = depth;\n        const glRenderBuffer = this.textures[textureId] ||\n            (this.textures[textureId] = gl.createRenderbuffer());\n        if (glRenderBuffer.mpWidth != this.targetWidth ||\n            glRenderBuffer.mpHeight != this.targetHeight) {\n            // Borrowed concept from https://webglfundamentals.org/webgl/lessons/webgl-render-to-texture.html\n            gl.bindRenderbuffer(gl.RENDERBUFFER, glRenderBuffer);\n            this.clearFlags |= gl.DEPTH_BUFFER_BIT;\n            glRenderBuffer.mpWidth = this.targetWidth;\n            glRenderBuffer.mpHeight = this.targetHeight;\n            gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.targetWidth, this.targetHeight);\n        }\n        else if (!initOnly) {\n            this.clearFlags |= gl.DEPTH_BUFFER_BIT;\n        }\n        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, glRenderBuffer);\n    }\n    endRenderTargets() {\n        const gl = this.gl;\n        // process the actual 'clear'\n        gl.viewport(0, 0, this.targetWidth, this.targetHeight);\n        // check if we need to clear color, and depth\n        // clear it\n        if (this.clearFlags) {\n            gl.clearColor(this.clearR, this.clearG, this.clearB, this.clearA);\n            gl.clearDepth(this.clearDepth);\n            gl.clear(this.clearFlags);\n        }\n    }\n    setDefaultDepthAndBlendMode() {\n        const gl = this.gl;\n        gl.enable(gl.DEPTH_TEST);\n        gl.depthFunc(gl.LEQUAL);\n        gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n        gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n        gl.enable(gl.BLEND);\n    }\n    beginMainCanvas(r, g, b, a, depth) {\n        const gl = this.gl;\n        // this.isMainCanvas = true;\n        // if (this.xrIsPresenting) {\n        // let xr_webgllayer = this.xr_session.renderState.baseLayer;\n        // this.gl.bindFramebuffer(gl.FRAMEBUFFER, xr_webgllayer.framebuffer);\n        // gl.viewport(0, 0, xr_webgllayer.framebufferWidth, xr_webgllayer.framebufferHeight);\n        // // quest 1 is 3648\n        // // quest 2 is 4096\n        // let left_view = this.xr_pose.views[0];\n        // let right_view = this.xr_pose.views[1];\n        // this.xr_left_viewport = xr_webgllayer.getViewport(left_view);\n        // this.xr_right_viewport = xr_webgllayer.getViewport(right_view);\n        // this.xr_left_projection_matrix = left_view.projectionMatrix;\n        // this.xr_left_transform_matrix = left_view.transform.inverse.matrix;\n        // this.xr_left_invtransform_matrix = left_view.transform.matrix;\n        // this.xr_right_projection_matrix = right_view.projectionMatrix;\n        // this.xr_right_transform_matrix = right_view.transform.inverse.matrix;\n        // this.xr_right_camera_pos = right_view.transform.inverse.position;\n        // this.xr_right_invtransform_matrix = right_view.transform.matrix;\n        // } else {\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.viewport(0, 0, this.sizingData.width * this.sizingData.dpiFactor, this.sizingData.height * this.sizingData.dpiFactor);\n        // }\n        gl.clearColor(r, g, b, a);\n        gl.clearDepth(depth);\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    }\n}\nconst uniformSizeTable = {\n    float: 1,\n    vec2: 2,\n    vec3: 3,\n    vec4: 4,\n    mat2: 4,\n    mat3: 9,\n    mat4: 16,\n};\nfunction addLineNumbersToString(code) {\n    const lines = code.split(\"\\n\");\n    let out = \"\";\n    for (let i = 0; i < lines.length; i++) {\n        out += i + 1 + \": \" + lines[i] + \"\\n\";\n    }\n    return out;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi93ZWJnbF9yZW5kZXJlci50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93cmYvLi93ZWJnbF9yZW5kZXJlci50cz83MzY2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFzc2VydE5vdE51bGwgfSBmcm9tIFwiLi9jb21tb25cIjtcbmltcG9ydCB7IFplcmRlUGFyc2VyIH0gZnJvbSBcIi4vemVyZGVcIjtcbmV4cG9ydCBjbGFzcyBXZWJHTFJlbmRlcmVyIHtcbiAgICBjb25zdHJ1Y3RvcihjYW52YXMsIG1lbW9yeSwgc2l6aW5nRGF0YSwgaW5jb21wYXRpYmxlQnJvd3NlckNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMudW5pZm9ybUZuVGFibGUgPSB7XG4gICAgICAgICAgICBmbG9hdDogZnVuY3Rpb24gc2V0RmxvYXQoc2VsZiwgbG9jLCBvZmYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzbG90ID0gb2ZmID4+IDI7XG4gICAgICAgICAgICAgICAgc2VsZi5nbC51bmlmb3JtMWYobG9jLCBzZWxmLmJhc2VmMzJbc2xvdF0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZlYzI6IGZ1bmN0aW9uIHNldFZlYzIoc2VsZiwgbG9jLCBvZmYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzbG90ID0gb2ZmID4+IDI7XG4gICAgICAgICAgICAgICAgY29uc3QgYmFzZWYzMiA9IHNlbGYuYmFzZWYzMjtcbiAgICAgICAgICAgICAgICBzZWxmLmdsLnVuaWZvcm0yZihsb2MsIGJhc2VmMzJbc2xvdF0sIGJhc2VmMzJbc2xvdCArIDFdKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2ZWMzOiBmdW5jdGlvbiBzZXRWZWMzKHNlbGYsIGxvYywgb2ZmKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2xvdCA9IG9mZiA+PiAyO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VmMzIgPSBzZWxmLmJhc2VmMzI7XG4gICAgICAgICAgICAgICAgc2VsZi5nbC51bmlmb3JtM2YobG9jLCBiYXNlZjMyW3Nsb3RdLCBiYXNlZjMyW3Nsb3QgKyAxXSwgYmFzZWYzMltzbG90ICsgMl0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZlYzQ6IGZ1bmN0aW9uIHNldFZlYzQoc2VsZiwgbG9jLCBvZmYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzbG90ID0gb2ZmID4+IDI7XG4gICAgICAgICAgICAgICAgY29uc3QgYmFzZWYzMiA9IHNlbGYuYmFzZWYzMjtcbiAgICAgICAgICAgICAgICBzZWxmLmdsLnVuaWZvcm00Zihsb2MsIGJhc2VmMzJbc2xvdF0sIGJhc2VmMzJbc2xvdCArIDFdLCBiYXNlZjMyW3Nsb3QgKyAyXSwgYmFzZWYzMltzbG90ICsgM10pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1hdDI6IGZ1bmN0aW9uIHNldE1hdDIoc2VsZiwgbG9jLCBvZmYpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmdsLnVuaWZvcm1NYXRyaXgyZnYobG9jLCBmYWxzZSwgbmV3IEZsb2F0MzJBcnJheShzZWxmLm1lbW9yeS5idWZmZXIsIG9mZiwgNCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1hdDM6IGZ1bmN0aW9uIHNldE1hdDMoc2VsZiwgbG9jLCBvZmYpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmdsLnVuaWZvcm1NYXRyaXgzZnYobG9jLCBmYWxzZSwgbmV3IEZsb2F0MzJBcnJheShzZWxmLm1lbW9yeS5idWZmZXIsIG9mZiwgOSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1hdDQ6IGZ1bmN0aW9uIHNldE1hdDQoc2VsZiwgbG9jLCBvZmYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXQ0ID0gbmV3IEZsb2F0MzJBcnJheShzZWxmLm1lbW9yeS5idWZmZXIsIG9mZiwgMTYpO1xuICAgICAgICAgICAgICAgIHNlbGYuZ2wudW5pZm9ybU1hdHJpeDRmdihsb2MsIGZhbHNlLCBtYXQ0KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIC8vIEFycmF5IG9mIGZ1bmN0aW9uIGlkJ3Mgd2FzbSBjYW4gY2FsbCBvbiB1czsgYHNlbGZgIGlzIHBvaW50ZXIgdG8gV2ViR0xSZW5kZXJlci5cbiAgICAgICAgLy8gRnVuY3Rpb24gbmFtZXMgYXJlIHN1ZmZpeGVkIHdpdGggdGhlIGluZGV4IGluIHRoZSBhcnJheSwgYW5kIGFubm90YXRlZCB3aXRoXG4gICAgICAgIC8vIHRoZWlyIG5hbWUgaW4gY3hfd2ViZ2wucnMsIGZvciBlYXNpZXIgbWF0Y2hpbmcuXG4gICAgICAgIHRoaXMuc2VuZEZuVGFibGUgPSBbXG4gICAgICAgICAgICAvLyBlbmRcbiAgICAgICAgICAgIGZ1bmN0aW9uIGVuZDAoX3NlbGYpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBjb21waWxlX3dlYmdsX3NoYWRlclxuICAgICAgICAgICAgZnVuY3Rpb24gY29tcGlsZVdlYkdMU2hhZGVyMShzZWxmKSB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VTaHZhcnZlYygpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVuID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVUzMigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJzID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHk6IHNlbGYuemVyZGVQYXJzZXIucGFyc2VTdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBzZWxmLnplcmRlUGFyc2VyLnBhcnNlU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFycztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgYXNoID0ge1xuICAgICAgICAgICAgICAgICAgICBzaGFkZXJJZDogc2VsZi56ZXJkZVBhcnNlci5wYXJzZVUzMigpLFxuICAgICAgICAgICAgICAgICAgICBmcmFnbWVudDogc2VsZi56ZXJkZVBhcnNlci5wYXJzZVN0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICB2ZXJ0ZXg6IHNlbGYuemVyZGVQYXJzZXIucGFyc2VTdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgZ2VvbWV0cnlTbG90czogc2VsZi56ZXJkZVBhcnNlci5wYXJzZVUzMigpLFxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZVNsb3RzOiBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCksXG4gICAgICAgICAgICAgICAgICAgIHBhc3NVbmlmb3JtczogcGFyc2VTaHZhcnZlYygpLFxuICAgICAgICAgICAgICAgICAgICB2aWV3VW5pZm9ybXM6IHBhcnNlU2h2YXJ2ZWMoKSxcbiAgICAgICAgICAgICAgICAgICAgZHJhd1VuaWZvcm1zOiBwYXJzZVNodmFydmVjKCksXG4gICAgICAgICAgICAgICAgICAgIHVzZXJVbmlmb3JtczogcGFyc2VTaHZhcnZlYygpLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0dXJlU2xvdHM6IHBhcnNlU2h2YXJ2ZWMoKSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHNlbGYuY29tcGlsZVdlYkdMU2hhZGVyKGFzaCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gYWxsb2NfYXJyYXlfYnVmZmVyXG4gICAgICAgICAgICBmdW5jdGlvbiBhbGxvY0FycmF5QnVmZmVyMihzZWxmKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXJJZCA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBsZW4gPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9pbnRlciA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoc2VsZi5tZW1vcnkuYnVmZmVyLCBwb2ludGVyLCBsZW4pO1xuICAgICAgICAgICAgICAgIHNlbGYuYWxsb2NBcnJheUJ1ZmZlcihhcnJheUJ1ZmZlcklkLCBhcnJheSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gYWxsb2NfaW5kZXhfYnVmZmVyXG4gICAgICAgICAgICBmdW5jdGlvbiBhbGxvY0luZGV4QnVmZmVyMyhzZWxmKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXhCdWZmZXJJZCA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBsZW4gPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9pbnRlciA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhcnJheSA9IG5ldyBVaW50MzJBcnJheShzZWxmLm1lbW9yeS5idWZmZXIsIHBvaW50ZXIsIGxlbik7XG4gICAgICAgICAgICAgICAgc2VsZi5hbGxvY0luZGV4QnVmZmVyKGluZGV4QnVmZmVySWQsIGFycmF5KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBhbGxvY192YW9cbiAgICAgICAgICAgIGZ1bmN0aW9uIGFsbG9jVmFvNChzZWxmKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFvSWQgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2hhZGVySWQgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZ2VvbUliSWQgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZ2VvbVZiSWQgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5zdFZiSWQgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5hbGxvY1Zhbyh2YW9JZCwgc2hhZGVySWQsIGdlb21JYklkLCBnZW9tVmJJZCwgaW5zdFZiSWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGRyYXdfY2FsbFxuICAgICAgICAgICAgZnVuY3Rpb24gZHJhd0NhbGw1KHNlbGYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzaGFkZXJJZCA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YW9JZCA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB1bmlmb3Jtc1Bhc3NQdHIgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdW5pZm9ybXNWaWV3UHRyID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVUzMigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVuaWZvcm1zRHJhd1B0ciA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB1bmlmb3Jtc1VzZXJQdHIgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dHVyZXMgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5kcmF3Q2FsbChzaGFkZXJJZCwgdmFvSWQsIHVuaWZvcm1zUGFzc1B0ciwgdW5pZm9ybXNWaWV3UHRyLCB1bmlmb3Jtc0RyYXdQdHIsIHVuaWZvcm1zVXNlclB0ciwgdGV4dHVyZXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIHVwZGF0ZV90ZXh0dXJlX2ltYWdlMmRcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFsbG9jVGV4dHVyZTYoc2VsZikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRleHR1cmVJZCA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB3aWR0aCA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YVB0ciA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLmFsbG9jVGV4dHVyZSh0ZXh0dXJlSWQsIHdpZHRoLCBoZWlnaHQsIGRhdGFQdHIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGJlZ2luX3JlbmRlcl90YXJnZXRzXG4gICAgICAgICAgICBmdW5jdGlvbiBiZWdpblJlbmRlclRhcmdldHM3KHNlbGYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXNzSWQgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVUzMigpO1xuICAgICAgICAgICAgICAgIHNlbGYuYmVnaW5SZW5kZXJUYXJnZXRzKHBhc3NJZCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gYWRkX2NvbG9yX3RhcmdldFxuICAgICAgICAgICAgZnVuY3Rpb24gYWRkQ29sb3JUYXJnZXQ4KHNlbGYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0dXJlSWQgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5pdE9ubHkgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VGMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBnID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZUYzMigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlRjMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VGMzIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLmFkZENvbG9yVGFyZ2V0KHRleHR1cmVJZCwgaW5pdE9ubHksIHIsIGcsIGIsIGEpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIHNldF9kZXB0aF90YXJnZXRcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldERlcHRoVGFyZ2V0OShzZWxmKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dHVyZUlkID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVUzMigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGluaXRPbmx5ID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVUzMigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlcHRoID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZUYzMigpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0RGVwdGhUYXJnZXQodGV4dHVyZUlkLCBpbml0T25seSwgZGVwdGgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGVuZF9yZW5kZXJfdGFyZ2V0c1xuICAgICAgICAgICAgZnVuY3Rpb24gZW5kUmVuZGVyVGFyZ2V0czEwKHNlbGYpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmVuZFJlbmRlclRhcmdldHMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBzZXRfZGVmYXVsdF9kZXB0aF9hbmRfYmxlbmRfbW9kZVxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0RGVmYXVsdERlcHRoQW5kQmxlbmRNb2RlMTEoc2VsZikge1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0RGVmYXVsdERlcHRoQW5kQmxlbmRNb2RlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gYmVnaW5fbWFpbl9jYW52YXNcbiAgICAgICAgICAgIGZ1bmN0aW9uIGJlZ2luTWFpbkNhbnZhczEyKHNlbGYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZUYzMigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGcgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlRjMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgYiA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VGMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZUYzMigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlcHRoID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZUYzMigpO1xuICAgICAgICAgICAgICAgIHNlbGYuYmVnaW5NYWluQ2FudmFzKHIsIGcsIGIsIGEsIGRlcHRoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xuICAgICAgICB0aGlzLm1lbW9yeSA9IG1lbW9yeTtcbiAgICAgICAgdGhpcy5zaXppbmdEYXRhID0gc2l6aW5nRGF0YTtcbiAgICAgICAgdGhpcy5zaGFkZXJzID0gW107XG4gICAgICAgIHRoaXMuaW5kZXhCdWZmZXJzID0gW107XG4gICAgICAgIHRoaXMuYXJyYXlCdWZmZXJzID0gW107XG4gICAgICAgIHRoaXMudmFvcyA9IFtdO1xuICAgICAgICB0aGlzLnRleHR1cmVzID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVidWZmZXJzID0gW107XG4gICAgICAgIHRoaXMudGFyZ2V0V2lkdGggPSAwO1xuICAgICAgICB0aGlzLnRhcmdldEhlaWdodCA9IDA7XG4gICAgICAgIHRoaXMuY2xlYXJGbGFncyA9IDA7XG4gICAgICAgIHRoaXMuY2xlYXJSID0gMDtcbiAgICAgICAgdGhpcy5jbGVhckcgPSAwO1xuICAgICAgICB0aGlzLmNsZWFyQiA9IDA7XG4gICAgICAgIHRoaXMuY2xlYXJBID0gMDtcbiAgICAgICAgdGhpcy5jbGVhckRlcHRoID0gMDtcbiAgICAgICAgLy8gdGhpcy5pc01haW5DYW52YXMgPSBmYWxzZTtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHByZWZlckxvd1Bvd2VyVG9IaWdoUGVyZm9ybWFuY2U6IHRydWUsXG4gICAgICAgICAgICAvLyB4ckNvbXBhdGlibGU6IHRydWUgLy8gVE9ETyhKUCk6IEJyaW5nIGJhY2sgc29tZSBkYXk/XG4gICAgICAgIH07XG4gICAgICAgIC8vIEB0cy1pZ25vcmUgLSBUT0RPKFBhcmFzKTogR2V0IHByb3BlciBzdXBwb3J0IGZvciBPZmZzY3JlZW5DYW52YXNcbiAgICAgICAgdGhpcy5nbCA9XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjYW52YXMuZ2V0Q29udGV4dChcIndlYmdsXCIsIG9wdGlvbnMpIHx8XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGNhbnZhcy5nZXRDb250ZXh0KFwid2ViZ2wtZXhwZXJpbWVudGFsXCIsIG9wdGlvbnMpIHx8XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGNhbnZhcy5nZXRDb250ZXh0KFwiZXhwZXJpbWVudGFsLXdlYmdsXCIsIG9wdGlvbnMpO1xuICAgICAgICBpZiAoIXRoaXMuZ2wpIHtcbiAgICAgICAgICAgIGluY29tcGF0aWJsZUJyb3dzZXJDYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuT0VTVmVydGV4QXJyYXlPYmplY3QgPSBhc3NlcnROb3ROdWxsKHRoaXMuZ2wuZ2V0RXh0ZW5zaW9uKFwiT0VTX3ZlcnRleF9hcnJheV9vYmplY3RcIikpO1xuICAgICAgICB0aGlzLkFOR0xFSW5zdGFuY2VkQXJyYXlzID0gYXNzZXJ0Tm90TnVsbCh0aGlzLmdsLmdldEV4dGVuc2lvbihcIkFOR0xFX2luc3RhbmNlZF9hcnJheXNcIikpO1xuICAgICAgICB0aGlzLmdsLmdldEV4dGVuc2lvbihcIk9FU19zdGFuZGFyZF9kZXJpdmF0aXZlc1wiKTtcbiAgICAgICAgdGhpcy5nbC5nZXRFeHRlbnNpb24oXCJPRVNfZWxlbWVudF9pbmRleF91aW50XCIpO1xuICAgICAgICB0aGlzLnJlc2l6ZShzaXppbmdEYXRhKTtcbiAgICB9XG4gICAgcHJvY2Vzc01lc3NhZ2VzKHplcmRlUGFyc2VyUHRyKSB7XG4gICAgICAgIHRoaXMuemVyZGVQYXJzZXIgPSBuZXcgWmVyZGVQYXJzZXIodGhpcy5tZW1vcnksIHplcmRlUGFyc2VyUHRyKTtcbiAgICAgICAgdGhpcy5iYXNlZjMyID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIpO1xuICAgICAgICB0aGlzLmJhc2V1MzIgPSBuZXcgVWludDMyQXJyYXkodGhpcy5tZW1vcnkuYnVmZmVyKTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnN0YW50LWNvbmRpdGlvblxuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgY29uc3QgbXNnVHlwZSA9IHRoaXMuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbmRGblRhYmxlW21zZ1R5cGVdKHRoaXMpKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVzaXplKHNpemluZ0RhdGEpIHtcbiAgICAgICAgdGhpcy5zaXppbmdEYXRhID0gc2l6aW5nRGF0YTtcbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSBzaXppbmdEYXRhLndpZHRoICogc2l6aW5nRGF0YS5kcGlGYWN0b3I7XG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHNpemluZ0RhdGEuaGVpZ2h0ICogc2l6aW5nRGF0YS5kcGlGYWN0b3I7XG4gICAgfVxuICAgIGdldEF0dHJpYkxvY2F0aW9ucyhwcm9ncmFtLCBiYXNlLCBzbG90cykge1xuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2w7XG4gICAgICAgIGNvbnN0IGF0dHJpYkxvY3MgPSBbXTtcbiAgICAgICAgbGV0IGF0dHJpYnMgPSBzbG90cyA+PiAyO1xuICAgICAgICBpZiAoKHNsb3RzICYgMykgIT0gMClcbiAgICAgICAgICAgIGF0dHJpYnMrKztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhdHRyaWJzOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBzaXplID0gc2xvdHMgLSBpICogNDtcbiAgICAgICAgICAgIGlmIChzaXplID4gNClcbiAgICAgICAgICAgICAgICBzaXplID0gNDtcbiAgICAgICAgICAgIGF0dHJpYkxvY3MucHVzaCh7XG4gICAgICAgICAgICAgICAgbG9jOiBnbC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCBiYXNlICsgaSksXG4gICAgICAgICAgICAgICAgb2Zmc2V0OiBpICogMTYsXG4gICAgICAgICAgICAgICAgc2l6ZTogc2l6ZSxcbiAgICAgICAgICAgICAgICBzdHJpZGU6IHNsb3RzICogNCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhdHRyaWJMb2NzO1xuICAgIH1cbiAgICBnZXRVbmlmb3JtTG9jYXRpb25zKHByb2dyYW0sIHVuaWZvcm1zKSB7XG4gICAgICAgIGNvbnN0IGdsID0gdGhpcy5nbDtcbiAgICAgICAgY29uc3QgdW5pZm9ybUxvY3MgPSBbXTtcbiAgICAgICAgbGV0IG9mZnNldCA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdW5pZm9ybXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHVuaWZvcm0gPSB1bmlmb3Jtc1tpXTtcbiAgICAgICAgICAgIC8vIGxldHMgYWxpZ24gdGhlIHVuaWZvcm1cbiAgICAgICAgICAgIGNvbnN0IHNsb3RzID0gdW5pZm9ybVNpemVUYWJsZVt1bmlmb3JtLnR5XTtcbiAgICAgICAgICAgIGlmICgob2Zmc2V0ICYgMykgIT0gMCAmJiAob2Zmc2V0ICYgMykgKyBzbG90cyA+IDQpIHtcbiAgICAgICAgICAgICAgICAvLyBnb2VzIG92ZXIgdGhlIGJvdW5kYXJ5XG4gICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDQgLSAob2Zmc2V0ICYgMyk7IC8vIG1ha2UganVtcCB0byBuZXcgc2xvdFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdW5pZm9ybUxvY3MucHVzaCh7XG4gICAgICAgICAgICAgICAgbmFtZTogdW5pZm9ybS5uYW1lLFxuICAgICAgICAgICAgICAgIG9mZnNldDogb2Zmc2V0IDw8IDIsXG4gICAgICAgICAgICAgICAgdHk6IHVuaWZvcm0udHksXG4gICAgICAgICAgICAgICAgbG9jOiBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgdW5pZm9ybS5uYW1lKSxcbiAgICAgICAgICAgICAgICBmbjogdGhpcy51bmlmb3JtRm5UYWJsZVt1bmlmb3JtLnR5XSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgb2Zmc2V0ICs9IHNsb3RzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmlmb3JtTG9jcztcbiAgICB9XG4gICAgY29tcGlsZVdlYkdMU2hhZGVyKGFzaCkge1xuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2w7XG4gICAgICAgIGNvbnN0IHZzaCA9IGFzc2VydE5vdE51bGwoZ2wuY3JlYXRlU2hhZGVyKGdsLlZFUlRFWF9TSEFERVIpKTtcbiAgICAgICAgZ2wuc2hhZGVyU291cmNlKHZzaCwgYXNoLnZlcnRleCk7XG4gICAgICAgIGdsLmNvbXBpbGVTaGFkZXIodnNoKTtcbiAgICAgICAgaWYgKCFnbC5nZXRTaGFkZXJQYXJhbWV0ZXIodnNoLCBnbC5DT01QSUxFX1NUQVRVUykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGdsLmdldFNoYWRlckluZm9Mb2codnNoKSwgYWRkTGluZU51bWJlcnNUb1N0cmluZyhhc2gudmVydGV4KSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY29tcGlsZSBwaXhlbHNoYWRlclxuICAgICAgICBjb25zdCBmc2ggPSBhc3NlcnROb3ROdWxsKGdsLmNyZWF0ZVNoYWRlcihnbC5GUkFHTUVOVF9TSEFERVIpKTtcbiAgICAgICAgZ2wuc2hhZGVyU291cmNlKGZzaCwgYXNoLmZyYWdtZW50KTtcbiAgICAgICAgZ2wuY29tcGlsZVNoYWRlcihmc2gpO1xuICAgICAgICBpZiAoIWdsLmdldFNoYWRlclBhcmFtZXRlcihmc2gsIGdsLkNPTVBJTEVfU1RBVFVTKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZ2wuZ2V0U2hhZGVySW5mb0xvZyhmc2gpLCBhZGRMaW5lTnVtYmVyc1RvU3RyaW5nKGFzaC5mcmFnbWVudCkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHByb2dyYW0gPSBhc3NlcnROb3ROdWxsKGdsLmNyZWF0ZVByb2dyYW0oKSk7XG4gICAgICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2c2gpO1xuICAgICAgICBnbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgZnNoKTtcbiAgICAgICAgZ2wubGlua1Byb2dyYW0ocHJvZ3JhbSk7XG4gICAgICAgIGlmICghZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCBnbC5MSU5LX1NUQVRVUykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGdsLmdldFByb2dyYW1JbmZvTG9nKHByb2dyYW0pLCBhZGRMaW5lTnVtYmVyc1RvU3RyaW5nKGFzaC52ZXJ0ZXgpLCBhZGRMaW5lTnVtYmVyc1RvU3RyaW5nKGFzaC5mcmFnbWVudCkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGZldGNoIGFsbCBhdHRyaWJzIGFuZCB1bmlmb3Jtc1xuICAgICAgICB0aGlzLnNoYWRlcnNbYXNoLnNoYWRlcklkXSA9IHtcbiAgICAgICAgICAgIGdlb21BdHRyaWJzOiB0aGlzLmdldEF0dHJpYkxvY2F0aW9ucyhwcm9ncmFtLCBcIm1wc2NfcGFja2VkX2dlb21ldHJ5X1wiLCBhc2guZ2VvbWV0cnlTbG90cyksXG4gICAgICAgICAgICBpbnN0QXR0cmliczogdGhpcy5nZXRBdHRyaWJMb2NhdGlvbnMocHJvZ3JhbSwgXCJtcHNjX3BhY2tlZF9pbnN0YW5jZV9cIiwgYXNoLmluc3RhbmNlU2xvdHMpLFxuICAgICAgICAgICAgcGFzc1VuaWZvcm1zOiB0aGlzLmdldFVuaWZvcm1Mb2NhdGlvbnMocHJvZ3JhbSwgYXNoLnBhc3NVbmlmb3JtcyksXG4gICAgICAgICAgICB2aWV3VW5pZm9ybXM6IHRoaXMuZ2V0VW5pZm9ybUxvY2F0aW9ucyhwcm9ncmFtLCBhc2gudmlld1VuaWZvcm1zKSxcbiAgICAgICAgICAgIGRyYXdVbmlmb3JtczogdGhpcy5nZXRVbmlmb3JtTG9jYXRpb25zKHByb2dyYW0sIGFzaC5kcmF3VW5pZm9ybXMpLFxuICAgICAgICAgICAgdXNlclVuaWZvcm1zOiB0aGlzLmdldFVuaWZvcm1Mb2NhdGlvbnMocHJvZ3JhbSwgYXNoLnVzZXJVbmlmb3JtcyksXG4gICAgICAgICAgICB0ZXh0dXJlU2xvdHM6IHRoaXMuZ2V0VW5pZm9ybUxvY2F0aW9ucyhwcm9ncmFtLCBhc2gudGV4dHVyZVNsb3RzKSxcbiAgICAgICAgICAgIGluc3RhbmNlU2xvdHM6IGFzaC5pbnN0YW5jZVNsb3RzLFxuICAgICAgICAgICAgcHJvZ3JhbTogcHJvZ3JhbSxcbiAgICAgICAgICAgIGFzaDogYXNoLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBhbGxvY0FycmF5QnVmZmVyKGFycmF5QnVmZmVySWQsIGFycmF5KSB7XG4gICAgICAgIGNvbnN0IGdsID0gdGhpcy5nbDtcbiAgICAgICAgbGV0IGJ1ZiA9IHRoaXMuYXJyYXlCdWZmZXJzW2FycmF5QnVmZmVySWRdO1xuICAgICAgICBpZiAoYnVmID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGJ1ZiA9IHRoaXMuYXJyYXlCdWZmZXJzW2FycmF5QnVmZmVySWRdID0ge1xuICAgICAgICAgICAgICAgIGdsQnVmOiBhc3NlcnROb3ROdWxsKGdsLmNyZWF0ZUJ1ZmZlcigpKSxcbiAgICAgICAgICAgICAgICBsZW5ndGg6IGFycmF5Lmxlbmd0aCxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBidWYubGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBidWYuZ2xCdWYpO1xuICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgYXJyYXksIGdsLlNUQVRJQ19EUkFXKTtcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIG51bGwpO1xuICAgIH1cbiAgICBhbGxvY0luZGV4QnVmZmVyKGluZGV4QnVmZmVySWQsIGFycmF5KSB7XG4gICAgICAgIGNvbnN0IGdsID0gdGhpcy5nbDtcbiAgICAgICAgbGV0IGJ1ZiA9IHRoaXMuaW5kZXhCdWZmZXJzW2luZGV4QnVmZmVySWRdO1xuICAgICAgICBpZiAoYnVmID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGJ1ZiA9IHRoaXMuaW5kZXhCdWZmZXJzW2luZGV4QnVmZmVySWRdID0ge1xuICAgICAgICAgICAgICAgIGdsQnVmOiBhc3NlcnROb3ROdWxsKGdsLmNyZWF0ZUJ1ZmZlcigpKSxcbiAgICAgICAgICAgICAgICBsZW5ndGg6IGFycmF5Lmxlbmd0aCxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBidWYubGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGJ1Zi5nbEJ1Zik7XG4gICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGFycmF5LCBnbC5TVEFUSUNfRFJBVyk7XG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIG51bGwpO1xuICAgIH1cbiAgICBhbGxvY1Zhbyh2YW9JZCwgc2hhZGVySWQsIGdlb21JYklkLCBnZW9tVmJJZCwgaW5zdFZiSWQpIHtcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsO1xuICAgICAgICBjb25zdCBvbGRWYW8gPSB0aGlzLnZhb3NbdmFvSWRdO1xuICAgICAgICBpZiAob2xkVmFvKSB7XG4gICAgICAgICAgICB0aGlzLk9FU1ZlcnRleEFycmF5T2JqZWN0LmRlbGV0ZVZlcnRleEFycmF5T0VTKG9sZFZhby5nbFZhbyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZ2xWYW8gPSBhc3NlcnROb3ROdWxsKHRoaXMuT0VTVmVydGV4QXJyYXlPYmplY3QuY3JlYXRlVmVydGV4QXJyYXlPRVMoKSk7XG4gICAgICAgIGNvbnN0IHZhbyA9ICh0aGlzLnZhb3NbdmFvSWRdID0geyBnbFZhbywgZ2VvbUliSWQsIGdlb21WYklkLCBpbnN0VmJJZCB9KTtcbiAgICAgICAgdGhpcy5PRVNWZXJ0ZXhBcnJheU9iamVjdC5iaW5kVmVydGV4QXJyYXlPRVModmFvLmdsVmFvKTtcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHRoaXMuYXJyYXlCdWZmZXJzW2dlb21WYklkXS5nbEJ1Zik7XG4gICAgICAgIGNvbnN0IHNoYWRlciA9IHRoaXMuc2hhZGVyc1tzaGFkZXJJZF07XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hhZGVyLmdlb21BdHRyaWJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBhdHRyID0gc2hhZGVyLmdlb21BdHRyaWJzW2ldO1xuICAgICAgICAgICAgaWYgKGF0dHIubG9jIDwgMCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihhdHRyLmxvYywgYXR0ci5zaXplLCBnbC5GTE9BVCwgZmFsc2UsIGF0dHIuc3RyaWRlLCBhdHRyLm9mZnNldCk7XG4gICAgICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShhdHRyLmxvYyk7XG4gICAgICAgICAgICB0aGlzLkFOR0xFSW5zdGFuY2VkQXJyYXlzLnZlcnRleEF0dHJpYkRpdmlzb3JBTkdMRShhdHRyLmxvYywgMCk7XG4gICAgICAgIH1cbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHRoaXMuYXJyYXlCdWZmZXJzW2luc3RWYklkXS5nbEJ1Zik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hhZGVyLmluc3RBdHRyaWJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBhdHRyID0gc2hhZGVyLmluc3RBdHRyaWJzW2ldO1xuICAgICAgICAgICAgaWYgKGF0dHIubG9jIDwgMCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihhdHRyLmxvYywgYXR0ci5zaXplLCBnbC5GTE9BVCwgZmFsc2UsIGF0dHIuc3RyaWRlLCBhdHRyLm9mZnNldCk7XG4gICAgICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShhdHRyLmxvYyk7XG4gICAgICAgICAgICB0aGlzLkFOR0xFSW5zdGFuY2VkQXJyYXlzLnZlcnRleEF0dHJpYkRpdmlzb3JBTkdMRShhdHRyLmxvYywgMSk7XG4gICAgICAgIH1cbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgdGhpcy5pbmRleEJ1ZmZlcnNbZ2VvbUliSWRdLmdsQnVmKTtcbiAgICAgICAgdGhpcy5PRVNWZXJ0ZXhBcnJheU9iamVjdC5iaW5kVmVydGV4QXJyYXlPRVMobnVsbCk7XG4gICAgfVxuICAgIGRyYXdDYWxsKHNoYWRlcklkLCB2YW9JZCwgcGFzc1VuaWZvcm1zUHRyLCB2aWV3VW5pZm9ybXNQdHIsIGRyYXdVbmlmb3Jtc1B0ciwgdXNlclVuaWZvcm1zUHRyLCB0ZXh0dXJlc1B0cikge1xuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2w7XG4gICAgICAgIGNvbnN0IHNoYWRlciA9IHRoaXMuc2hhZGVyc1tzaGFkZXJJZF07XG4gICAgICAgIGdsLnVzZVByb2dyYW0oc2hhZGVyLnByb2dyYW0pO1xuICAgICAgICBjb25zdCB2YW8gPSB0aGlzLnZhb3NbdmFvSWRdO1xuICAgICAgICB0aGlzLk9FU1ZlcnRleEFycmF5T2JqZWN0LmJpbmRWZXJ0ZXhBcnJheU9FUyh2YW8uZ2xWYW8pO1xuICAgICAgICBjb25zdCBpbmRleEJ1ZmZlciA9IHRoaXMuaW5kZXhCdWZmZXJzW3Zhby5nZW9tSWJJZF07XG4gICAgICAgIGNvbnN0IGluc3RhbmNlQnVmZmVyID0gdGhpcy5hcnJheUJ1ZmZlcnNbdmFvLmluc3RWYklkXTtcbiAgICAgICAgLy8gc2V0IHVwIHVuaWZvcm1zIFRPRE8gZG8gdGhpcyBhIGJpdCBtb3JlIGluY3JlbWVudGFsIGJhc2VkIG9uIHVuaWZvcm0gbGF5ZXJcbiAgICAgICAgLy8gYWxzbyBwb3NzaWJseSB1c2Ugd2ViR0wyIHVuaWZvcm0gYnVmZmVycy4gRm9yIG5vdyB0aGlzIHdpbGwgc3VmZmljZSBmb3Igd2ViR0wgMSBjb21wYXRcbiAgICAgICAgY29uc3QgcGFzc1VuaWZvcm1zID0gc2hhZGVyLnBhc3NVbmlmb3JtcztcbiAgICAgICAgLy8gaWYgdnJfcHJlc2VudGluZ1xuICAgICAgICBjb25zdCB2aWV3VW5pZm9ybXMgPSBzaGFkZXIudmlld1VuaWZvcm1zO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZpZXdVbmlmb3Jtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgdW5pID0gdmlld1VuaWZvcm1zW2ldO1xuICAgICAgICAgICAgdW5pLmZuKHRoaXMsIHVuaS5sb2MsIHVuaS5vZmZzZXQgKyB2aWV3VW5pZm9ybXNQdHIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRyYXdVbmlmb3JtcyA9IHNoYWRlci5kcmF3VW5pZm9ybXM7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZHJhd1VuaWZvcm1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB1bmkgPSBkcmF3VW5pZm9ybXNbaV07XG4gICAgICAgICAgICB1bmkuZm4odGhpcywgdW5pLmxvYywgdW5pLm9mZnNldCArIGRyYXdVbmlmb3Jtc1B0cik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXNlclVuaWZvcm1zID0gc2hhZGVyLnVzZXJVbmlmb3JtcztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2VyVW5pZm9ybXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHVuaSA9IHVzZXJVbmlmb3Jtc1tpXTtcbiAgICAgICAgICAgIHVuaS5mbih0aGlzLCB1bmkubG9jLCB1bmkub2Zmc2V0ICsgdXNlclVuaWZvcm1zUHRyKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0ZXh0dXJlU2xvdHMgPSBzaGFkZXIudGV4dHVyZVNsb3RzO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRleHR1cmVTbG90cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgdGV4U2xvdCA9IHRleHR1cmVTbG90c1tpXTtcbiAgICAgICAgICAgIGNvbnN0IHRleElkID0gdGhpcy5iYXNldTMyWyh0ZXh0dXJlc1B0ciA+PiAyKSArIGldO1xuICAgICAgICAgICAgY29uc3QgdGV4T2JqID0gdGhpcy50ZXh0dXJlc1t0ZXhJZF07XG4gICAgICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwICsgaSk7XG4gICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXhPYmopO1xuICAgICAgICAgICAgZ2wudW5pZm9ybTFpKHRleFNsb3QubG9jLCBpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbmRpY2VzID0gaW5kZXhCdWZmZXIubGVuZ3RoO1xuICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBpbnN0YW5jZUJ1ZmZlci5sZW5ndGggLyBzaGFkZXIuaW5zdGFuY2VTbG90cztcbiAgICAgICAgLy8gaWYgKHRoaXMuaXNNYWluQ2FudmFzICYmIHhySXNQcmVzZW50aW5nKSB7XG4gICAgICAgIC8vIGZvciAobGV0IGkgPSAzOyBpIDwgcGFzc191bmlmb3Jtcy5sZW5ndGg7IGkgKyspIHtcbiAgICAgICAgLy8gICAgIGxldCB1bmkgPSBwYXNzX3VuaWZvcm1zW2ldO1xuICAgICAgICAvLyAgICAgdW5pLmZuKHRoaXMsIHVuaS5sb2MsIHVuaS5vZmZzZXQgKyBwYXNzX3VuaWZvcm1zX3B0cik7XG4gICAgICAgIC8vIH1cbiAgICAgICAgLy8gLy8gdGhlIGZpcnN0IDIgbWF0cmljZXMgYXJlIHByb2plY3QgYW5kIHZpZXdcbiAgICAgICAgLy8gbGV0IGxlZnRfdmlld3BvcnQgPSB0aGlzLnhyX2xlZnRfdmlld3BvcnQ7XG4gICAgICAgIC8vIGdsLnZpZXdwb3J0KGxlZnRfdmlld3BvcnQueCwgbGVmdF92aWV3cG9ydC55LCBsZWZ0X3ZpZXdwb3J0LndpZHRoLCBsZWZ0X3ZpZXdwb3J0LmhlaWdodCk7XG4gICAgICAgIC8vIGdsLnVuaWZvcm1NYXRyaXg0ZnYocGFzc191bmlmb3Jtc1swXS5sb2MsIGZhbHNlLCB0aGlzLnhyX2xlZnRfcHJvamVjdGlvbl9tYXRyaXgpO1xuICAgICAgICAvLyBnbC51bmlmb3JtTWF0cml4NGZ2KHBhc3NfdW5pZm9ybXNbMV0ubG9jLCBmYWxzZSwgdGhpcy54cl9sZWZ0X3RyYW5zZm9ybV9tYXRyaXgpO1xuICAgICAgICAvLyBnbC51bmlmb3JtTWF0cml4NGZ2KHBhc3NfdW5pZm9ybXNbMl0ubG9jLCBmYWxzZSwgdGhpcy54cl9sZWZ0X2ludnRyYW5zZm9ybV9tYXRyaXgpO1xuICAgICAgICAvLyB0aGlzLkFOR0xFX2luc3RhbmNlZF9hcnJheXMuZHJhd0VsZW1lbnRzSW5zdGFuY2VkQU5HTEUoZ2wuVFJJQU5HTEVTLCBpbmRpY2VzLCBnbC5VTlNJR05FRF9JTlQsIDAsIGluc3RhbmNlcyk7XG4gICAgICAgIC8vIGxldCByaWdodF92aWV3cG9ydCA9IHRoaXMueHJfcmlnaHRfdmlld3BvcnQ7XG4gICAgICAgIC8vIGdsLnZpZXdwb3J0KHJpZ2h0X3ZpZXdwb3J0LngsIHJpZ2h0X3ZpZXdwb3J0LnksIHJpZ2h0X3ZpZXdwb3J0LndpZHRoLCByaWdodF92aWV3cG9ydC5oZWlnaHQpO1xuICAgICAgICAvLyBnbC51bmlmb3JtTWF0cml4NGZ2KHBhc3NfdW5pZm9ybXNbMF0ubG9jLCBmYWxzZSwgdGhpcy54cl9yaWdodF9wcm9qZWN0aW9uX21hdHJpeCk7XG4gICAgICAgIC8vIGdsLnVuaWZvcm1NYXRyaXg0ZnYocGFzc191bmlmb3Jtc1sxXS5sb2MsIGZhbHNlLCB0aGlzLnhyX3JpZ2h0X3RyYW5zZm9ybV9tYXRyaXgpO1xuICAgICAgICAvLyBnbC51bmlmb3JtTWF0cml4NGZ2KHBhc3NfdW5pZm9ybXNbMl0ubG9jLCBmYWxzZSwgdGhpcy54cl9yaWdodF9pbnZ0cmFuc2Zvcm1fbWF0cml4KTtcbiAgICAgICAgLy8gdGhpcy5BTkdMRV9pbnN0YW5jZWRfYXJyYXlzLmRyYXdFbGVtZW50c0luc3RhbmNlZEFOR0xFKGdsLlRSSUFOR0xFUywgaW5kaWNlcywgZ2wuVU5TSUdORURfSU5ULCAwLCBpbnN0YW5jZXMpO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhc3NVbmlmb3Jtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgdW5pID0gcGFzc1VuaWZvcm1zW2ldO1xuICAgICAgICAgICAgdW5pLmZuKHRoaXMsIHVuaS5sb2MsIHVuaS5vZmZzZXQgKyBwYXNzVW5pZm9ybXNQdHIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuQU5HTEVJbnN0YW5jZWRBcnJheXMuZHJhd0VsZW1lbnRzSW5zdGFuY2VkQU5HTEUoZ2wuVFJJQU5HTEVTLCBpbmRpY2VzLCBnbC5VTlNJR05FRF9JTlQsIDAsIGluc3RhbmNlcyk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgdGhpcy5PRVNWZXJ0ZXhBcnJheU9iamVjdC5iaW5kVmVydGV4QXJyYXlPRVMobnVsbCk7XG4gICAgfVxuICAgIGFsbG9jVGV4dHVyZSh0ZXh0dXJlSWQsIHdpZHRoLCBoZWlnaHQsIGRhdGFQdHIpIHtcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsO1xuICAgICAgICBjb25zdCBnbFRleCA9IHRoaXMudGV4dHVyZXNbdGV4dHVyZUlkXSB8fCBnbC5jcmVhdGVUZXh0dXJlKCk7XG4gICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIGdsVGV4KTtcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLkxJTkVBUik7XG4gICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5MSU5FQVIpO1xuICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKTtcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQ0xBTVBfVE9fRURHRSk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheSh0aGlzLm1lbW9yeS5idWZmZXIsIGRhdGFQdHIsIHdpZHRoICogaGVpZ2h0ICogNCk7XG4gICAgICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCQSwgd2lkdGgsIGhlaWdodCwgMCwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgZGF0YSk7XG4gICAgICAgIHRoaXMudGV4dHVyZXNbdGV4dHVyZUlkXSA9IGdsVGV4O1xuICAgIH1cbiAgICBiZWdpblJlbmRlclRhcmdldHMocGFzc0lkLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIGNvbnN0IGdsID0gdGhpcy5nbDtcbiAgICAgICAgdGhpcy50YXJnZXRXaWR0aCA9IHdpZHRoO1xuICAgICAgICB0aGlzLnRhcmdldEhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgdGhpcy5jbGVhckZsYWdzID0gMDtcbiAgICAgICAgLy8gdGhpcy5pc01haW5DYW52YXMgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgZ2xGcmFtZWJ1ZmZlciA9IHRoaXMuZnJhbWVidWZmZXJzW3Bhc3NJZF0gfHxcbiAgICAgICAgICAgICh0aGlzLmZyYW1lYnVmZmVyc1twYXNzSWRdID0gYXNzZXJ0Tm90TnVsbChnbC5jcmVhdGVGcmFtZWJ1ZmZlcigpKSk7XG4gICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZ2xGcmFtZWJ1ZmZlcik7XG4gICAgfVxuICAgIGFkZENvbG9yVGFyZ2V0KHRleHR1cmVJZCwgaW5pdE9ubHksIHIsIGcsIGIsIGEpIHtcbiAgICAgICAgLy8gaWYgdXNlX2RlZmF1bHRcbiAgICAgICAgdGhpcy5jbGVhclIgPSByO1xuICAgICAgICB0aGlzLmNsZWFyRyA9IGc7XG4gICAgICAgIHRoaXMuY2xlYXJCID0gYjtcbiAgICAgICAgdGhpcy5jbGVhckEgPSBhO1xuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2w7XG4gICAgICAgIGNvbnN0IGdsVGV4ID0gdGhpcy50ZXh0dXJlc1t0ZXh0dXJlSWRdIHx8XG4gICAgICAgICAgICAodGhpcy50ZXh0dXJlc1t0ZXh0dXJlSWRdID0gZ2wuY3JlYXRlVGV4dHVyZSgpKTtcbiAgICAgICAgLy8gcmVzaXplIG9yIGNyZWF0ZSB0ZXh0dXJlXG4gICAgICAgIGlmIChnbFRleC5tcFdpZHRoICE9IHRoaXMudGFyZ2V0V2lkdGggfHxcbiAgICAgICAgICAgIGdsVGV4Lm1wSGVpZ2h0ICE9IHRoaXMudGFyZ2V0SGVpZ2h0KSB7XG4gICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBnbFRleCk7XG4gICAgICAgICAgICB0aGlzLmNsZWFyRmxhZ3MgfD0gZ2wuQ09MT1JfQlVGRkVSX0JJVDtcbiAgICAgICAgICAgIGdsVGV4Lm1wV2lkdGggPSB0aGlzLnRhcmdldFdpZHRoO1xuICAgICAgICAgICAgZ2xUZXgubXBIZWlnaHQgPSB0aGlzLnRhcmdldEhlaWdodDtcbiAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5MSU5FQVIpO1xuICAgICAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLkxJTkVBUik7XG4gICAgICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKTtcbiAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1QsIGdsLkNMQU1QX1RPX0VER0UpO1xuICAgICAgICAgICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBnbC5SR0JBLCBnbFRleC5tcFdpZHRoLCBnbFRleC5tcEhlaWdodCwgMCwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWluaXRPbmx5KSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyRmxhZ3MgfD0gZ2wuQ09MT1JfQlVGRkVSX0JJVDtcbiAgICAgICAgfVxuICAgICAgICBnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZFUiwgZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsLlRFWFRVUkVfMkQsIGdsVGV4LCAwKTtcbiAgICB9XG4gICAgc2V0RGVwdGhUYXJnZXQodGV4dHVyZUlkLCBpbml0T25seSwgZGVwdGgpIHtcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsO1xuICAgICAgICB0aGlzLmNsZWFyRGVwdGggPSBkZXB0aDtcbiAgICAgICAgY29uc3QgZ2xSZW5kZXJCdWZmZXIgPSB0aGlzLnRleHR1cmVzW3RleHR1cmVJZF0gfHxcbiAgICAgICAgICAgICh0aGlzLnRleHR1cmVzW3RleHR1cmVJZF0gPSBnbC5jcmVhdGVSZW5kZXJidWZmZXIoKSk7XG4gICAgICAgIGlmIChnbFJlbmRlckJ1ZmZlci5tcFdpZHRoICE9IHRoaXMudGFyZ2V0V2lkdGggfHxcbiAgICAgICAgICAgIGdsUmVuZGVyQnVmZmVyLm1wSGVpZ2h0ICE9IHRoaXMudGFyZ2V0SGVpZ2h0KSB7XG4gICAgICAgICAgICAvLyBCb3Jyb3dlZCBjb25jZXB0IGZyb20gaHR0cHM6Ly93ZWJnbGZ1bmRhbWVudGFscy5vcmcvd2ViZ2wvbGVzc29ucy93ZWJnbC1yZW5kZXItdG8tdGV4dHVyZS5odG1sXG4gICAgICAgICAgICBnbC5iaW5kUmVuZGVyYnVmZmVyKGdsLlJFTkRFUkJVRkZFUiwgZ2xSZW5kZXJCdWZmZXIpO1xuICAgICAgICAgICAgdGhpcy5jbGVhckZsYWdzIHw9IGdsLkRFUFRIX0JVRkZFUl9CSVQ7XG4gICAgICAgICAgICBnbFJlbmRlckJ1ZmZlci5tcFdpZHRoID0gdGhpcy50YXJnZXRXaWR0aDtcbiAgICAgICAgICAgIGdsUmVuZGVyQnVmZmVyLm1wSGVpZ2h0ID0gdGhpcy50YXJnZXRIZWlnaHQ7XG4gICAgICAgICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgZ2wuREVQVEhfQ09NUE9ORU5UMTYsIHRoaXMudGFyZ2V0V2lkdGgsIHRoaXMudGFyZ2V0SGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghaW5pdE9ubHkpIHtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJGbGFncyB8PSBnbC5ERVBUSF9CVUZGRVJfQklUO1xuICAgICAgICB9XG4gICAgICAgIGdsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBnbC5ERVBUSF9BVFRBQ0hNRU5ULCBnbC5SRU5ERVJCVUZGRVIsIGdsUmVuZGVyQnVmZmVyKTtcbiAgICB9XG4gICAgZW5kUmVuZGVyVGFyZ2V0cygpIHtcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsO1xuICAgICAgICAvLyBwcm9jZXNzIHRoZSBhY3R1YWwgJ2NsZWFyJ1xuICAgICAgICBnbC52aWV3cG9ydCgwLCAwLCB0aGlzLnRhcmdldFdpZHRoLCB0aGlzLnRhcmdldEhlaWdodCk7XG4gICAgICAgIC8vIGNoZWNrIGlmIHdlIG5lZWQgdG8gY2xlYXIgY29sb3IsIGFuZCBkZXB0aFxuICAgICAgICAvLyBjbGVhciBpdFxuICAgICAgICBpZiAodGhpcy5jbGVhckZsYWdzKSB7XG4gICAgICAgICAgICBnbC5jbGVhckNvbG9yKHRoaXMuY2xlYXJSLCB0aGlzLmNsZWFyRywgdGhpcy5jbGVhckIsIHRoaXMuY2xlYXJBKTtcbiAgICAgICAgICAgIGdsLmNsZWFyRGVwdGgodGhpcy5jbGVhckRlcHRoKTtcbiAgICAgICAgICAgIGdsLmNsZWFyKHRoaXMuY2xlYXJGbGFncyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0RGVmYXVsdERlcHRoQW5kQmxlbmRNb2RlKCkge1xuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2w7XG4gICAgICAgIGdsLmVuYWJsZShnbC5ERVBUSF9URVNUKTtcbiAgICAgICAgZ2wuZGVwdGhGdW5jKGdsLkxFUVVBTCk7XG4gICAgICAgIGdsLmJsZW5kRXF1YXRpb25TZXBhcmF0ZShnbC5GVU5DX0FERCwgZ2wuRlVOQ19BREQpO1xuICAgICAgICBnbC5ibGVuZEZ1bmNTZXBhcmF0ZShnbC5PTkUsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsIGdsLk9ORSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSk7XG4gICAgICAgIGdsLmVuYWJsZShnbC5CTEVORCk7XG4gICAgfVxuICAgIGJlZ2luTWFpbkNhbnZhcyhyLCBnLCBiLCBhLCBkZXB0aCkge1xuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2w7XG4gICAgICAgIC8vIHRoaXMuaXNNYWluQ2FudmFzID0gdHJ1ZTtcbiAgICAgICAgLy8gaWYgKHRoaXMueHJJc1ByZXNlbnRpbmcpIHtcbiAgICAgICAgLy8gbGV0IHhyX3dlYmdsbGF5ZXIgPSB0aGlzLnhyX3Nlc3Npb24ucmVuZGVyU3RhdGUuYmFzZUxheWVyO1xuICAgICAgICAvLyB0aGlzLmdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgeHJfd2ViZ2xsYXllci5mcmFtZWJ1ZmZlcik7XG4gICAgICAgIC8vIGdsLnZpZXdwb3J0KDAsIDAsIHhyX3dlYmdsbGF5ZXIuZnJhbWVidWZmZXJXaWR0aCwgeHJfd2ViZ2xsYXllci5mcmFtZWJ1ZmZlckhlaWdodCk7XG4gICAgICAgIC8vIC8vIHF1ZXN0IDEgaXMgMzY0OFxuICAgICAgICAvLyAvLyBxdWVzdCAyIGlzIDQwOTZcbiAgICAgICAgLy8gbGV0IGxlZnRfdmlldyA9IHRoaXMueHJfcG9zZS52aWV3c1swXTtcbiAgICAgICAgLy8gbGV0IHJpZ2h0X3ZpZXcgPSB0aGlzLnhyX3Bvc2Uudmlld3NbMV07XG4gICAgICAgIC8vIHRoaXMueHJfbGVmdF92aWV3cG9ydCA9IHhyX3dlYmdsbGF5ZXIuZ2V0Vmlld3BvcnQobGVmdF92aWV3KTtcbiAgICAgICAgLy8gdGhpcy54cl9yaWdodF92aWV3cG9ydCA9IHhyX3dlYmdsbGF5ZXIuZ2V0Vmlld3BvcnQocmlnaHRfdmlldyk7XG4gICAgICAgIC8vIHRoaXMueHJfbGVmdF9wcm9qZWN0aW9uX21hdHJpeCA9IGxlZnRfdmlldy5wcm9qZWN0aW9uTWF0cml4O1xuICAgICAgICAvLyB0aGlzLnhyX2xlZnRfdHJhbnNmb3JtX21hdHJpeCA9IGxlZnRfdmlldy50cmFuc2Zvcm0uaW52ZXJzZS5tYXRyaXg7XG4gICAgICAgIC8vIHRoaXMueHJfbGVmdF9pbnZ0cmFuc2Zvcm1fbWF0cml4ID0gbGVmdF92aWV3LnRyYW5zZm9ybS5tYXRyaXg7XG4gICAgICAgIC8vIHRoaXMueHJfcmlnaHRfcHJvamVjdGlvbl9tYXRyaXggPSByaWdodF92aWV3LnByb2plY3Rpb25NYXRyaXg7XG4gICAgICAgIC8vIHRoaXMueHJfcmlnaHRfdHJhbnNmb3JtX21hdHJpeCA9IHJpZ2h0X3ZpZXcudHJhbnNmb3JtLmludmVyc2UubWF0cml4O1xuICAgICAgICAvLyB0aGlzLnhyX3JpZ2h0X2NhbWVyYV9wb3MgPSByaWdodF92aWV3LnRyYW5zZm9ybS5pbnZlcnNlLnBvc2l0aW9uO1xuICAgICAgICAvLyB0aGlzLnhyX3JpZ2h0X2ludnRyYW5zZm9ybV9tYXRyaXggPSByaWdodF92aWV3LnRyYW5zZm9ybS5tYXRyaXg7XG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCk7XG4gICAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIHRoaXMuc2l6aW5nRGF0YS53aWR0aCAqIHRoaXMuc2l6aW5nRGF0YS5kcGlGYWN0b3IsIHRoaXMuc2l6aW5nRGF0YS5oZWlnaHQgKiB0aGlzLnNpemluZ0RhdGEuZHBpRmFjdG9yKTtcbiAgICAgICAgLy8gfVxuICAgICAgICBnbC5jbGVhckNvbG9yKHIsIGcsIGIsIGEpO1xuICAgICAgICBnbC5jbGVhckRlcHRoKGRlcHRoKTtcbiAgICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpO1xuICAgIH1cbn1cbmNvbnN0IHVuaWZvcm1TaXplVGFibGUgPSB7XG4gICAgZmxvYXQ6IDEsXG4gICAgdmVjMjogMixcbiAgICB2ZWMzOiAzLFxuICAgIHZlYzQ6IDQsXG4gICAgbWF0MjogNCxcbiAgICBtYXQzOiA5LFxuICAgIG1hdDQ6IDE2LFxufTtcbmZ1bmN0aW9uIGFkZExpbmVOdW1iZXJzVG9TdHJpbmcoY29kZSkge1xuICAgIGNvbnN0IGxpbmVzID0gY29kZS5zcGxpdChcIlxcblwiKTtcbiAgICBsZXQgb3V0ID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG91dCArPSBpICsgMSArIFwiOiBcIiArIGxpbmVzW2ldICsgXCJcXG5cIjtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./webgl_renderer.ts\n");

/***/ }),

/***/ "./wrf_wasm_worker.ts":
/*!****************************!*\
  !*** ./wrf_wasm_worker.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"WasmApp\": () => (/* binding */ WasmApp)\n/* harmony export */ });\n/* harmony import */ var _cursor_map__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./cursor_map */ \"./cursor_map.ts\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./common */ \"./common.ts\");\n/* harmony import */ var _zerde__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./zerde */ \"./zerde.ts\");\n/* harmony import */ var _zerde_eventloop_events__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./zerde_eventloop_events */ \"./zerde_eventloop_events.ts\");\n/* harmony import */ var _zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./zerde_keyboard_handlers */ \"./zerde_keyboard_handlers.ts\");\n/* harmony import */ var _webgl_renderer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./webgl_renderer */ \"./webgl_renderer.ts\");\n/* harmony import */ var _rpc_types__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./rpc_types */ \"./rpc_types.ts\");\n// Copyright (c) 2021-present, Cruise LLC\n//\n// This source code is licensed under the Apache License, Version 2.0,\n// found in the LICENSE-APACHE file in the root directory of this source tree.\n// You may not use this file except in compliance with the License.\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n\n\n\n\n\n\n\nconst rpc = new _common__WEBPACK_IMPORTED_MODULE_1__.Rpc(self);\nconst isFirefox = self.navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\nclass WasmApp {\n    constructor({ offscreenCanvas, wasmModule, wasmExports, memory, sizingData, baseUri, fileHandles, taskWorkerSab, }) {\n        this.xrCanPresent = false;\n        this.xrIsPresenting = false;\n        // Array of function id's wasm can call on us; `self` is pointer to WasmApp.\n        // Function names are suffixed with the index in the array, and annotated with\n        // their name in cx_wasm32.rs, for easier matching.\n        this.sendFnTable = [\n            // end\n            function end0(_self) {\n                return true;\n            },\n            // run_webgl\n            function runWebGL1(self) {\n                const zerdeParserPtr = self.zerdeParser.parseU64();\n                if (self.webglRenderer) {\n                    self.webglRenderer.processMessages(Number(zerdeParserPtr));\n                    self.exports.deallocWasmMessage(zerdeParserPtr);\n                }\n                else {\n                    self.runWebGLPromise = rpc\n                        .send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.RunWebGL, Number(zerdeParserPtr))\n                        .then(() => {\n                        self.exports.deallocWasmMessage(zerdeParserPtr);\n                        self.runWebGLPromise = undefined;\n                    });\n                }\n            },\n            // log\n            function log2(self) {\n                console.log(self.zerdeParser.parseString());\n            },\n            // load_deps\n            function loadDeps3(self) {\n                const deps = [];\n                const numDeps = self.zerdeParser.parseU32();\n                for (let i = 0; i < numDeps; i++) {\n                    deps.push(self.zerdeParser.parseString());\n                }\n                self.loadDeps(deps);\n            },\n            // request_animation_frame\n            function requestAnimationFrame4(self) {\n                self.requestAnimationFrame();\n            },\n            // set_document_title\n            function setDocumentTitle5(self) {\n                self.setDocumentTitle(self.zerdeParser.parseString());\n            },\n            // set_mouse_cursor\n            function setMouseCursor6(self) {\n                self.setMouseCursor(self.zerdeParser.parseU32());\n            },\n            // show_text_ime\n            function showTextIme7(self) {\n                const x = self.zerdeParser.parseF32();\n                const y = self.zerdeParser.parseF32();\n                rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.ShowTextIME, { x, y });\n            },\n            // hide_text_ime\n            function hideTextIme8(_self) {\n                // TODO(JP): doesn't seem to do anything, is that intentional?\n            },\n            // text_copy_response\n            function textCopyResponse9(self) {\n                const textCopyResponse = self.zerdeParser.parseString();\n                rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.TextCopyResponse, textCopyResponse);\n            },\n            // start_timer\n            function startTimer10(self) {\n                const repeats = self.zerdeParser.parseU32();\n                const id = self.zerdeParser.parseF64();\n                const interval = self.zerdeParser.parseF64();\n                self.startTimer(id, interval, repeats);\n            },\n            // stop_timer\n            function stopTimer11(self) {\n                const id = self.zerdeParser.parseF64();\n                self.stopTimer(id);\n            },\n            // xr_start_presenting\n            function xrStartPresenting12(self) {\n                self.xrStartPresenting();\n            },\n            // xr_stop_presenting\n            function xrStopPresenting13(self) {\n                self.xrStopPresenting();\n            },\n            // http_send\n            function httpSend14(self) {\n                const port = self.zerdeParser.parseU32();\n                const signalId = self.zerdeParser.parseU32();\n                const verb = self.zerdeParser.parseString();\n                const path = self.zerdeParser.parseString();\n                const proto = self.zerdeParser.parseString();\n                const domain = self.zerdeParser.parseString();\n                const contentType = self.zerdeParser.parseString();\n                const body = self.zerdeParser.parseU8Slice();\n                self.httpSend(verb, path, proto, domain, port, contentType, body, signalId);\n            },\n            // fullscreen\n            function fullscreen15(_self) {\n                rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.Fullscreen);\n            },\n            // normalscreen\n            function normalscreen16(_self) {\n                rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.Normalscreen);\n            },\n            // websocket_send\n            function websocketSend17(self) {\n                const url = self.zerdeParser.parseString();\n                const data = self.zerdeParser.parseU8Slice();\n                self.websocketSend(url, data);\n            },\n            // enable_global_file_drop_target\n            function enableGlobalFileDropTarget18(self) {\n                self.enableGlobalFileDropTarget();\n            },\n            // call_js\n            function callJs19(self) {\n                const fnName = self.zerdeParser.parseString();\n                const params = self.zerdeParser.parseWrfParams();\n                if (fnName === \"_wrflibReturnParams\") {\n                    const callbackId = JSON.parse(params[0]);\n                    self.callRustPendingCallbacks[callbackId](params.slice(1));\n                    delete self.callRustPendingCallbacks[callbackId];\n                }\n                else {\n                    rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.CallJs, { fnName, params });\n                }\n            },\n        ];\n        this.module = wasmModule;\n        this.exports = wasmExports;\n        this.memory = memory;\n        this.baseUri = baseUri;\n        this.sizingData = sizingData;\n        this.timers = [];\n        this.resources = [];\n        this.hasRequestedAnimationFrame = false;\n        this.websockets = {};\n        this.fileHandles = fileHandles;\n        this.callRustNewCallbackId = 0;\n        this.callRustPendingCallbacks = {};\n        if (offscreenCanvas) {\n            this.webglRenderer = new _webgl_renderer__WEBPACK_IMPORTED_MODULE_5__.WebGLRenderer(offscreenCanvas, this.memory, this.sizingData, () => {\n                rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.ShowIncompatibleBrowserNotification);\n            });\n        }\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.ScreenResize, (sizingData) => {\n            this.sizingData = sizingData;\n            if (this.webglRenderer) {\n                this.webglRenderer.resize(this.sizingData);\n            }\n            this.zerdeEventloopEvents.resize({\n                width: this.sizingData.width,\n                height: this.sizingData.height,\n                dpiFactor: this.sizingData.dpiFactor,\n                xrIsPresenting: this.xrIsPresenting,\n                xrCanPresent: this.xrCanPresent,\n                isFullscreen: this.sizingData.isFullscreen,\n            });\n            this.requestAnimationFrame();\n        });\n        // this.run_async_webxr_check();\n        this.bindMouseAndTouch();\n        this.bindKeyboard();\n        this.appPtr = this.exports.createWasmApp();\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.WindowFocus, () => {\n            this.zerdeEventloopEvents.windowFocus(true);\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.WindowBlur, () => {\n            this.zerdeEventloopEvents.windowFocus(false);\n            this.doWasmIo();\n        });\n        const callRust = ({ name, params, }) => {\n            const callbackId = this.callRustNewCallbackId++;\n            const promise = new Promise((resolve, _reject) => {\n                this.callRustPendingCallbacks[callbackId] = (data) => {\n                    // TODO(Dmitry): implement retrun_error on rust side and use reject(...) to communicate the error\n                    resolve(data);\n                };\n            });\n            this.zerdeEventloopEvents.callRust(name, params, callbackId);\n            this.doWasmIo();\n            return promise;\n        };\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.CallRust, callRust);\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.CreateBuffer, (data) => this.zerdeEventloopEvents.createWasmBuffer(data));\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.CreateReadOnlyBuffer, (data) => {\n            const bufferPtr = this.zerdeEventloopEvents.createWasmBuffer(data);\n            const arcPtr = this.zerdeEventloopEvents.createArcVec(bufferPtr, data);\n            return { bufferPtr, arcPtr };\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.IncrementArc, (arcPtr) => {\n            this.exports.incrementArc(BigInt(arcPtr));\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.DecrementArc, (arcPtr) => {\n            this.exports.decrementArc(BigInt(arcPtr));\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.DeallocVec, ({ bufferPtr, bufferLen, bufferCap }) => {\n            this.exports.deallocVec(BigInt(bufferPtr), BigInt(bufferLen), BigInt(bufferCap));\n        });\n        const bindMainWorkerPort = (port) => {\n            const userWorkerRpc = new _common__WEBPACK_IMPORTED_MODULE_1__.Rpc(port);\n            userWorkerRpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.MainWorkerChannelEvent.Init, () => ({\n                wasmModule: this.module,\n                memory: this.memory,\n                taskWorkerSab,\n                appPtr: this.appPtr,\n                baseUri,\n                tlsAndStackData: (0,_common__WEBPACK_IMPORTED_MODULE_1__.makeThreadLocalStorageAndStackDataOnExistingThread)(this.exports),\n            }));\n            userWorkerRpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.MainWorkerChannelEvent.BindMainWorkerPort, (port) => {\n                bindMainWorkerPort(port);\n            });\n            userWorkerRpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.MainWorkerChannelEvent.CallRust, callRust);\n            userWorkerRpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.MainWorkerChannelEvent.SendEventFromAnyThread, (eventPtr) => {\n                this.sendEventFromAnyThread(eventPtr);\n            });\n        };\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.BindMainWorkerPort, (port) => {\n            bindMainWorkerPort(port);\n        });\n        // create initial zerdeEventloopEvents\n        this.zerdeEventloopEvents = new _zerde_eventloop_events__WEBPACK_IMPORTED_MODULE_3__.ZerdeEventloopEvents(this);\n        // fetch dependencies\n        this.zerdeEventloopEvents.fetchDeps();\n        this.doWasmIo();\n        this.doWasmBlock = true;\n        // ok now, we wait for our resources to load.\n        Promise.all(this.resources).then(this.doDepResults.bind(this));\n    }\n    doDepResults(results) {\n        const deps = [];\n        // copy our reslts into wasm pointers\n        for (let i = 0; i < results.length; i++) {\n            const result = results[i];\n            // allocate pointer, do +8 because of the u64 length at the head of the buffer\n            const vecLen = result.buffer.byteLength;\n            const vecPtr = this.zerdeEventloopEvents.createWasmBuffer(new Uint8Array(result.buffer));\n            deps.push({\n                name: result.name,\n                vecPtr,\n                vecLen,\n            });\n        }\n        // pass wasm the deps\n        this.zerdeEventloopEvents.depsLoaded(deps);\n        // initialize the application\n        this.zerdeEventloopEvents.init({\n            width: this.sizingData.width,\n            height: this.sizingData.height,\n            dpiFactor: this.sizingData.dpiFactor,\n            xrCanPresent: this.xrCanPresent,\n            canFullscreen: this.sizingData.canFullscreen,\n            xrIsPresenting: false,\n        });\n        this.doWasmBlock = false;\n        this.doWasmIo();\n        rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.RemoveLoadingIndicators);\n    }\n    doWasmIo() {\n        if (this.doWasmBlock) {\n            return;\n        }\n        const byteOffset = this.zerdeEventloopEvents.end();\n        const zerdeParserPtr = Number(this.exports.processWasmEvents(this.appPtr, BigInt(byteOffset)));\n        // get a clean zerdeEventloopEvents set up immediately\n        this.zerdeEventloopEvents = new _zerde_eventloop_events__WEBPACK_IMPORTED_MODULE_3__.ZerdeEventloopEvents(this);\n        this.zerdeParser = new _zerde__WEBPACK_IMPORTED_MODULE_2__.ZerdeParser(this.memory, zerdeParserPtr);\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            const msgType = this.zerdeParser.parseU32();\n            if (this.sendFnTable[msgType](this)) {\n                break;\n            }\n        }\n        this.exports.deallocWasmMessage(BigInt(zerdeParserPtr));\n    }\n    // TODO(JP): Should use sychronous file loading for this.\n    loadDeps(deps) {\n        for (let i = 0; i < deps.length; i++) {\n            const filePath = deps[i];\n            this.resources.push(this.fetchPath(filePath));\n        }\n    }\n    setDocumentTitle(title) {\n        rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.SetDocumentTitle, title);\n    }\n    bindMouseAndTouch() {\n        let lastMouseFinger;\n        // TODO(JP): Some day bring back touch scroll support..\n        // let use_touch_scroll_overlay = window.ontouchstart === null;\n        // if (use_touch_scroll_overlay) {\n        //     var ts = this.touch_scroll_overlay = document.createElement('div')\n        //     ts.className = \"cx_webgl_scroll_overlay\"\n        //     var ts_inner = document.createElement('div')\n        //     var style = document.createElement('style')\n        //     style.innerHTML = \"\\n\"\n        //         + \"div.cx_webgl_scroll_overlay {\\n\"\n        //         + \"z-index: 10000;\\n\"\n        //         + \"margin:0;\\n\"\n        //         + \"overflow:scroll;\\n\"\n        //         + \"top:0;\\n\"\n        //         + \"left:0;\\n\"\n        //         + \"width:100%;\\n\"\n        //         + \"height:100%;\\n\"\n        //         + \"position:fixed;\\n\"\n        //         + \"background-color:transparent\\n\"\n        //         + \"}\\n\"\n        //         + \"div.cx_webgl_scroll_overlay div{\\n\"\n        //         + \"margin:0;\\n\"\n        //         + \"width:400000px;\\n\"\n        //         + \"height:400000px;\\n\"\n        //         + \"background-color:transparent\\n\"\n        //         + \"}\\n\"\n        //     document.body.appendChild(style)\n        //     ts.appendChild(ts_inner);\n        //     document.body.appendChild(ts);\n        //     canvas = ts;\n        //     ts.scrollTop = 200000;\n        //     ts.scrollLeft = 200000;\n        //     let last_scroll_top = ts.scrollTop;\n        //     let last_scroll_left = ts.scrollLeft;\n        //     let scroll_timeout = null;\n        //     ts.addEventListener('scroll', e => {\n        //         let new_scroll_top = ts.scrollTop;\n        //         let new_scroll_left = ts.scrollLeft;\n        //         let dx = new_scroll_left - last_scroll_left;\n        //         let dy = new_scroll_top - last_scroll_top;\n        //         last_scroll_top = new_scroll_top;\n        //         last_scroll_left = new_scroll_left;\n        //         self.clearTimeout(scroll_timeout);\n        //         scroll_timeout = self.setTimeout(_ => {\n        //             ts.scrollTop = 200000;\n        //             ts.scrollLeft = 200000;\n        //             last_scroll_top = ts.scrollTop;\n        //             last_scroll_left = ts.scrollLeft;\n        //         }, 200);\n        //         let finger = last_mouse_finger;\n        //         if (finger) {\n        //             finger.scroll_x = dx;\n        //             finger.scroll_y = dy;\n        //             finger.is_wheel = true;\n        //             this.zerdeEventloopEvents.finger_scroll(finger);\n        //             this.do_wasm_io();\n        //         }\n        //     })\n        // }\n        const mouseFingers = [];\n        function mouseToFinger(e) {\n            // @ts-ignore; TypeScript does not like the empty object declaration below, but we immediately fill every field\n            const mf = mouseFingers[e.button] || (mouseFingers[e.button] = {});\n            mf.x = e.pageX;\n            mf.y = e.pageY;\n            mf.button = e.button;\n            mf.digit = e.button;\n            mf.time = performance.now() / 1000.0;\n            mf.modifiers = (0,_zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_4__.packKeyModifier)(e);\n            mf.touch = false;\n            return mf;\n        }\n        const mouseButtonsDown = [];\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.CanvasMouseDown, (event) => {\n            mouseButtonsDown[event.button] = true;\n            this.zerdeEventloopEvents.fingerDown(mouseToFinger(event));\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.WindowMouseUp, (event) => {\n            mouseButtonsDown[event.button] = false;\n            this.zerdeEventloopEvents.fingerUp(mouseToFinger(event));\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.WindowMouseMove, (event) => {\n            for (let i = 0; i < mouseButtonsDown.length; i++) {\n                if (mouseButtonsDown[i]) {\n                    const mf = mouseToFinger(event);\n                    mf.digit = i;\n                    this.zerdeEventloopEvents.fingerMove(mf);\n                }\n            }\n            lastMouseFinger = mouseToFinger(event);\n            this.zerdeEventloopEvents.fingerHover(lastMouseFinger);\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.WindowMouseOut, (event) => {\n            this.zerdeEventloopEvents.fingerOut(mouseToFinger(event));\n            this.doWasmIo();\n        });\n        const touchIdsByDigit = [];\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.WindowTouchStart, (event) => {\n            for (const touch of event.changedTouches) {\n                let digit = touchIdsByDigit.indexOf(undefined);\n                if (digit === -1) {\n                    digit = touchIdsByDigit.length;\n                }\n                touchIdsByDigit[digit] = touch.identifier;\n                this.zerdeEventloopEvents.fingerDown({\n                    x: touch.pageX,\n                    y: touch.pageY,\n                    button: 0,\n                    digit,\n                    time: performance.now() / 1000.0,\n                    modifiers: (0,_zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_4__.packKeyModifier)(event),\n                    touch: true,\n                });\n            }\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.WindowTouchMove, (event) => {\n            for (const touch of event.changedTouches) {\n                const digit = touchIdsByDigit.indexOf(touch.identifier);\n                if (digit == -1) {\n                    console.error(\"Unrecognized digit in WorkerEvent.WindowTouchMove\");\n                    continue;\n                }\n                this.zerdeEventloopEvents.fingerMove({\n                    x: touch.pageX,\n                    y: touch.pageY,\n                    button: 0,\n                    digit,\n                    time: performance.now() / 1000.0,\n                    modifiers: (0,_zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_4__.packKeyModifier)(event),\n                    touch: true,\n                });\n            }\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.WindowTouchEndCancelLeave, (event) => {\n            for (const touch of event.changedTouches) {\n                const digit = touchIdsByDigit.indexOf(touch.identifier);\n                if (digit == -1) {\n                    console.error(\"Unrecognized digit in WorkerEvent.WindowTouchMove\");\n                    continue;\n                }\n                touchIdsByDigit[digit] = undefined;\n                this.zerdeEventloopEvents.fingerUp({\n                    x: touch.pageX,\n                    y: touch.pageY,\n                    button: 0,\n                    digit,\n                    time: performance.now() / 1000.0,\n                    modifiers: (0,_zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_4__.packKeyModifier)(event),\n                    touch: true,\n                });\n            }\n            this.doWasmIo();\n        });\n        let lastWheelTime;\n        let lastWasWheel;\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.CanvasWheel, (event) => {\n            const finger = mouseToFinger(event);\n            const delta = event.timeStamp - lastWheelTime;\n            lastWheelTime = event.timeStamp;\n            // typical web bullshit. this reliably detects mousewheel or touchpad on mac in safari\n            if (isFirefox) {\n                lastWasWheel = event.deltaMode == 1;\n            }\n            else {\n                // detect it\n                if (\n                // @ts-ignore: TODO(Paras): wheelDeltaY looks different between browsers. Figure out a more consistent interface.\n                Math.abs(Math.abs(event.deltaY / event.wheelDeltaY) - 1 / 3) <\n                    0.00001 ||\n                    (!lastWasWheel && delta < 250)) {\n                    lastWasWheel = false;\n                }\n                else {\n                    lastWasWheel = true;\n                }\n            }\n            //console.log(event.deltaY / event.wheelDeltaY);\n            //last_delta = delta;\n            let fac = 1;\n            if (event.deltaMode === 1) {\n                fac = 40;\n            }\n            else if (event.deltaMode === 2) {\n                // TODO(Paras): deltaMode=2 means that a user is trying to scroll one page at a time.\n                // For now, we hardcode the pixel amount. We can later determine this contextually.\n                const offsetHeight = 800;\n                fac = offsetHeight;\n            }\n            const fingerScroll = Object.assign(Object.assign({}, finger), { scrollX: event.deltaX * fac, scrollY: event.deltaY * fac, isWheel: lastWasWheel });\n            this.zerdeEventloopEvents.fingerScroll(fingerScroll);\n            this.doWasmIo();\n        });\n        //window.addEventListener('webkitmouseforcewillbegin', this.onCheckMacForce.bind(this), false)\n        //window.addEventListener('webkitmouseforcechanged', this.onCheckMacForce.bind(this), false)\n    }\n    bindKeyboard() {\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.TextInput, (data) => {\n            this.zerdeEventloopEvents.textInput(data);\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.TextCopy, () => {\n            this.zerdeEventloopEvents.textCopy();\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.KeyDown, (data) => {\n            this.zerdeEventloopEvents.keyDown(data);\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.KeyUp, (data) => {\n            this.zerdeEventloopEvents.keyUp(data);\n            this.doWasmIo();\n        });\n    }\n    setMouseCursor(id) {\n        rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.SetMouseCursor, _cursor_map__WEBPACK_IMPORTED_MODULE_0__.cursorMap[id] || \"default\");\n    }\n    startTimer(id, interval, repeats) {\n        for (let i = 0; i < this.timers.length; i++) {\n            if (this.timers[i].id == id) {\n                console.log(\"Timer ID collision!\");\n                return;\n            }\n        }\n        const sysId = repeats !== 0\n            ? self.setInterval(() => {\n                this.zerdeEventloopEvents.timerFired(id);\n                this.doWasmIo();\n            }, interval * 1000.0)\n            : self.setTimeout(() => {\n                for (let i = 0; i < this.timers.length; i++) {\n                    const timer = this.timers[i];\n                    if (timer.id == id) {\n                        this.timers.splice(i, 1);\n                        break;\n                    }\n                }\n                this.zerdeEventloopEvents.timerFired(id);\n                this.doWasmIo();\n            }, interval * 1000.0);\n        this.timers.push({ id, repeats, sysId });\n    }\n    stopTimer(id) {\n        for (let i = 0; i < this.timers.length; i++) {\n            const timer = this.timers[i];\n            if (timer.id == id) {\n                if (timer.repeats) {\n                    self.clearInterval(timer.sysId);\n                }\n                else {\n                    self.clearTimeout(timer.sysId);\n                }\n                this.timers.splice(i, 1);\n                return;\n            }\n        }\n        //console.log(\"Timer ID not found!\")\n    }\n    httpSend(verb, path, proto, domain, port, contentType, body, signalId) {\n        const req = new XMLHttpRequest();\n        req.addEventListener(\"error\", (_) => {\n            // signal fail\n            this.zerdeEventloopEvents.httpSendResponse(signalId, 2);\n            this.doWasmIo();\n        });\n        req.addEventListener(\"load\", (_) => {\n            if (req.status !== 200) {\n                // signal fail\n                this.zerdeEventloopEvents.httpSendResponse(signalId, 2);\n            }\n            else {\n                //signal success\n                this.zerdeEventloopEvents.httpSendResponse(signalId, 1);\n            }\n            this.doWasmIo();\n        });\n        req.open(verb, proto + \"://\" + domain + \":\" + port + path, true);\n        console.log(verb, proto + \"://\" + domain + \":\" + port + path, body);\n        req.send(body.buffer);\n    }\n    websocketSend(url, data) {\n        // TODO(Paras): Stop patching sendStack onto websockets\n        // and maintain our own structure instead.\n        const socket = this.websockets[url];\n        if (!socket) {\n            const socket = new WebSocket(url);\n            this.websockets[url] = socket;\n            socket.sendStack = [data];\n            socket.addEventListener(\"close\", () => {\n                this.websockets[url] = null;\n            });\n            socket.addEventListener(\"error\", (event) => {\n                this.websockets[url] = null;\n                this.zerdeEventloopEvents.websocketError(url, \"\" + event);\n                this.doWasmIo();\n            });\n            socket.addEventListener(\"message\", (event) => {\n                event.data.arrayBuffer().then((data) => {\n                    this.zerdeEventloopEvents.websocketMessage(url, data);\n                    this.doWasmIo();\n                });\n            });\n            socket.addEventListener(\"open\", () => {\n                const sendStack = socket.sendStack;\n                socket.sendStack = null;\n                for (data of sendStack) {\n                    socket.send(data);\n                }\n            });\n        }\n        else {\n            if (socket.sendStack) {\n                socket.sendStack.push(data);\n            }\n            else {\n                socket.send(data);\n            }\n        }\n    }\n    enableGlobalFileDropTarget() {\n        rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.EnableGlobalFileDropTarget);\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.DragEnter, () => {\n            this.zerdeEventloopEvents.dragenter();\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.DragOver, ({ x, y }) => {\n            this.zerdeEventloopEvents.dragover(x, y);\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.DragLeave, () => {\n            this.zerdeEventloopEvents.dragleave();\n            this.doWasmIo();\n        });\n        rpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.Drop, ({ fileHandles, fileHandlesToSend, }) => {\n            // We can't set this.fileHandles to a new object, since other places hold\n            // references to it. Instead, clear it out and fill it up again.\n            this.fileHandles.splice(0, this.fileHandles.length);\n            this.fileHandles.push(...fileHandles);\n            this.zerdeEventloopEvents.appOpenFiles(fileHandlesToSend);\n            this.doWasmIo();\n        });\n    }\n    requestAnimationFrame() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.xrIsPresenting || this.hasRequestedAnimationFrame) {\n                return;\n            }\n            this.hasRequestedAnimationFrame = true;\n            if (this.runWebGLPromise) {\n                yield this.runWebGLPromise;\n            }\n            (self.requestAnimationFrame || self.setTimeout)(() => __awaiter(this, void 0, void 0, function* () {\n                if (this.runWebGLPromise) {\n                    yield this.runWebGLPromise;\n                }\n                this.hasRequestedAnimationFrame = false;\n                if (this.xrIsPresenting) {\n                    return;\n                }\n                this.zerdeEventloopEvents.animationFrame();\n                this.doWasmIo();\n            }));\n        });\n    }\n    // private runAsyncWebXRCheck(): void {\n    //   this.xrCanPresent = false;\n    //   this.xrIsPresenting = false;\n    //   // ok this changes a bunch in how the renderflow works.\n    //   // first thing we are going to do is get the vr displays.\n    //   // @ts-ignore - Let's not worry about XR.\n    //   const xrSystem = self.navigator.xr;\n    //   if (xrSystem) {\n    //     xrSystem.isSessionSupported(\"immersive-vr\").then((supported) => {\n    //       if (supported) {\n    //         this.xrCanPresent = true;\n    //       }\n    //     });\n    //   } else {\n    //     console.log(\"No webVR support found\");\n    //   }\n    // }\n    xrStartPresenting() {\n        // TODO(JP): Some day bring back XR support?\n        // if (this.xr_can_present) {\n        //     navigator.xr.requestSession('immersive-vr', {requiredFeatures: ['local-floor']}).then(xr_session => {\n        //         let xr_layer = new XRWebGLLayer(xr_session, this.gl, {\n        //             antialias: false,\n        //             depth: true,\n        //             stencil: false,\n        //             alpha: false,\n        //             ignoreDepthValues: false,\n        //             framebufferScaleFactor: 1.5\n        //         });\n        //         xr_session.updateRenderState({baseLayer: xr_layer});\n        //         xr_session.requestReferenceSpace(\"local-floor\").then(xr_reference_space => {\n        //             window.localStorage.setItem(\"xr_presenting\", \"true\");\n        //             this.xr_reference_space = xr_reference_space;\n        //             this.xr_session = xr_session;\n        //             this.xr_is_presenting = true;\n        //             let first_on_resize = true;\n        //             // read shit off the gamepad\n        //             xr_session.gamepad;\n        //             // lets start the loop\n        //             let inputs = [];\n        //             let alternate = false;\n        //             let last_time;\n        //             let xr_on_request_animation_frame = (time, xr_frame) => {\n        //                 if (first_on_resize) {\n        //                     this.on_screen_resize();\n        //                     first_on_resize = false;\n        //                 }\n        //                 if (!this.xr_is_presenting) {\n        //                     return;\n        //                 }\n        //                 this.xr_session.requestAnimationFrame(xr_on_request_animation_frame);\n        //                 this.xr_pose = xr_frame.getViewerPose(this.xr_reference_space);\n        //                 if (!this.xr_pose) {\n        //                     return;\n        //                 }\n        //                 this.zerdeEventloopEvents.xr_update_inputs(xr_frame, xr_session, time, this.xr_pose, this.xr_reference_space)\n        //                 this.zerdeEventloopEvents.animation_frame(time / 1000.0);\n        //                 this.in_animation_frame = true;\n        //                 let start = performance.now();\n        //                 this.do_wasm_io();\n        //                 this.in_animation_frame = false;\n        //                 this.xr_pose = null;\n        //                 //let new_time = performance.now();\n        //                 //if (new_time - last_time > 13.) {\n        //                 //    console.log(new_time - last_time);\n        //                 // }\n        //                 //last_time = new_time;\n        //             }\n        //             this.xr_session.requestAnimationFrame(xr_on_request_animation_frame);\n        //             this.xr_session.addEventListener(\"end\", () => {\n        //                 window.localStorage.setItem(\"xr_presenting\", \"false\");\n        //                 this.xr_is_presenting = false;\n        //                 this.on_screen_resize();\n        //                 this.zerdeEventloopEvents.paint_dirty();\n        //                 this.request_animation_frame();\n        //             })\n        //         })\n        //     })\n        // }\n    }\n    xrStopPresenting() {\n        // ignore for now\n    }\n    // TODO(JP): Should use sychronous file loading for this.\n    fetchPath(filePath) {\n        return new Promise((resolve, reject) => {\n            const req = new XMLHttpRequest();\n            req.addEventListener(\"error\", function () {\n                reject(filePath);\n            });\n            req.responseType = \"arraybuffer\";\n            req.addEventListener(\"load\", function () {\n                if (req.status !== 200) {\n                    reject(req.status);\n                }\n                resolve({\n                    name: filePath,\n                    buffer: req.response,\n                });\n            });\n            req.open(\"GET\", new URL(filePath, this.baseUri).href);\n            req.send();\n        });\n    }\n    sendEventFromAnyThread(eventPtr) {\n        // Prevent an infinite loop when calling this from an event handler.\n        setTimeout(() => {\n            this.zerdeEventloopEvents.sendEventFromAnyThread(eventPtr);\n            this.doWasmIo();\n        });\n    }\n}\nrpc.receive(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.Init, ({ wasmModule, offscreenCanvas, sizingData, baseUri, memory, taskWorkerSab, }) => {\n    let wasmapp;\n    return new Promise((resolve, reject) => {\n        const threadSpawn = (ctxPtr) => {\n            rpc.send(_rpc_types__WEBPACK_IMPORTED_MODULE_6__.WorkerEvent.ThreadSpawn, {\n                ctxPtr,\n                tlsAndStackData: (0,_common__WEBPACK_IMPORTED_MODULE_1__.makeThreadLocalStorageAndStackDataOnExistingThread)(wasmapp.exports),\n            });\n        };\n        const getExports = () => {\n            return wasmapp.exports;\n        };\n        const fileHandles = [];\n        const env = (0,_common__WEBPACK_IMPORTED_MODULE_1__.getWasmEnv)({\n            getExports,\n            memory,\n            taskWorkerSab,\n            fileHandles,\n            sendEventFromAnyThread: (eventPtr) => {\n                wasmapp.sendEventFromAnyThread(eventPtr);\n            },\n            threadSpawn,\n            baseUri,\n        });\n        WebAssembly.instantiate(wasmModule, { env }).then((instance) => {\n            const wasmExports = instance.exports;\n            (0,_common__WEBPACK_IMPORTED_MODULE_1__.initThreadLocalStorageMainWorker)(wasmExports);\n            wasmapp = new WasmApp({\n                offscreenCanvas,\n                wasmModule,\n                wasmExports,\n                memory,\n                sizingData,\n                baseUri,\n                fileHandles,\n                taskWorkerSab,\n            });\n            resolve();\n        }, reject);\n    });\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi93cmZfd2FzbV93b3JrZXIudHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd3JmLy4vd3JmX3dhc21fd29ya2VyLnRzP2ZmMTUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDIxLXByZXNlbnQsIENydWlzZSBMTENcbi8vXG4vLyBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAsXG4vLyBmb3VuZCBpbiB0aGUgTElDRU5TRS1BUEFDSEUgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbi8vIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuaW1wb3J0IHsgY3Vyc29yTWFwIH0gZnJvbSBcIi4vY3Vyc29yX21hcFwiO1xuaW1wb3J0IHsgUnBjLCBnZXRXYXNtRW52LCBtYWtlVGhyZWFkTG9jYWxTdG9yYWdlQW5kU3RhY2tEYXRhT25FeGlzdGluZ1RocmVhZCwgaW5pdFRocmVhZExvY2FsU3RvcmFnZU1haW5Xb3JrZXIsIH0gZnJvbSBcIi4vY29tbW9uXCI7XG5pbXBvcnQgeyBaZXJkZVBhcnNlciB9IGZyb20gXCIuL3plcmRlXCI7XG5pbXBvcnQgeyBaZXJkZUV2ZW50bG9vcEV2ZW50cyB9IGZyb20gXCIuL3plcmRlX2V2ZW50bG9vcF9ldmVudHNcIjtcbmltcG9ydCB7IHBhY2tLZXlNb2RpZmllciB9IGZyb20gXCIuL3plcmRlX2tleWJvYXJkX2hhbmRsZXJzXCI7XG5pbXBvcnQgeyBXZWJHTFJlbmRlcmVyIH0gZnJvbSBcIi4vd2ViZ2xfcmVuZGVyZXJcIjtcbmltcG9ydCB7IFdvcmtlckV2ZW50LCBNYWluV29ya2VyQ2hhbm5lbEV2ZW50LCB9IGZyb20gXCIuL3JwY190eXBlc1wiO1xuY29uc3QgcnBjID0gbmV3IFJwYyhzZWxmKTtcbmNvbnN0IGlzRmlyZWZveCA9IHNlbGYubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJmaXJlZm94XCIpID4gLTE7XG5leHBvcnQgY2xhc3MgV2FzbUFwcCB7XG4gICAgY29uc3RydWN0b3IoeyBvZmZzY3JlZW5DYW52YXMsIHdhc21Nb2R1bGUsIHdhc21FeHBvcnRzLCBtZW1vcnksIHNpemluZ0RhdGEsIGJhc2VVcmksIGZpbGVIYW5kbGVzLCB0YXNrV29ya2VyU2FiLCB9KSB7XG4gICAgICAgIHRoaXMueHJDYW5QcmVzZW50ID0gZmFsc2U7XG4gICAgICAgIHRoaXMueHJJc1ByZXNlbnRpbmcgPSBmYWxzZTtcbiAgICAgICAgLy8gQXJyYXkgb2YgZnVuY3Rpb24gaWQncyB3YXNtIGNhbiBjYWxsIG9uIHVzOyBgc2VsZmAgaXMgcG9pbnRlciB0byBXYXNtQXBwLlxuICAgICAgICAvLyBGdW5jdGlvbiBuYW1lcyBhcmUgc3VmZml4ZWQgd2l0aCB0aGUgaW5kZXggaW4gdGhlIGFycmF5LCBhbmQgYW5ub3RhdGVkIHdpdGhcbiAgICAgICAgLy8gdGhlaXIgbmFtZSBpbiBjeF93YXNtMzIucnMsIGZvciBlYXNpZXIgbWF0Y2hpbmcuXG4gICAgICAgIHRoaXMuc2VuZEZuVGFibGUgPSBbXG4gICAgICAgICAgICAvLyBlbmRcbiAgICAgICAgICAgIGZ1bmN0aW9uIGVuZDAoX3NlbGYpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBydW5fd2ViZ2xcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJ1bldlYkdMMShzZWxmKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgemVyZGVQYXJzZXJQdHIgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTY0KCk7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYud2ViZ2xSZW5kZXJlcikge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLndlYmdsUmVuZGVyZXIucHJvY2Vzc01lc3NhZ2VzKE51bWJlcih6ZXJkZVBhcnNlclB0cikpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmV4cG9ydHMuZGVhbGxvY1dhc21NZXNzYWdlKHplcmRlUGFyc2VyUHRyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYucnVuV2ViR0xQcm9taXNlID0gcnBjXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2VuZChXb3JrZXJFdmVudC5SdW5XZWJHTCwgTnVtYmVyKHplcmRlUGFyc2VyUHRyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZXhwb3J0cy5kZWFsbG9jV2FzbU1lc3NhZ2UoemVyZGVQYXJzZXJQdHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ydW5XZWJHTFByb21pc2UgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBsb2dcbiAgICAgICAgICAgIGZ1bmN0aW9uIGxvZzIoc2VsZikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlbGYuemVyZGVQYXJzZXIucGFyc2VTdHJpbmcoKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gbG9hZF9kZXBzXG4gICAgICAgICAgICBmdW5jdGlvbiBsb2FkRGVwczMoc2VsZikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlcHMgPSBbXTtcbiAgICAgICAgICAgICAgICBjb25zdCBudW1EZXBzID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVUzMigpO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRGVwczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlcHMucHVzaChzZWxmLnplcmRlUGFyc2VyLnBhcnNlU3RyaW5nKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZWxmLmxvYWREZXBzKGRlcHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIHJlcXVlc3RfYW5pbWF0aW9uX2ZyYW1lXG4gICAgICAgICAgICBmdW5jdGlvbiByZXF1ZXN0QW5pbWF0aW9uRnJhbWU0KHNlbGYpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnJlcXVlc3RBbmltYXRpb25GcmFtZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIHNldF9kb2N1bWVudF90aXRsZVxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0RG9jdW1lbnRUaXRsZTUoc2VsZikge1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0RG9jdW1lbnRUaXRsZShzZWxmLnplcmRlUGFyc2VyLnBhcnNlU3RyaW5nKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIHNldF9tb3VzZV9jdXJzb3JcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldE1vdXNlQ3Vyc29yNihzZWxmKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXRNb3VzZUN1cnNvcihzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIHNob3dfdGV4dF9pbWVcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNob3dUZXh0SW1lNyhzZWxmKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VGMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB5ID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZUYzMigpO1xuICAgICAgICAgICAgICAgIHJwYy5zZW5kKFdvcmtlckV2ZW50LlNob3dUZXh0SU1FLCB7IHgsIHkgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gaGlkZV90ZXh0X2ltZVxuICAgICAgICAgICAgZnVuY3Rpb24gaGlkZVRleHRJbWU4KF9zZWxmKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhKUCk6IGRvZXNuJ3Qgc2VlbSB0byBkbyBhbnl0aGluZywgaXMgdGhhdCBpbnRlbnRpb25hbD9cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyB0ZXh0X2NvcHlfcmVzcG9uc2VcbiAgICAgICAgICAgIGZ1bmN0aW9uIHRleHRDb3B5UmVzcG9uc2U5KHNlbGYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0Q29weVJlc3BvbnNlID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVN0cmluZygpO1xuICAgICAgICAgICAgICAgIHJwYy5zZW5kKFdvcmtlckV2ZW50LlRleHRDb3B5UmVzcG9uc2UsIHRleHRDb3B5UmVzcG9uc2UpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIHN0YXJ0X3RpbWVyXG4gICAgICAgICAgICBmdW5jdGlvbiBzdGFydFRpbWVyMTAoc2VsZikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcGVhdHMgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVTMyKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaWQgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlRjY0KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlRjY0KCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zdGFydFRpbWVyKGlkLCBpbnRlcnZhbCwgcmVwZWF0cyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gc3RvcF90aW1lclxuICAgICAgICAgICAgZnVuY3Rpb24gc3RvcFRpbWVyMTEoc2VsZikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZUY2NCgpO1xuICAgICAgICAgICAgICAgIHNlbGYuc3RvcFRpbWVyKGlkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyB4cl9zdGFydF9wcmVzZW50aW5nXG4gICAgICAgICAgICBmdW5jdGlvbiB4clN0YXJ0UHJlc2VudGluZzEyKHNlbGYpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnhyU3RhcnRQcmVzZW50aW5nKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8geHJfc3RvcF9wcmVzZW50aW5nXG4gICAgICAgICAgICBmdW5jdGlvbiB4clN0b3BQcmVzZW50aW5nMTMoc2VsZikge1xuICAgICAgICAgICAgICAgIHNlbGYueHJTdG9wUHJlc2VudGluZygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGh0dHBfc2VuZFxuICAgICAgICAgICAgZnVuY3Rpb24gaHR0cFNlbmQxNChzZWxmKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9ydCA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzaWduYWxJZCA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2ZXJiID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVN0cmluZygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhdGggPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvdG8gPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZG9tYWluID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVN0cmluZygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gc2VsZi56ZXJkZVBhcnNlci5wYXJzZVN0cmluZygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlVThTbGljZSgpO1xuICAgICAgICAgICAgICAgIHNlbGYuaHR0cFNlbmQodmVyYiwgcGF0aCwgcHJvdG8sIGRvbWFpbiwgcG9ydCwgY29udGVudFR5cGUsIGJvZHksIHNpZ25hbElkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBmdWxsc2NyZWVuXG4gICAgICAgICAgICBmdW5jdGlvbiBmdWxsc2NyZWVuMTUoX3NlbGYpIHtcbiAgICAgICAgICAgICAgICBycGMuc2VuZChXb3JrZXJFdmVudC5GdWxsc2NyZWVuKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBub3JtYWxzY3JlZW5cbiAgICAgICAgICAgIGZ1bmN0aW9uIG5vcm1hbHNjcmVlbjE2KF9zZWxmKSB7XG4gICAgICAgICAgICAgICAgcnBjLnNlbmQoV29ya2VyRXZlbnQuTm9ybWFsc2NyZWVuKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyB3ZWJzb2NrZXRfc2VuZFxuICAgICAgICAgICAgZnVuY3Rpb24gd2Vic29ja2V0U2VuZDE3KHNlbGYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VVOFNsaWNlKCk7XG4gICAgICAgICAgICAgICAgc2VsZi53ZWJzb2NrZXRTZW5kKHVybCwgZGF0YSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gZW5hYmxlX2dsb2JhbF9maWxlX2Ryb3BfdGFyZ2V0XG4gICAgICAgICAgICBmdW5jdGlvbiBlbmFibGVHbG9iYWxGaWxlRHJvcFRhcmdldDE4KHNlbGYpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmVuYWJsZUdsb2JhbEZpbGVEcm9wVGFyZ2V0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gY2FsbF9qc1xuICAgICAgICAgICAgZnVuY3Rpb24gY2FsbEpzMTkoc2VsZikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZuTmFtZSA9IHNlbGYuemVyZGVQYXJzZXIucGFyc2VTdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbXMgPSBzZWxmLnplcmRlUGFyc2VyLnBhcnNlV3JmUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgaWYgKGZuTmFtZSA9PT0gXCJfd3JmbGliUmV0dXJuUGFyYW1zXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FsbGJhY2tJZCA9IEpTT04ucGFyc2UocGFyYW1zWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsUnVzdFBlbmRpbmdDYWxsYmFja3NbY2FsbGJhY2tJZF0ocGFyYW1zLnNsaWNlKDEpKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHNlbGYuY2FsbFJ1c3RQZW5kaW5nQ2FsbGJhY2tzW2NhbGxiYWNrSWRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcnBjLnNlbmQoV29ya2VyRXZlbnQuQ2FsbEpzLCB7IGZuTmFtZSwgcGFyYW1zIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMubW9kdWxlID0gd2FzbU1vZHVsZTtcbiAgICAgICAgdGhpcy5leHBvcnRzID0gd2FzbUV4cG9ydHM7XG4gICAgICAgIHRoaXMubWVtb3J5ID0gbWVtb3J5O1xuICAgICAgICB0aGlzLmJhc2VVcmkgPSBiYXNlVXJpO1xuICAgICAgICB0aGlzLnNpemluZ0RhdGEgPSBzaXppbmdEYXRhO1xuICAgICAgICB0aGlzLnRpbWVycyA9IFtdO1xuICAgICAgICB0aGlzLnJlc291cmNlcyA9IFtdO1xuICAgICAgICB0aGlzLmhhc1JlcXVlc3RlZEFuaW1hdGlvbkZyYW1lID0gZmFsc2U7XG4gICAgICAgIHRoaXMud2Vic29ja2V0cyA9IHt9O1xuICAgICAgICB0aGlzLmZpbGVIYW5kbGVzID0gZmlsZUhhbmRsZXM7XG4gICAgICAgIHRoaXMuY2FsbFJ1c3ROZXdDYWxsYmFja0lkID0gMDtcbiAgICAgICAgdGhpcy5jYWxsUnVzdFBlbmRpbmdDYWxsYmFja3MgPSB7fTtcbiAgICAgICAgaWYgKG9mZnNjcmVlbkNhbnZhcykge1xuICAgICAgICAgICAgdGhpcy53ZWJnbFJlbmRlcmVyID0gbmV3IFdlYkdMUmVuZGVyZXIob2Zmc2NyZWVuQ2FudmFzLCB0aGlzLm1lbW9yeSwgdGhpcy5zaXppbmdEYXRhLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcnBjLnNlbmQoV29ya2VyRXZlbnQuU2hvd0luY29tcGF0aWJsZUJyb3dzZXJOb3RpZmljYXRpb24pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcnBjLnJlY2VpdmUoV29ya2VyRXZlbnQuU2NyZWVuUmVzaXplLCAoc2l6aW5nRGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zaXppbmdEYXRhID0gc2l6aW5nRGF0YTtcbiAgICAgICAgICAgIGlmICh0aGlzLndlYmdsUmVuZGVyZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLndlYmdsUmVuZGVyZXIucmVzaXplKHRoaXMuc2l6aW5nRGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLnJlc2l6ZSh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuc2l6aW5nRGF0YS53aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuc2l6aW5nRGF0YS5oZWlnaHQsXG4gICAgICAgICAgICAgICAgZHBpRmFjdG9yOiB0aGlzLnNpemluZ0RhdGEuZHBpRmFjdG9yLFxuICAgICAgICAgICAgICAgIHhySXNQcmVzZW50aW5nOiB0aGlzLnhySXNQcmVzZW50aW5nLFxuICAgICAgICAgICAgICAgIHhyQ2FuUHJlc2VudDogdGhpcy54ckNhblByZXNlbnQsXG4gICAgICAgICAgICAgICAgaXNGdWxsc2NyZWVuOiB0aGlzLnNpemluZ0RhdGEuaXNGdWxsc2NyZWVuLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnJlcXVlc3RBbmltYXRpb25GcmFtZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gdGhpcy5ydW5fYXN5bmNfd2VieHJfY2hlY2soKTtcbiAgICAgICAgdGhpcy5iaW5kTW91c2VBbmRUb3VjaCgpO1xuICAgICAgICB0aGlzLmJpbmRLZXlib2FyZCgpO1xuICAgICAgICB0aGlzLmFwcFB0ciA9IHRoaXMuZXhwb3J0cy5jcmVhdGVXYXNtQXBwKCk7XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LldpbmRvd0ZvY3VzLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLndpbmRvd0ZvY3VzKHRydWUpO1xuICAgICAgICAgICAgdGhpcy5kb1dhc21JbygpO1xuICAgICAgICB9KTtcbiAgICAgICAgcnBjLnJlY2VpdmUoV29ya2VyRXZlbnQuV2luZG93Qmx1ciwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy53aW5kb3dGb2N1cyhmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjYWxsUnVzdCA9ICh7IG5hbWUsIHBhcmFtcywgfSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2FsbGJhY2tJZCA9IHRoaXMuY2FsbFJ1c3ROZXdDYWxsYmFja0lkKys7XG4gICAgICAgICAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIF9yZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhbGxSdXN0UGVuZGluZ0NhbGxiYWNrc1tjYWxsYmFja0lkXSA9IChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8oRG1pdHJ5KTogaW1wbGVtZW50IHJldHJ1bl9lcnJvciBvbiBydXN0IHNpZGUgYW5kIHVzZSByZWplY3QoLi4uKSB0byBjb21tdW5pY2F0ZSB0aGUgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmNhbGxSdXN0KG5hbWUsIHBhcmFtcywgY2FsbGJhY2tJZCk7XG4gICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfTtcbiAgICAgICAgcnBjLnJlY2VpdmUoV29ya2VyRXZlbnQuQ2FsbFJ1c3QsIGNhbGxSdXN0KTtcbiAgICAgICAgcnBjLnJlY2VpdmUoV29ya2VyRXZlbnQuQ3JlYXRlQnVmZmVyLCAoZGF0YSkgPT4gdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5jcmVhdGVXYXNtQnVmZmVyKGRhdGEpKTtcbiAgICAgICAgcnBjLnJlY2VpdmUoV29ya2VyRXZlbnQuQ3JlYXRlUmVhZE9ubHlCdWZmZXIsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBidWZmZXJQdHIgPSB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmNyZWF0ZVdhc21CdWZmZXIoZGF0YSk7XG4gICAgICAgICAgICBjb25zdCBhcmNQdHIgPSB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmNyZWF0ZUFyY1ZlYyhidWZmZXJQdHIsIGRhdGEpO1xuICAgICAgICAgICAgcmV0dXJuIHsgYnVmZmVyUHRyLCBhcmNQdHIgfTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LkluY3JlbWVudEFyYywgKGFyY1B0cikgPT4ge1xuICAgICAgICAgICAgdGhpcy5leHBvcnRzLmluY3JlbWVudEFyYyhCaWdJbnQoYXJjUHRyKSk7XG4gICAgICAgIH0pO1xuICAgICAgICBycGMucmVjZWl2ZShXb3JrZXJFdmVudC5EZWNyZW1lbnRBcmMsIChhcmNQdHIpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZXhwb3J0cy5kZWNyZW1lbnRBcmMoQmlnSW50KGFyY1B0cikpO1xuICAgICAgICB9KTtcbiAgICAgICAgcnBjLnJlY2VpdmUoV29ya2VyRXZlbnQuRGVhbGxvY1ZlYywgKHsgYnVmZmVyUHRyLCBidWZmZXJMZW4sIGJ1ZmZlckNhcCB9KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmV4cG9ydHMuZGVhbGxvY1ZlYyhCaWdJbnQoYnVmZmVyUHRyKSwgQmlnSW50KGJ1ZmZlckxlbiksIEJpZ0ludChidWZmZXJDYXApKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGJpbmRNYWluV29ya2VyUG9ydCA9IChwb3J0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB1c2VyV29ya2VyUnBjID0gbmV3IFJwYyhwb3J0KTtcbiAgICAgICAgICAgIHVzZXJXb3JrZXJScGMucmVjZWl2ZShNYWluV29ya2VyQ2hhbm5lbEV2ZW50LkluaXQsICgpID0+ICh7XG4gICAgICAgICAgICAgICAgd2FzbU1vZHVsZTogdGhpcy5tb2R1bGUsXG4gICAgICAgICAgICAgICAgbWVtb3J5OiB0aGlzLm1lbW9yeSxcbiAgICAgICAgICAgICAgICB0YXNrV29ya2VyU2FiLFxuICAgICAgICAgICAgICAgIGFwcFB0cjogdGhpcy5hcHBQdHIsXG4gICAgICAgICAgICAgICAgYmFzZVVyaSxcbiAgICAgICAgICAgICAgICB0bHNBbmRTdGFja0RhdGE6IG1ha2VUaHJlYWRMb2NhbFN0b3JhZ2VBbmRTdGFja0RhdGFPbkV4aXN0aW5nVGhyZWFkKHRoaXMuZXhwb3J0cyksXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB1c2VyV29ya2VyUnBjLnJlY2VpdmUoTWFpbldvcmtlckNoYW5uZWxFdmVudC5CaW5kTWFpbldvcmtlclBvcnQsIChwb3J0KSA9PiB7XG4gICAgICAgICAgICAgICAgYmluZE1haW5Xb3JrZXJQb3J0KHBvcnQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB1c2VyV29ya2VyUnBjLnJlY2VpdmUoTWFpbldvcmtlckNoYW5uZWxFdmVudC5DYWxsUnVzdCwgY2FsbFJ1c3QpO1xuICAgICAgICAgICAgdXNlcldvcmtlclJwYy5yZWNlaXZlKE1haW5Xb3JrZXJDaGFubmVsRXZlbnQuU2VuZEV2ZW50RnJvbUFueVRocmVhZCwgKGV2ZW50UHRyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kRXZlbnRGcm9tQW55VGhyZWFkKGV2ZW50UHRyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBycGMucmVjZWl2ZShXb3JrZXJFdmVudC5CaW5kTWFpbldvcmtlclBvcnQsIChwb3J0KSA9PiB7XG4gICAgICAgICAgICBiaW5kTWFpbldvcmtlclBvcnQocG9ydCk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBjcmVhdGUgaW5pdGlhbCB6ZXJkZUV2ZW50bG9vcEV2ZW50c1xuICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzID0gbmV3IFplcmRlRXZlbnRsb29wRXZlbnRzKHRoaXMpO1xuICAgICAgICAvLyBmZXRjaCBkZXBlbmRlbmNpZXNcbiAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5mZXRjaERlcHMoKTtcbiAgICAgICAgdGhpcy5kb1dhc21JbygpO1xuICAgICAgICB0aGlzLmRvV2FzbUJsb2NrID0gdHJ1ZTtcbiAgICAgICAgLy8gb2sgbm93LCB3ZSB3YWl0IGZvciBvdXIgcmVzb3VyY2VzIHRvIGxvYWQuXG4gICAgICAgIFByb21pc2UuYWxsKHRoaXMucmVzb3VyY2VzKS50aGVuKHRoaXMuZG9EZXBSZXN1bHRzLmJpbmQodGhpcykpO1xuICAgIH1cbiAgICBkb0RlcFJlc3VsdHMocmVzdWx0cykge1xuICAgICAgICBjb25zdCBkZXBzID0gW107XG4gICAgICAgIC8vIGNvcHkgb3VyIHJlc2x0cyBpbnRvIHdhc20gcG9pbnRlcnNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSByZXN1bHRzW2ldO1xuICAgICAgICAgICAgLy8gYWxsb2NhdGUgcG9pbnRlciwgZG8gKzggYmVjYXVzZSBvZiB0aGUgdTY0IGxlbmd0aCBhdCB0aGUgaGVhZCBvZiB0aGUgYnVmZmVyXG4gICAgICAgICAgICBjb25zdCB2ZWNMZW4gPSByZXN1bHQuYnVmZmVyLmJ5dGVMZW5ndGg7XG4gICAgICAgICAgICBjb25zdCB2ZWNQdHIgPSB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmNyZWF0ZVdhc21CdWZmZXIobmV3IFVpbnQ4QXJyYXkocmVzdWx0LmJ1ZmZlcikpO1xuICAgICAgICAgICAgZGVwcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiByZXN1bHQubmFtZSxcbiAgICAgICAgICAgICAgICB2ZWNQdHIsXG4gICAgICAgICAgICAgICAgdmVjTGVuLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcGFzcyB3YXNtIHRoZSBkZXBzXG4gICAgICAgIHRoaXMuemVyZGVFdmVudGxvb3BFdmVudHMuZGVwc0xvYWRlZChkZXBzKTtcbiAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgYXBwbGljYXRpb25cbiAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5pbml0KHtcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLnNpemluZ0RhdGEud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuc2l6aW5nRGF0YS5oZWlnaHQsXG4gICAgICAgICAgICBkcGlGYWN0b3I6IHRoaXMuc2l6aW5nRGF0YS5kcGlGYWN0b3IsXG4gICAgICAgICAgICB4ckNhblByZXNlbnQ6IHRoaXMueHJDYW5QcmVzZW50LFxuICAgICAgICAgICAgY2FuRnVsbHNjcmVlbjogdGhpcy5zaXppbmdEYXRhLmNhbkZ1bGxzY3JlZW4sXG4gICAgICAgICAgICB4cklzUHJlc2VudGluZzogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRvV2FzbUJsb2NrID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgcnBjLnNlbmQoV29ya2VyRXZlbnQuUmVtb3ZlTG9hZGluZ0luZGljYXRvcnMpO1xuICAgIH1cbiAgICBkb1dhc21JbygpIHtcbiAgICAgICAgaWYgKHRoaXMuZG9XYXNtQmxvY2spIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBieXRlT2Zmc2V0ID0gdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5lbmQoKTtcbiAgICAgICAgY29uc3QgemVyZGVQYXJzZXJQdHIgPSBOdW1iZXIodGhpcy5leHBvcnRzLnByb2Nlc3NXYXNtRXZlbnRzKHRoaXMuYXBwUHRyLCBCaWdJbnQoYnl0ZU9mZnNldCkpKTtcbiAgICAgICAgLy8gZ2V0IGEgY2xlYW4gemVyZGVFdmVudGxvb3BFdmVudHMgc2V0IHVwIGltbWVkaWF0ZWx5XG4gICAgICAgIHRoaXMuemVyZGVFdmVudGxvb3BFdmVudHMgPSBuZXcgWmVyZGVFdmVudGxvb3BFdmVudHModGhpcyk7XG4gICAgICAgIHRoaXMuemVyZGVQYXJzZXIgPSBuZXcgWmVyZGVQYXJzZXIodGhpcy5tZW1vcnksIHplcmRlUGFyc2VyUHRyKTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnN0YW50LWNvbmRpdGlvblxuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgY29uc3QgbXNnVHlwZSA9IHRoaXMuemVyZGVQYXJzZXIucGFyc2VVMzIoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbmRGblRhYmxlW21zZ1R5cGVdKHRoaXMpKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5leHBvcnRzLmRlYWxsb2NXYXNtTWVzc2FnZShCaWdJbnQoemVyZGVQYXJzZXJQdHIpKTtcbiAgICB9XG4gICAgLy8gVE9ETyhKUCk6IFNob3VsZCB1c2Ugc3ljaHJvbm91cyBmaWxlIGxvYWRpbmcgZm9yIHRoaXMuXG4gICAgbG9hZERlcHMoZGVwcykge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRlcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gZGVwc1tpXTtcbiAgICAgICAgICAgIHRoaXMucmVzb3VyY2VzLnB1c2godGhpcy5mZXRjaFBhdGgoZmlsZVBhdGgpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXREb2N1bWVudFRpdGxlKHRpdGxlKSB7XG4gICAgICAgIHJwYy5zZW5kKFdvcmtlckV2ZW50LlNldERvY3VtZW50VGl0bGUsIHRpdGxlKTtcbiAgICB9XG4gICAgYmluZE1vdXNlQW5kVG91Y2goKSB7XG4gICAgICAgIGxldCBsYXN0TW91c2VGaW5nZXI7XG4gICAgICAgIC8vIFRPRE8oSlApOiBTb21lIGRheSBicmluZyBiYWNrIHRvdWNoIHNjcm9sbCBzdXBwb3J0Li5cbiAgICAgICAgLy8gbGV0IHVzZV90b3VjaF9zY3JvbGxfb3ZlcmxheSA9IHdpbmRvdy5vbnRvdWNoc3RhcnQgPT09IG51bGw7XG4gICAgICAgIC8vIGlmICh1c2VfdG91Y2hfc2Nyb2xsX292ZXJsYXkpIHtcbiAgICAgICAgLy8gICAgIHZhciB0cyA9IHRoaXMudG91Y2hfc2Nyb2xsX292ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgICAgICAvLyAgICAgdHMuY2xhc3NOYW1lID0gXCJjeF93ZWJnbF9zY3JvbGxfb3ZlcmxheVwiXG4gICAgICAgIC8vICAgICB2YXIgdHNfaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgICAgICAvLyAgICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKVxuICAgICAgICAvLyAgICAgc3R5bGUuaW5uZXJIVE1MID0gXCJcXG5cIlxuICAgICAgICAvLyAgICAgICAgICsgXCJkaXYuY3hfd2ViZ2xfc2Nyb2xsX292ZXJsYXkge1xcblwiXG4gICAgICAgIC8vICAgICAgICAgKyBcInotaW5kZXg6IDEwMDAwO1xcblwiXG4gICAgICAgIC8vICAgICAgICAgKyBcIm1hcmdpbjowO1xcblwiXG4gICAgICAgIC8vICAgICAgICAgKyBcIm92ZXJmbG93OnNjcm9sbDtcXG5cIlxuICAgICAgICAvLyAgICAgICAgICsgXCJ0b3A6MDtcXG5cIlxuICAgICAgICAvLyAgICAgICAgICsgXCJsZWZ0OjA7XFxuXCJcbiAgICAgICAgLy8gICAgICAgICArIFwid2lkdGg6MTAwJTtcXG5cIlxuICAgICAgICAvLyAgICAgICAgICsgXCJoZWlnaHQ6MTAwJTtcXG5cIlxuICAgICAgICAvLyAgICAgICAgICsgXCJwb3NpdGlvbjpmaXhlZDtcXG5cIlxuICAgICAgICAvLyAgICAgICAgICsgXCJiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50XFxuXCJcbiAgICAgICAgLy8gICAgICAgICArIFwifVxcblwiXG4gICAgICAgIC8vICAgICAgICAgKyBcImRpdi5jeF93ZWJnbF9zY3JvbGxfb3ZlcmxheSBkaXZ7XFxuXCJcbiAgICAgICAgLy8gICAgICAgICArIFwibWFyZ2luOjA7XFxuXCJcbiAgICAgICAgLy8gICAgICAgICArIFwid2lkdGg6NDAwMDAwcHg7XFxuXCJcbiAgICAgICAgLy8gICAgICAgICArIFwiaGVpZ2h0OjQwMDAwMHB4O1xcblwiXG4gICAgICAgIC8vICAgICAgICAgKyBcImJhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnRcXG5cIlxuICAgICAgICAvLyAgICAgICAgICsgXCJ9XFxuXCJcbiAgICAgICAgLy8gICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3R5bGUpXG4gICAgICAgIC8vICAgICB0cy5hcHBlbmRDaGlsZCh0c19pbm5lcik7XG4gICAgICAgIC8vICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRzKTtcbiAgICAgICAgLy8gICAgIGNhbnZhcyA9IHRzO1xuICAgICAgICAvLyAgICAgdHMuc2Nyb2xsVG9wID0gMjAwMDAwO1xuICAgICAgICAvLyAgICAgdHMuc2Nyb2xsTGVmdCA9IDIwMDAwMDtcbiAgICAgICAgLy8gICAgIGxldCBsYXN0X3Njcm9sbF90b3AgPSB0cy5zY3JvbGxUb3A7XG4gICAgICAgIC8vICAgICBsZXQgbGFzdF9zY3JvbGxfbGVmdCA9IHRzLnNjcm9sbExlZnQ7XG4gICAgICAgIC8vICAgICBsZXQgc2Nyb2xsX3RpbWVvdXQgPSBudWxsO1xuICAgICAgICAvLyAgICAgdHMuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgZSA9PiB7XG4gICAgICAgIC8vICAgICAgICAgbGV0IG5ld19zY3JvbGxfdG9wID0gdHMuc2Nyb2xsVG9wO1xuICAgICAgICAvLyAgICAgICAgIGxldCBuZXdfc2Nyb2xsX2xlZnQgPSB0cy5zY3JvbGxMZWZ0O1xuICAgICAgICAvLyAgICAgICAgIGxldCBkeCA9IG5ld19zY3JvbGxfbGVmdCAtIGxhc3Rfc2Nyb2xsX2xlZnQ7XG4gICAgICAgIC8vICAgICAgICAgbGV0IGR5ID0gbmV3X3Njcm9sbF90b3AgLSBsYXN0X3Njcm9sbF90b3A7XG4gICAgICAgIC8vICAgICAgICAgbGFzdF9zY3JvbGxfdG9wID0gbmV3X3Njcm9sbF90b3A7XG4gICAgICAgIC8vICAgICAgICAgbGFzdF9zY3JvbGxfbGVmdCA9IG5ld19zY3JvbGxfbGVmdDtcbiAgICAgICAgLy8gICAgICAgICBzZWxmLmNsZWFyVGltZW91dChzY3JvbGxfdGltZW91dCk7XG4gICAgICAgIC8vICAgICAgICAgc2Nyb2xsX3RpbWVvdXQgPSBzZWxmLnNldFRpbWVvdXQoXyA9PiB7XG4gICAgICAgIC8vICAgICAgICAgICAgIHRzLnNjcm9sbFRvcCA9IDIwMDAwMDtcbiAgICAgICAgLy8gICAgICAgICAgICAgdHMuc2Nyb2xsTGVmdCA9IDIwMDAwMDtcbiAgICAgICAgLy8gICAgICAgICAgICAgbGFzdF9zY3JvbGxfdG9wID0gdHMuc2Nyb2xsVG9wO1xuICAgICAgICAvLyAgICAgICAgICAgICBsYXN0X3Njcm9sbF9sZWZ0ID0gdHMuc2Nyb2xsTGVmdDtcbiAgICAgICAgLy8gICAgICAgICB9LCAyMDApO1xuICAgICAgICAvLyAgICAgICAgIGxldCBmaW5nZXIgPSBsYXN0X21vdXNlX2ZpbmdlcjtcbiAgICAgICAgLy8gICAgICAgICBpZiAoZmluZ2VyKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgIGZpbmdlci5zY3JvbGxfeCA9IGR4O1xuICAgICAgICAvLyAgICAgICAgICAgICBmaW5nZXIuc2Nyb2xsX3kgPSBkeTtcbiAgICAgICAgLy8gICAgICAgICAgICAgZmluZ2VyLmlzX3doZWVsID0gdHJ1ZTtcbiAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5maW5nZXJfc2Nyb2xsKGZpbmdlcik7XG4gICAgICAgIC8vICAgICAgICAgICAgIHRoaXMuZG9fd2FzbV9pbygpO1xuICAgICAgICAvLyAgICAgICAgIH1cbiAgICAgICAgLy8gICAgIH0pXG4gICAgICAgIC8vIH1cbiAgICAgICAgY29uc3QgbW91c2VGaW5nZXJzID0gW107XG4gICAgICAgIGZ1bmN0aW9uIG1vdXNlVG9GaW5nZXIoZSkge1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZTsgVHlwZVNjcmlwdCBkb2VzIG5vdCBsaWtlIHRoZSBlbXB0eSBvYmplY3QgZGVjbGFyYXRpb24gYmVsb3csIGJ1dCB3ZSBpbW1lZGlhdGVseSBmaWxsIGV2ZXJ5IGZpZWxkXG4gICAgICAgICAgICBjb25zdCBtZiA9IG1vdXNlRmluZ2Vyc1tlLmJ1dHRvbl0gfHwgKG1vdXNlRmluZ2Vyc1tlLmJ1dHRvbl0gPSB7fSk7XG4gICAgICAgICAgICBtZi54ID0gZS5wYWdlWDtcbiAgICAgICAgICAgIG1mLnkgPSBlLnBhZ2VZO1xuICAgICAgICAgICAgbWYuYnV0dG9uID0gZS5idXR0b247XG4gICAgICAgICAgICBtZi5kaWdpdCA9IGUuYnV0dG9uO1xuICAgICAgICAgICAgbWYudGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC8gMTAwMC4wO1xuICAgICAgICAgICAgbWYubW9kaWZpZXJzID0gcGFja0tleU1vZGlmaWVyKGUpO1xuICAgICAgICAgICAgbWYudG91Y2ggPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiBtZjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtb3VzZUJ1dHRvbnNEb3duID0gW107XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LkNhbnZhc01vdXNlRG93biwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBtb3VzZUJ1dHRvbnNEb3duW2V2ZW50LmJ1dHRvbl0gPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5maW5nZXJEb3duKG1vdXNlVG9GaW5nZXIoZXZlbnQpKTtcbiAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LldpbmRvd01vdXNlVXAsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgbW91c2VCdXR0b25zRG93bltldmVudC5idXR0b25dID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmZpbmdlclVwKG1vdXNlVG9GaW5nZXIoZXZlbnQpKTtcbiAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LldpbmRvd01vdXNlTW92ZSwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1vdXNlQnV0dG9uc0Rvd24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAobW91c2VCdXR0b25zRG93bltpXSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtZiA9IG1vdXNlVG9GaW5nZXIoZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICBtZi5kaWdpdCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuemVyZGVFdmVudGxvb3BFdmVudHMuZmluZ2VyTW92ZShtZik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGFzdE1vdXNlRmluZ2VyID0gbW91c2VUb0ZpbmdlcihldmVudCk7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmZpbmdlckhvdmVyKGxhc3RNb3VzZUZpbmdlcik7XG4gICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBycGMucmVjZWl2ZShXb3JrZXJFdmVudC5XaW5kb3dNb3VzZU91dCwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmZpbmdlck91dChtb3VzZVRvRmluZ2VyKGV2ZW50KSk7XG4gICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB0b3VjaElkc0J5RGlnaXQgPSBbXTtcbiAgICAgICAgcnBjLnJlY2VpdmUoV29ya2VyRXZlbnQuV2luZG93VG91Y2hTdGFydCwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRvdWNoIG9mIGV2ZW50LmNoYW5nZWRUb3VjaGVzKSB7XG4gICAgICAgICAgICAgICAgbGV0IGRpZ2l0ID0gdG91Y2hJZHNCeURpZ2l0LmluZGV4T2YodW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlnaXQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpZ2l0ID0gdG91Y2hJZHNCeURpZ2l0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdG91Y2hJZHNCeURpZ2l0W2RpZ2l0XSA9IHRvdWNoLmlkZW50aWZpZXI7XG4gICAgICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5maW5nZXJEb3duKHtcbiAgICAgICAgICAgICAgICAgICAgeDogdG91Y2gucGFnZVgsXG4gICAgICAgICAgICAgICAgICAgIHk6IHRvdWNoLnBhZ2VZLFxuICAgICAgICAgICAgICAgICAgICBidXR0b246IDAsXG4gICAgICAgICAgICAgICAgICAgIGRpZ2l0LFxuICAgICAgICAgICAgICAgICAgICB0aW1lOiBwZXJmb3JtYW5jZS5ub3coKSAvIDEwMDAuMCxcbiAgICAgICAgICAgICAgICAgICAgbW9kaWZpZXJzOiBwYWNrS2V5TW9kaWZpZXIoZXZlbnQpLFxuICAgICAgICAgICAgICAgICAgICB0b3VjaDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LldpbmRvd1RvdWNoTW92ZSwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRvdWNoIG9mIGV2ZW50LmNoYW5nZWRUb3VjaGVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlnaXQgPSB0b3VjaElkc0J5RGlnaXQuaW5kZXhPZih0b3VjaC5pZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlnaXQgPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlVucmVjb2duaXplZCBkaWdpdCBpbiBXb3JrZXJFdmVudC5XaW5kb3dUb3VjaE1vdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmZpbmdlck1vdmUoe1xuICAgICAgICAgICAgICAgICAgICB4OiB0b3VjaC5wYWdlWCxcbiAgICAgICAgICAgICAgICAgICAgeTogdG91Y2gucGFnZVksXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbjogMCxcbiAgICAgICAgICAgICAgICAgICAgZGlnaXQsXG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IHBlcmZvcm1hbmNlLm5vdygpIC8gMTAwMC4wLFxuICAgICAgICAgICAgICAgICAgICBtb2RpZmllcnM6IHBhY2tLZXlNb2RpZmllcihldmVudCksXG4gICAgICAgICAgICAgICAgICAgIHRvdWNoOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5kb1dhc21JbygpO1xuICAgICAgICB9KTtcbiAgICAgICAgcnBjLnJlY2VpdmUoV29ya2VyRXZlbnQuV2luZG93VG91Y2hFbmRDYW5jZWxMZWF2ZSwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRvdWNoIG9mIGV2ZW50LmNoYW5nZWRUb3VjaGVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlnaXQgPSB0b3VjaElkc0J5RGlnaXQuaW5kZXhPZih0b3VjaC5pZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlnaXQgPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlVucmVjb2duaXplZCBkaWdpdCBpbiBXb3JrZXJFdmVudC5XaW5kb3dUb3VjaE1vdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0b3VjaElkc0J5RGlnaXRbZGlnaXRdID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHRoaXMuemVyZGVFdmVudGxvb3BFdmVudHMuZmluZ2VyVXAoe1xuICAgICAgICAgICAgICAgICAgICB4OiB0b3VjaC5wYWdlWCxcbiAgICAgICAgICAgICAgICAgICAgeTogdG91Y2gucGFnZVksXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbjogMCxcbiAgICAgICAgICAgICAgICAgICAgZGlnaXQsXG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IHBlcmZvcm1hbmNlLm5vdygpIC8gMTAwMC4wLFxuICAgICAgICAgICAgICAgICAgICBtb2RpZmllcnM6IHBhY2tLZXlNb2RpZmllcihldmVudCksXG4gICAgICAgICAgICAgICAgICAgIHRvdWNoOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5kb1dhc21JbygpO1xuICAgICAgICB9KTtcbiAgICAgICAgbGV0IGxhc3RXaGVlbFRpbWU7XG4gICAgICAgIGxldCBsYXN0V2FzV2hlZWw7XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LkNhbnZhc1doZWVsLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpbmdlciA9IG1vdXNlVG9GaW5nZXIoZXZlbnQpO1xuICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBldmVudC50aW1lU3RhbXAgLSBsYXN0V2hlZWxUaW1lO1xuICAgICAgICAgICAgbGFzdFdoZWVsVGltZSA9IGV2ZW50LnRpbWVTdGFtcDtcbiAgICAgICAgICAgIC8vIHR5cGljYWwgd2ViIGJ1bGxzaGl0LiB0aGlzIHJlbGlhYmx5IGRldGVjdHMgbW91c2V3aGVlbCBvciB0b3VjaHBhZCBvbiBtYWMgaW4gc2FmYXJpXG4gICAgICAgICAgICBpZiAoaXNGaXJlZm94KSB7XG4gICAgICAgICAgICAgICAgbGFzdFdhc1doZWVsID0gZXZlbnQuZGVsdGFNb2RlID09IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBkZXRlY3QgaXRcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZTogVE9ETyhQYXJhcyk6IHdoZWVsRGVsdGFZIGxvb2tzIGRpZmZlcmVudCBiZXR3ZWVuIGJyb3dzZXJzLiBGaWd1cmUgb3V0IGEgbW9yZSBjb25zaXN0ZW50IGludGVyZmFjZS5cbiAgICAgICAgICAgICAgICBNYXRoLmFicyhNYXRoLmFicyhldmVudC5kZWx0YVkgLyBldmVudC53aGVlbERlbHRhWSkgLSAxIC8gMykgPFxuICAgICAgICAgICAgICAgICAgICAwLjAwMDAxIHx8XG4gICAgICAgICAgICAgICAgICAgICghbGFzdFdhc1doZWVsICYmIGRlbHRhIDwgMjUwKSkge1xuICAgICAgICAgICAgICAgICAgICBsYXN0V2FzV2hlZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RXYXNXaGVlbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhldmVudC5kZWx0YVkgLyBldmVudC53aGVlbERlbHRhWSk7XG4gICAgICAgICAgICAvL2xhc3RfZGVsdGEgPSBkZWx0YTtcbiAgICAgICAgICAgIGxldCBmYWMgPSAxO1xuICAgICAgICAgICAgaWYgKGV2ZW50LmRlbHRhTW9kZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGZhYyA9IDQwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXZlbnQuZGVsdGFNb2RlID09PSAyKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhQYXJhcyk6IGRlbHRhTW9kZT0yIG1lYW5zIHRoYXQgYSB1c2VyIGlzIHRyeWluZyB0byBzY3JvbGwgb25lIHBhZ2UgYXQgYSB0aW1lLlxuICAgICAgICAgICAgICAgIC8vIEZvciBub3csIHdlIGhhcmRjb2RlIHRoZSBwaXhlbCBhbW91bnQuIFdlIGNhbiBsYXRlciBkZXRlcm1pbmUgdGhpcyBjb250ZXh0dWFsbHkuXG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0SGVpZ2h0ID0gODAwO1xuICAgICAgICAgICAgICAgIGZhYyA9IG9mZnNldEhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGZpbmdlclNjcm9sbCA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZmluZ2VyKSwgeyBzY3JvbGxYOiBldmVudC5kZWx0YVggKiBmYWMsIHNjcm9sbFk6IGV2ZW50LmRlbHRhWSAqIGZhYywgaXNXaGVlbDogbGFzdFdhc1doZWVsIH0pO1xuICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5maW5nZXJTY3JvbGwoZmluZ2VyU2Nyb2xsKTtcbiAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdG1vdXNlZm9yY2V3aWxsYmVnaW4nLCB0aGlzLm9uQ2hlY2tNYWNGb3JjZS5iaW5kKHRoaXMpLCBmYWxzZSlcbiAgICAgICAgLy93aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignd2Via2l0bW91c2Vmb3JjZWNoYW5nZWQnLCB0aGlzLm9uQ2hlY2tNYWNGb3JjZS5iaW5kKHRoaXMpLCBmYWxzZSlcbiAgICB9XG4gICAgYmluZEtleWJvYXJkKCkge1xuICAgICAgICBycGMucmVjZWl2ZShXb3JrZXJFdmVudC5UZXh0SW5wdXQsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLnRleHRJbnB1dChkYXRhKTtcbiAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LlRleHRDb3B5LCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLnRleHRDb3B5KCk7XG4gICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBycGMucmVjZWl2ZShXb3JrZXJFdmVudC5LZXlEb3duLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5rZXlEb3duKGRhdGEpO1xuICAgICAgICAgICAgdGhpcy5kb1dhc21JbygpO1xuICAgICAgICB9KTtcbiAgICAgICAgcnBjLnJlY2VpdmUoV29ya2VyRXZlbnQuS2V5VXAsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmtleVVwKGRhdGEpO1xuICAgICAgICAgICAgdGhpcy5kb1dhc21JbygpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2V0TW91c2VDdXJzb3IoaWQpIHtcbiAgICAgICAgcnBjLnNlbmQoV29ya2VyRXZlbnQuU2V0TW91c2VDdXJzb3IsIGN1cnNvck1hcFtpZF0gfHwgXCJkZWZhdWx0XCIpO1xuICAgIH1cbiAgICBzdGFydFRpbWVyKGlkLCBpbnRlcnZhbCwgcmVwZWF0cykge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudGltZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lcnNbaV0uaWQgPT0gaWQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRpbWVyIElEIGNvbGxpc2lvbiFcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN5c0lkID0gcmVwZWF0cyAhPT0gMFxuICAgICAgICAgICAgPyBzZWxmLnNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLnRpbWVyRmlyZWQoaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgICAgIH0sIGludGVydmFsICogMTAwMC4wKVxuICAgICAgICAgICAgOiBzZWxmLnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50aW1lcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZXIgPSB0aGlzLnRpbWVyc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVyLmlkID09IGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbWVycy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLnRpbWVyRmlyZWQoaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgICAgIH0sIGludGVydmFsICogMTAwMC4wKTtcbiAgICAgICAgdGhpcy50aW1lcnMucHVzaCh7IGlkLCByZXBlYXRzLCBzeXNJZCB9KTtcbiAgICB9XG4gICAgc3RvcFRpbWVyKGlkKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50aW1lcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVyID0gdGhpcy50aW1lcnNbaV07XG4gICAgICAgICAgICBpZiAodGltZXIuaWQgPT0gaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGltZXIucmVwZWF0cykge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmNsZWFySW50ZXJ2YWwodGltZXIuc3lzSWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jbGVhclRpbWVvdXQodGltZXIuc3lzSWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVycy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJUaW1lciBJRCBub3QgZm91bmQhXCIpXG4gICAgfVxuICAgIGh0dHBTZW5kKHZlcmIsIHBhdGgsIHByb3RvLCBkb21haW4sIHBvcnQsIGNvbnRlbnRUeXBlLCBib2R5LCBzaWduYWxJZCkge1xuICAgICAgICBjb25zdCByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgcmVxLmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCAoXykgPT4ge1xuICAgICAgICAgICAgLy8gc2lnbmFsIGZhaWxcbiAgICAgICAgICAgIHRoaXMuemVyZGVFdmVudGxvb3BFdmVudHMuaHR0cFNlbmRSZXNwb25zZShzaWduYWxJZCwgMik7XG4gICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXEuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKF8pID0+IHtcbiAgICAgICAgICAgIGlmIChyZXEuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAvLyBzaWduYWwgZmFpbFxuICAgICAgICAgICAgICAgIHRoaXMuemVyZGVFdmVudGxvb3BFdmVudHMuaHR0cFNlbmRSZXNwb25zZShzaWduYWxJZCwgMik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL3NpZ25hbCBzdWNjZXNzXG4gICAgICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5odHRwU2VuZFJlc3BvbnNlKHNpZ25hbElkLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlcS5vcGVuKHZlcmIsIHByb3RvICsgXCI6Ly9cIiArIGRvbWFpbiArIFwiOlwiICsgcG9ydCArIHBhdGgsIHRydWUpO1xuICAgICAgICBjb25zb2xlLmxvZyh2ZXJiLCBwcm90byArIFwiOi8vXCIgKyBkb21haW4gKyBcIjpcIiArIHBvcnQgKyBwYXRoLCBib2R5KTtcbiAgICAgICAgcmVxLnNlbmQoYm9keS5idWZmZXIpO1xuICAgIH1cbiAgICB3ZWJzb2NrZXRTZW5kKHVybCwgZGF0YSkge1xuICAgICAgICAvLyBUT0RPKFBhcmFzKTogU3RvcCBwYXRjaGluZyBzZW5kU3RhY2sgb250byB3ZWJzb2NrZXRzXG4gICAgICAgIC8vIGFuZCBtYWludGFpbiBvdXIgb3duIHN0cnVjdHVyZSBpbnN0ZWFkLlxuICAgICAgICBjb25zdCBzb2NrZXQgPSB0aGlzLndlYnNvY2tldHNbdXJsXTtcbiAgICAgICAgaWYgKCFzb2NrZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IHNvY2tldCA9IG5ldyBXZWJTb2NrZXQodXJsKTtcbiAgICAgICAgICAgIHRoaXMud2Vic29ja2V0c1t1cmxdID0gc29ja2V0O1xuICAgICAgICAgICAgc29ja2V0LnNlbmRTdGFjayA9IFtkYXRhXTtcbiAgICAgICAgICAgIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKFwiY2xvc2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMud2Vic29ja2V0c1t1cmxdID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLndlYnNvY2tldHNbdXJsXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy53ZWJzb2NrZXRFcnJvcih1cmwsIFwiXCIgKyBldmVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5kb1dhc21JbygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQuZGF0YS5hcnJheUJ1ZmZlcigpLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy53ZWJzb2NrZXRNZXNzYWdlKHVybCwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJvcGVuXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZW5kU3RhY2sgPSBzb2NrZXQuc2VuZFN0YWNrO1xuICAgICAgICAgICAgICAgIHNvY2tldC5zZW5kU3RhY2sgPSBudWxsO1xuICAgICAgICAgICAgICAgIGZvciAoZGF0YSBvZiBzZW5kU3RhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgc29ja2V0LnNlbmQoZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoc29ja2V0LnNlbmRTdGFjaykge1xuICAgICAgICAgICAgICAgIHNvY2tldC5zZW5kU3RhY2sucHVzaChkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNvY2tldC5zZW5kKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGVuYWJsZUdsb2JhbEZpbGVEcm9wVGFyZ2V0KCkge1xuICAgICAgICBycGMuc2VuZChXb3JrZXJFdmVudC5FbmFibGVHbG9iYWxGaWxlRHJvcFRhcmdldCk7XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LkRyYWdFbnRlciwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5kcmFnZW50ZXIoKTtcbiAgICAgICAgICAgIHRoaXMuZG9XYXNtSW8oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJwYy5yZWNlaXZlKFdvcmtlckV2ZW50LkRyYWdPdmVyLCAoeyB4LCB5IH0pID0+IHtcbiAgICAgICAgICAgIHRoaXMuemVyZGVFdmVudGxvb3BFdmVudHMuZHJhZ292ZXIoeCwgeSk7XG4gICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBycGMucmVjZWl2ZShXb3JrZXJFdmVudC5EcmFnTGVhdmUsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuemVyZGVFdmVudGxvb3BFdmVudHMuZHJhZ2xlYXZlKCk7XG4gICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBycGMucmVjZWl2ZShXb3JrZXJFdmVudC5Ecm9wLCAoeyBmaWxlSGFuZGxlcywgZmlsZUhhbmRsZXNUb1NlbmQsIH0pID0+IHtcbiAgICAgICAgICAgIC8vIFdlIGNhbid0IHNldCB0aGlzLmZpbGVIYW5kbGVzIHRvIGEgbmV3IG9iamVjdCwgc2luY2Ugb3RoZXIgcGxhY2VzIGhvbGRcbiAgICAgICAgICAgIC8vIHJlZmVyZW5jZXMgdG8gaXQuIEluc3RlYWQsIGNsZWFyIGl0IG91dCBhbmQgZmlsbCBpdCB1cCBhZ2Fpbi5cbiAgICAgICAgICAgIHRoaXMuZmlsZUhhbmRsZXMuc3BsaWNlKDAsIHRoaXMuZmlsZUhhbmRsZXMubGVuZ3RoKTtcbiAgICAgICAgICAgIHRoaXMuZmlsZUhhbmRsZXMucHVzaCguLi5maWxlSGFuZGxlcyk7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLmFwcE9wZW5GaWxlcyhmaWxlSGFuZGxlc1RvU2VuZCk7XG4gICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54cklzUHJlc2VudGluZyB8fCB0aGlzLmhhc1JlcXVlc3RlZEFuaW1hdGlvbkZyYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5oYXNSZXF1ZXN0ZWRBbmltYXRpb25GcmFtZSA9IHRydWU7XG4gICAgICAgICAgICBpZiAodGhpcy5ydW5XZWJHTFByb21pc2UpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLnJ1bldlYkdMUHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIChzZWxmLnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBzZWxmLnNldFRpbWVvdXQpKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ydW5XZWJHTFByb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgdGhpcy5ydW5XZWJHTFByb21pc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuaGFzUmVxdWVzdGVkQW5pbWF0aW9uRnJhbWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy54cklzUHJlc2VudGluZykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuemVyZGVFdmVudGxvb3BFdmVudHMuYW5pbWF0aW9uRnJhbWUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRvV2FzbUlvKCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBwcml2YXRlIHJ1bkFzeW5jV2ViWFJDaGVjaygpOiB2b2lkIHtcbiAgICAvLyAgIHRoaXMueHJDYW5QcmVzZW50ID0gZmFsc2U7XG4gICAgLy8gICB0aGlzLnhySXNQcmVzZW50aW5nID0gZmFsc2U7XG4gICAgLy8gICAvLyBvayB0aGlzIGNoYW5nZXMgYSBidW5jaCBpbiBob3cgdGhlIHJlbmRlcmZsb3cgd29ya3MuXG4gICAgLy8gICAvLyBmaXJzdCB0aGluZyB3ZSBhcmUgZ29pbmcgdG8gZG8gaXMgZ2V0IHRoZSB2ciBkaXNwbGF5cy5cbiAgICAvLyAgIC8vIEB0cy1pZ25vcmUgLSBMZXQncyBub3Qgd29ycnkgYWJvdXQgWFIuXG4gICAgLy8gICBjb25zdCB4clN5c3RlbSA9IHNlbGYubmF2aWdhdG9yLnhyO1xuICAgIC8vICAgaWYgKHhyU3lzdGVtKSB7XG4gICAgLy8gICAgIHhyU3lzdGVtLmlzU2Vzc2lvblN1cHBvcnRlZChcImltbWVyc2l2ZS12clwiKS50aGVuKChzdXBwb3J0ZWQpID0+IHtcbiAgICAvLyAgICAgICBpZiAoc3VwcG9ydGVkKSB7XG4gICAgLy8gICAgICAgICB0aGlzLnhyQ2FuUHJlc2VudCA9IHRydWU7XG4gICAgLy8gICAgICAgfVxuICAgIC8vICAgICB9KTtcbiAgICAvLyAgIH0gZWxzZSB7XG4gICAgLy8gICAgIGNvbnNvbGUubG9nKFwiTm8gd2ViVlIgc3VwcG9ydCBmb3VuZFwiKTtcbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgeHJTdGFydFByZXNlbnRpbmcoKSB7XG4gICAgICAgIC8vIFRPRE8oSlApOiBTb21lIGRheSBicmluZyBiYWNrIFhSIHN1cHBvcnQ/XG4gICAgICAgIC8vIGlmICh0aGlzLnhyX2Nhbl9wcmVzZW50KSB7XG4gICAgICAgIC8vICAgICBuYXZpZ2F0b3IueHIucmVxdWVzdFNlc3Npb24oJ2ltbWVyc2l2ZS12cicsIHtyZXF1aXJlZEZlYXR1cmVzOiBbJ2xvY2FsLWZsb29yJ119KS50aGVuKHhyX3Nlc3Npb24gPT4ge1xuICAgICAgICAvLyAgICAgICAgIGxldCB4cl9sYXllciA9IG5ldyBYUldlYkdMTGF5ZXIoeHJfc2Vzc2lvbiwgdGhpcy5nbCwge1xuICAgICAgICAvLyAgICAgICAgICAgICBhbnRpYWxpYXM6IGZhbHNlLFxuICAgICAgICAvLyAgICAgICAgICAgICBkZXB0aDogdHJ1ZSxcbiAgICAgICAgLy8gICAgICAgICAgICAgc3RlbmNpbDogZmFsc2UsXG4gICAgICAgIC8vICAgICAgICAgICAgIGFscGhhOiBmYWxzZSxcbiAgICAgICAgLy8gICAgICAgICAgICAgaWdub3JlRGVwdGhWYWx1ZXM6IGZhbHNlLFxuICAgICAgICAvLyAgICAgICAgICAgICBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yOiAxLjVcbiAgICAgICAgLy8gICAgICAgICB9KTtcbiAgICAgICAgLy8gICAgICAgICB4cl9zZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKHtiYXNlTGF5ZXI6IHhyX2xheWVyfSk7XG4gICAgICAgIC8vICAgICAgICAgeHJfc2Vzc2lvbi5yZXF1ZXN0UmVmZXJlbmNlU3BhY2UoXCJsb2NhbC1mbG9vclwiKS50aGVuKHhyX3JlZmVyZW5jZV9zcGFjZSA9PiB7XG4gICAgICAgIC8vICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInhyX3ByZXNlbnRpbmdcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLnhyX3JlZmVyZW5jZV9zcGFjZSA9IHhyX3JlZmVyZW5jZV9zcGFjZTtcbiAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy54cl9zZXNzaW9uID0geHJfc2Vzc2lvbjtcbiAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy54cl9pc19wcmVzZW50aW5nID0gdHJ1ZTtcbiAgICAgICAgLy8gICAgICAgICAgICAgbGV0IGZpcnN0X29uX3Jlc2l6ZSA9IHRydWU7XG4gICAgICAgIC8vICAgICAgICAgICAgIC8vIHJlYWQgc2hpdCBvZmYgdGhlIGdhbWVwYWRcbiAgICAgICAgLy8gICAgICAgICAgICAgeHJfc2Vzc2lvbi5nYW1lcGFkO1xuICAgICAgICAvLyAgICAgICAgICAgICAvLyBsZXRzIHN0YXJ0IHRoZSBsb29wXG4gICAgICAgIC8vICAgICAgICAgICAgIGxldCBpbnB1dHMgPSBbXTtcbiAgICAgICAgLy8gICAgICAgICAgICAgbGV0IGFsdGVybmF0ZSA9IGZhbHNlO1xuICAgICAgICAvLyAgICAgICAgICAgICBsZXQgbGFzdF90aW1lO1xuICAgICAgICAvLyAgICAgICAgICAgICBsZXQgeHJfb25fcmVxdWVzdF9hbmltYXRpb25fZnJhbWUgPSAodGltZSwgeHJfZnJhbWUpID0+IHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGlmIChmaXJzdF9vbl9yZXNpemUpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB0aGlzLm9uX3NjcmVlbl9yZXNpemUoKTtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICBmaXJzdF9vbl9yZXNpemUgPSBmYWxzZTtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIH1cbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGlmICghdGhpcy54cl9pc19wcmVzZW50aW5nKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgfVxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy54cl9zZXNzaW9uLnJlcXVlc3RBbmltYXRpb25GcmFtZSh4cl9vbl9yZXF1ZXN0X2FuaW1hdGlvbl9mcmFtZSk7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLnhyX3Bvc2UgPSB4cl9mcmFtZS5nZXRWaWV3ZXJQb3NlKHRoaXMueHJfcmVmZXJlbmNlX3NwYWNlKTtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGlmICghdGhpcy54cl9wb3NlKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgfVxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy54cl91cGRhdGVfaW5wdXRzKHhyX2ZyYW1lLCB4cl9zZXNzaW9uLCB0aW1lLCB0aGlzLnhyX3Bvc2UsIHRoaXMueHJfcmVmZXJlbmNlX3NwYWNlKVxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy56ZXJkZUV2ZW50bG9vcEV2ZW50cy5hbmltYXRpb25fZnJhbWUodGltZSAvIDEwMDAuMCk7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLmluX2FuaW1hdGlvbl9mcmFtZSA9IHRydWU7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICBsZXQgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHRoaXMuZG9fd2FzbV9pbygpO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy5pbl9hbmltYXRpb25fZnJhbWUgPSBmYWxzZTtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHRoaXMueHJfcG9zZSA9IG51bGw7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAvL2xldCBuZXdfdGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgLy9pZiAobmV3X3RpbWUgLSBsYXN0X3RpbWUgPiAxMy4pIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIC8vICAgIGNvbnNvbGUubG9nKG5ld190aW1lIC0gbGFzdF90aW1lKTtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIC8vbGFzdF90aW1lID0gbmV3X3RpbWU7XG4gICAgICAgIC8vICAgICAgICAgICAgIH1cbiAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy54cl9zZXNzaW9uLnJlcXVlc3RBbmltYXRpb25GcmFtZSh4cl9vbl9yZXF1ZXN0X2FuaW1hdGlvbl9mcmFtZSk7XG4gICAgICAgIC8vICAgICAgICAgICAgIHRoaXMueHJfc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKFwiZW5kXCIsICgpID0+IHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInhyX3ByZXNlbnRpbmdcIiwgXCJmYWxzZVwiKTtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHRoaXMueHJfaXNfcHJlc2VudGluZyA9IGZhbHNlO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy5vbl9zY3JlZW5fcmVzaXplKCk7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLnBhaW50X2RpcnR5KCk7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RfYW5pbWF0aW9uX2ZyYW1lKCk7XG4gICAgICAgIC8vICAgICAgICAgICAgIH0pXG4gICAgICAgIC8vICAgICAgICAgfSlcbiAgICAgICAgLy8gICAgIH0pXG4gICAgICAgIC8vIH1cbiAgICB9XG4gICAgeHJTdG9wUHJlc2VudGluZygpIHtcbiAgICAgICAgLy8gaWdub3JlIGZvciBub3dcbiAgICB9XG4gICAgLy8gVE9ETyhKUCk6IFNob3VsZCB1c2Ugc3ljaHJvbm91cyBmaWxlIGxvYWRpbmcgZm9yIHRoaXMuXG4gICAgZmV0Y2hQYXRoKGZpbGVQYXRoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHJlcS5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJlamVjdChmaWxlUGF0aCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlcS5yZXNwb25zZVR5cGUgPSBcImFycmF5YnVmZmVyXCI7XG4gICAgICAgICAgICByZXEuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXEuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlcS5zdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZmlsZVBhdGgsXG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjogcmVxLnJlc3BvbnNlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXEub3BlbihcIkdFVFwiLCBuZXcgVVJMKGZpbGVQYXRoLCB0aGlzLmJhc2VVcmkpLmhyZWYpO1xuICAgICAgICAgICAgcmVxLnNlbmQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNlbmRFdmVudEZyb21BbnlUaHJlYWQoZXZlbnRQdHIpIHtcbiAgICAgICAgLy8gUHJldmVudCBhbiBpbmZpbml0ZSBsb29wIHdoZW4gY2FsbGluZyB0aGlzIGZyb20gYW4gZXZlbnQgaGFuZGxlci5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnplcmRlRXZlbnRsb29wRXZlbnRzLnNlbmRFdmVudEZyb21BbnlUaHJlYWQoZXZlbnRQdHIpO1xuICAgICAgICAgICAgdGhpcy5kb1dhc21JbygpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5ycGMucmVjZWl2ZShXb3JrZXJFdmVudC5Jbml0LCAoeyB3YXNtTW9kdWxlLCBvZmZzY3JlZW5DYW52YXMsIHNpemluZ0RhdGEsIGJhc2VVcmksIG1lbW9yeSwgdGFza1dvcmtlclNhYiwgfSkgPT4ge1xuICAgIGxldCB3YXNtYXBwO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHRocmVhZFNwYXduID0gKGN0eFB0cikgPT4ge1xuICAgICAgICAgICAgcnBjLnNlbmQoV29ya2VyRXZlbnQuVGhyZWFkU3Bhd24sIHtcbiAgICAgICAgICAgICAgICBjdHhQdHIsXG4gICAgICAgICAgICAgICAgdGxzQW5kU3RhY2tEYXRhOiBtYWtlVGhyZWFkTG9jYWxTdG9yYWdlQW5kU3RhY2tEYXRhT25FeGlzdGluZ1RocmVhZCh3YXNtYXBwLmV4cG9ydHMpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGdldEV4cG9ydHMgPSAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gd2FzbWFwcC5leHBvcnRzO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBmaWxlSGFuZGxlcyA9IFtdO1xuICAgICAgICBjb25zdCBlbnYgPSBnZXRXYXNtRW52KHtcbiAgICAgICAgICAgIGdldEV4cG9ydHMsXG4gICAgICAgICAgICBtZW1vcnksXG4gICAgICAgICAgICB0YXNrV29ya2VyU2FiLFxuICAgICAgICAgICAgZmlsZUhhbmRsZXMsXG4gICAgICAgICAgICBzZW5kRXZlbnRGcm9tQW55VGhyZWFkOiAoZXZlbnRQdHIpID0+IHtcbiAgICAgICAgICAgICAgICB3YXNtYXBwLnNlbmRFdmVudEZyb21BbnlUaHJlYWQoZXZlbnRQdHIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRocmVhZFNwYXduLFxuICAgICAgICAgICAgYmFzZVVyaSxcbiAgICAgICAgfSk7XG4gICAgICAgIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKHdhc21Nb2R1bGUsIHsgZW52IH0pLnRoZW4oKGluc3RhbmNlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB3YXNtRXhwb3J0cyA9IGluc3RhbmNlLmV4cG9ydHM7XG4gICAgICAgICAgICBpbml0VGhyZWFkTG9jYWxTdG9yYWdlTWFpbldvcmtlcih3YXNtRXhwb3J0cyk7XG4gICAgICAgICAgICB3YXNtYXBwID0gbmV3IFdhc21BcHAoe1xuICAgICAgICAgICAgICAgIG9mZnNjcmVlbkNhbnZhcyxcbiAgICAgICAgICAgICAgICB3YXNtTW9kdWxlLFxuICAgICAgICAgICAgICAgIHdhc21FeHBvcnRzLFxuICAgICAgICAgICAgICAgIG1lbW9yeSxcbiAgICAgICAgICAgICAgICBzaXppbmdEYXRhLFxuICAgICAgICAgICAgICAgIGJhc2VVcmksXG4gICAgICAgICAgICAgICAgZmlsZUhhbmRsZXMsXG4gICAgICAgICAgICAgICAgdGFza1dvcmtlclNhYixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9LCByZWplY3QpO1xuICAgIH0pO1xufSk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./wrf_wasm_worker.ts\n");

/***/ }),

/***/ "./zerde_eventloop_events.ts":
/*!***********************************!*\
  !*** ./zerde_eventloop_events.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ZerdeEventloopEvents\": () => (/* binding */ ZerdeEventloopEvents)\n/* harmony export */ });\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./common */ \"./common.ts\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./types */ \"./types.ts\");\n/* harmony import */ var _zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./zerde_keyboard_handlers */ \"./zerde_keyboard_handlers.ts\");\n// Copyright (c) 2021-present, Cruise LLC\n//\n// This source code is licensed under the Apache License, Version 2.0,\n// found in the LICENSE-APACHE file in the root directory of this source tree.\n// You may not use this file except in compliance with the License.\n\n\n\n// A set of events. Each event starts with a u32 representing the event type, with 0 indicating the end. And\n// it is prefixed by a timestamp.\nclass ZerdeEventloopEvents {\n    constructor(wasmApp) {\n        this._wasmApp = wasmApp;\n        this._zerdeBuilder = (0,_common__WEBPACK_IMPORTED_MODULE_0__.makeZerdeBuilder)(wasmApp.memory, wasmApp.exports);\n        this._zerdeBuilder.sendF64(0); // Fit an f64 for the timestamp of when we send the message.\n    }\n    getWasmApp() {\n        return this._wasmApp;\n    }\n    fetchDeps() {\n        let port;\n        if (!location.port) {\n            if (location.protocol == \"https:\") {\n                port = 443;\n            }\n            else {\n                port = 80;\n            }\n        }\n        else {\n            port = parseInt(location.port);\n        }\n        this._zerdeBuilder.sendU32(1);\n        this._zerdeBuilder.sendU32(port);\n        this._zerdeBuilder.sendString(location.protocol);\n        this._zerdeBuilder.sendString(location.hostname);\n        this._zerdeBuilder.sendString(location.pathname);\n        this._zerdeBuilder.sendString(location.search);\n        this._zerdeBuilder.sendString(location.hash);\n    }\n    createWasmBuffer(data) {\n        return (0,_common__WEBPACK_IMPORTED_MODULE_0__.createWasmBuffer)(this._wasmApp.memory, this._wasmApp.exports, data);\n    }\n    createArcVec(vecPtr, data) {\n        return Number(this._wasmApp.exports.createArcVec(BigInt(vecPtr), BigInt(data.length), BigInt((0,_common__WEBPACK_IMPORTED_MODULE_0__.getWrfParamType)(data, true))));\n    }\n    depsLoaded(deps) {\n        this._zerdeBuilder.sendU32(2);\n        this._zerdeBuilder.sendU32(deps.length);\n        for (const dep of deps) {\n            this._zerdeBuilder.sendString(dep.name);\n            this._zerdeBuilder.sendU32(dep.vecPtr);\n            this._zerdeBuilder.sendU32(dep.vecLen);\n        }\n    }\n    init(info) {\n        this._zerdeBuilder.sendU32(3);\n        this._zerdeBuilder.sendF32(info.width);\n        this._zerdeBuilder.sendF32(info.height);\n        this._zerdeBuilder.sendF32(info.dpiFactor);\n        this._zerdeBuilder.sendU32(info.xrCanPresent ? 1 : 0);\n        this._zerdeBuilder.sendU32(info.canFullscreen ? 1 : 0);\n    }\n    resize(info) {\n        this._zerdeBuilder.sendU32(4);\n        this._zerdeBuilder.sendF32(info.width);\n        this._zerdeBuilder.sendF32(info.height);\n        this._zerdeBuilder.sendF32(info.dpiFactor);\n        this._zerdeBuilder.sendU32(info.xrIsPresenting ? 1 : 0);\n        this._zerdeBuilder.sendU32(info.xrCanPresent ? 1 : 0);\n        this._zerdeBuilder.sendU32(info.isFullscreen ? 1 : 0);\n    }\n    animationFrame() {\n        this._zerdeBuilder.sendU32(5);\n    }\n    fingerDown(finger) {\n        this._zerdeBuilder.sendU32(6);\n        this._zerdeBuilder.sendF32(finger.x);\n        this._zerdeBuilder.sendF32(finger.y);\n        this._zerdeBuilder.sendU32(finger.button);\n        this._zerdeBuilder.sendU32(finger.digit);\n        this._zerdeBuilder.sendU32(finger.touch ? 1 : 0);\n        this._zerdeBuilder.sendU32(finger.modifiers);\n        this._zerdeBuilder.sendF64(finger.time);\n    }\n    fingerUp(finger) {\n        this._zerdeBuilder.sendU32(7);\n        this._zerdeBuilder.sendF32(finger.x);\n        this._zerdeBuilder.sendF32(finger.y);\n        this._zerdeBuilder.sendU32(finger.button);\n        this._zerdeBuilder.sendU32(finger.digit);\n        this._zerdeBuilder.sendU32(finger.touch ? 1 : 0);\n        this._zerdeBuilder.sendU32(finger.modifiers);\n        this._zerdeBuilder.sendF64(finger.time);\n    }\n    fingerMove(finger) {\n        this._zerdeBuilder.sendU32(8);\n        this._zerdeBuilder.sendF32(finger.x);\n        this._zerdeBuilder.sendF32(finger.y);\n        this._zerdeBuilder.sendU32(finger.digit);\n        this._zerdeBuilder.sendU32(finger.touch ? 1 : 0);\n        this._zerdeBuilder.sendU32(finger.modifiers);\n        this._zerdeBuilder.sendF64(finger.time);\n    }\n    fingerHover(finger) {\n        this._zerdeBuilder.sendU32(9);\n        this._zerdeBuilder.sendF32(finger.x);\n        this._zerdeBuilder.sendF32(finger.y);\n        this._zerdeBuilder.sendU32(finger.modifiers);\n        this._zerdeBuilder.sendF64(finger.time);\n    }\n    fingerScroll(finger) {\n        this._zerdeBuilder.sendU32(10);\n        this._zerdeBuilder.sendF32(finger.x);\n        this._zerdeBuilder.sendF32(finger.y);\n        this._zerdeBuilder.sendF32(finger.scrollX);\n        this._zerdeBuilder.sendF32(finger.scrollY);\n        this._zerdeBuilder.sendU32(finger.isWheel ? 1 : 0);\n        this._zerdeBuilder.sendU32(finger.modifiers);\n        this._zerdeBuilder.sendF64(finger.time);\n    }\n    fingerOut(finger) {\n        this._zerdeBuilder.sendU32(11);\n        this._zerdeBuilder.sendF32(finger.x);\n        this._zerdeBuilder.sendF32(finger.y);\n        this._zerdeBuilder.sendU32(finger.modifiers);\n        this._zerdeBuilder.sendF64(finger.time);\n    }\n    keyDown(data) {\n        _zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_2__.zerdeKeyboardHandlers.keyDown(this._zerdeBuilder, data);\n    }\n    keyUp(data) {\n        _zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_2__.zerdeKeyboardHandlers.keyUp(this._zerdeBuilder, data);\n    }\n    textInput(data) {\n        _zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_2__.zerdeKeyboardHandlers.textInput(this._zerdeBuilder, data);\n    }\n    textCopy() {\n        _zerde_keyboard_handlers__WEBPACK_IMPORTED_MODULE_2__.zerdeKeyboardHandlers.textCopy(this._zerdeBuilder);\n    }\n    timerFired(id) {\n        this._zerdeBuilder.sendU32(18);\n        this._zerdeBuilder.sendF64(id);\n    }\n    windowFocus(isFocus) {\n        // TODO CALL THIS\n        this._zerdeBuilder.sendU32(19);\n        this._zerdeBuilder.sendU32(isFocus ? 1 : 0);\n    }\n    xrUpdateHead(_inputsLen, _time) {\n        //this._zerde_builder.send_f64(time);\n    }\n    xrUpdateInputs(_xrFrame, _xrSessions, _time, _xrPose, _xrReferenceSpace) {\n        // send_pose_transform(pose_transform) {\n        //     let pos = this._fit(7)\n        //     let inv_orient = pose_transform.inverse.orientation;\n        //     this._f32[pos++] = inv_orient.x;\n        //     this._f32[pos++] = inv_orient.y;\n        //     this._f32[pos++] = inv_orient.z;\n        //     this._f32[pos++] = inv_orient.w;\n        //     let tpos = pose_transform.position;\n        //     this._f32[pos++] = tpos.x;\n        //     this._f32[pos++] = tpos.y;\n        //     this._f32[pos++] = tpos.z;\n        // }\n        // let input_len = xr_session.inputSources.length;\n        // let pos = this.fit(2);\n        // this.mu32[pos ++] = 20;\n        // this.mu32[pos ++] = input_len;\n        // this._zerde_builder.send_f64(time / 1000.0);\n        // this.send_pose_transform(xr_pose.transform);\n        // for (let i = 0; i < input_len; i ++) {\n        //     let input = xr_session.inputSources[i];\n        //     let grip_pose = xr_frame.getPose(input.gripSpace, xr_reference_space);\n        //     let ray_pose = xr_frame.getPose(input.targetRaySpace, xr_reference_space);\n        //     if (grip_pose == null || ray_pose == null) {\n        //         let pos = this.fit(1);\n        //         this.mu32[pos ++] = 0;\n        //         continue\n        //     }\n        //     let pos = this.fit(1);\n        //     this.mu32[pos ++] = 1;\n        //     this.send_pose_transform(grip_pose.transform)\n        //     this.send_pose_transform(ray_pose.transform)\n        //     let buttons = input.gamepad.buttons;\n        //     let axes = input.gamepad.axes;\n        //     let buttons_len = buttons.length;\n        //     let axes_len = axes.length;\n        //     pos = this.fit(3 + buttons_len * 2 + axes_len);\n        //     this.mu32[pos ++] = input.handedness == \"left\"? 1: input.handedness == \"right\"? 2: 0;\n        //     this.mu32[pos ++] = buttons_len;\n        //     for (let i = 0; i < buttons_len; i ++) {\n        //         this.mu32[pos ++] = buttons[i].pressed? 1: 0;\n        //         this.mf32[pos ++] = buttons[i].value;\n        //     }\n        //     this.mu32[pos ++] = axes_len;\n        //     for (let i = 0; i < axes_len; i ++) {\n        //         this.mf32[pos ++] = axes[i]\n        //     }\n        // }\n    }\n    paintDirty(_time, _frameData) {\n        this._zerdeBuilder.sendU32(21);\n    }\n    httpSendResponse(signalId, success) {\n        this._zerdeBuilder.sendU32(22);\n        this._zerdeBuilder.sendU32(signalId);\n        this._zerdeBuilder.sendU32(success);\n    }\n    sendEventFromAnyThread(eventPtr) {\n        this._zerdeBuilder.sendU32(26);\n        this._zerdeBuilder.sendU64(eventPtr);\n    }\n    websocketMessage(url, data) {\n        const vecLen = data.byteLength;\n        const vecPtr = this.createWasmBuffer(new Uint8Array(data));\n        this._zerdeBuilder.sendU32(23);\n        this._zerdeBuilder.sendU32(vecPtr);\n        this._zerdeBuilder.sendU32(vecLen);\n        this._zerdeBuilder.sendString(url);\n    }\n    websocketError(url, error) {\n        this._zerdeBuilder.sendU32(24);\n        this._zerdeBuilder.sendString(url);\n        this._zerdeBuilder.sendString(error);\n    }\n    appOpenFiles(fileHandles) {\n        this._zerdeBuilder.sendU32(25);\n        this._zerdeBuilder.sendU32(fileHandles.length);\n        for (const fileHandle of fileHandles) {\n            this._zerdeBuilder.sendU32(fileHandle.id);\n            this._zerdeBuilder.sendU64(BigInt(fileHandle.file.size));\n            this._zerdeBuilder.sendString(fileHandle.basename);\n        }\n    }\n    dragenter() {\n        this._zerdeBuilder.sendU32(27);\n    }\n    dragleave() {\n        this._zerdeBuilder.sendU32(28);\n    }\n    dragover(x, y) {\n        this._zerdeBuilder.sendU32(29);\n        this._zerdeBuilder.sendU32(x);\n        this._zerdeBuilder.sendU32(y);\n    }\n    callRust(name, params, callbackId) {\n        this._zerdeBuilder.sendU32(30);\n        this._zerdeBuilder.sendString(name);\n        this._zerdeBuilder.sendU32(params.length);\n        for (const param of params) {\n            if (typeof param === \"string\") {\n                this._zerdeBuilder.sendU32(_types__WEBPACK_IMPORTED_MODULE_1__.WrfParamType.String);\n                this._zerdeBuilder.sendString(param);\n            }\n            else {\n                if (\"bufferData\" in param) {\n                    this._zerdeBuilder.sendU32(param.bufferData.paramType);\n                    if (param.bufferData.readonly) {\n                        this._zerdeBuilder.sendU32(param.bufferData.arcPtr);\n                    }\n                    else {\n                        this._zerdeBuilder.sendU32(param.bufferData.bufferPtr);\n                        this._zerdeBuilder.sendU32(param.bufferData.bufferLen);\n                        this._zerdeBuilder.sendU32(param.bufferData.bufferCap);\n                    }\n                }\n                else {\n                    const vecLen = param.byteLength;\n                    const vecPtr = this.createWasmBuffer(param);\n                    this._zerdeBuilder.sendU32((0,_common__WEBPACK_IMPORTED_MODULE_0__.getWrfParamType)(param, false));\n                    this._zerdeBuilder.sendU32(vecPtr);\n                    this._zerdeBuilder.sendU32(vecLen);\n                    this._zerdeBuilder.sendU32(vecLen);\n                }\n            }\n        }\n        this._zerdeBuilder.sendU32(callbackId);\n    }\n    end() {\n        this._zerdeBuilder.sendU32(0);\n        const { buffer, byteOffset } = this._zerdeBuilder.getData();\n        // Fill in the current timestamp that we reserved space for at the beginning.\n        new Float64Array(buffer, byteOffset, 2)[1] = performance.now() / 1000.0;\n        return byteOffset;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi96ZXJkZV9ldmVudGxvb3BfZXZlbnRzLnRzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd3JmLy4vemVyZGVfZXZlbnRsb29wX2V2ZW50cy50cz85NWU4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAyMS1wcmVzZW50LCBDcnVpc2UgTExDXG4vL1xuLy8gVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLFxuLy8gZm91bmQgaW4gdGhlIExJQ0VOU0UtQVBBQ0hFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4vLyBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5pbXBvcnQgeyBjcmVhdGVXYXNtQnVmZmVyLCBnZXRXcmZQYXJhbVR5cGUsIG1ha2VaZXJkZUJ1aWxkZXIgfSBmcm9tIFwiLi9jb21tb25cIjtcbmltcG9ydCB7IFdyZlBhcmFtVHlwZSwgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgemVyZGVLZXlib2FyZEhhbmRsZXJzIH0gZnJvbSBcIi4vemVyZGVfa2V5Ym9hcmRfaGFuZGxlcnNcIjtcbi8vIEEgc2V0IG9mIGV2ZW50cy4gRWFjaCBldmVudCBzdGFydHMgd2l0aCBhIHUzMiByZXByZXNlbnRpbmcgdGhlIGV2ZW50IHR5cGUsIHdpdGggMCBpbmRpY2F0aW5nIHRoZSBlbmQuIEFuZFxuLy8gaXQgaXMgcHJlZml4ZWQgYnkgYSB0aW1lc3RhbXAuXG5leHBvcnQgY2xhc3MgWmVyZGVFdmVudGxvb3BFdmVudHMge1xuICAgIGNvbnN0cnVjdG9yKHdhc21BcHApIHtcbiAgICAgICAgdGhpcy5fd2FzbUFwcCA9IHdhc21BcHA7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlciA9IG1ha2VaZXJkZUJ1aWxkZXIod2FzbUFwcC5tZW1vcnksIHdhc21BcHAuZXhwb3J0cyk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjY0KDApOyAvLyBGaXQgYW4gZjY0IGZvciB0aGUgdGltZXN0YW1wIG9mIHdoZW4gd2Ugc2VuZCB0aGUgbWVzc2FnZS5cbiAgICB9XG4gICAgZ2V0V2FzbUFwcCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dhc21BcHA7XG4gICAgfVxuICAgIGZldGNoRGVwcygpIHtcbiAgICAgICAgbGV0IHBvcnQ7XG4gICAgICAgIGlmICghbG9jYXRpb24ucG9ydCkge1xuICAgICAgICAgICAgaWYgKGxvY2F0aW9uLnByb3RvY29sID09IFwiaHR0cHM6XCIpIHtcbiAgICAgICAgICAgICAgICBwb3J0ID0gNDQzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcG9ydCA9IDgwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcG9ydCA9IHBhcnNlSW50KGxvY2F0aW9uLnBvcnQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKDEpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihwb3J0KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRTdHJpbmcobG9jYXRpb24ucHJvdG9jb2wpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFN0cmluZyhsb2NhdGlvbi5ob3N0bmFtZSk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kU3RyaW5nKGxvY2F0aW9uLnBhdGhuYW1lKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRTdHJpbmcobG9jYXRpb24uc2VhcmNoKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRTdHJpbmcobG9jYXRpb24uaGFzaCk7XG4gICAgfVxuICAgIGNyZWF0ZVdhc21CdWZmZXIoZGF0YSkge1xuICAgICAgICByZXR1cm4gY3JlYXRlV2FzbUJ1ZmZlcih0aGlzLl93YXNtQXBwLm1lbW9yeSwgdGhpcy5fd2FzbUFwcC5leHBvcnRzLCBkYXRhKTtcbiAgICB9XG4gICAgY3JlYXRlQXJjVmVjKHZlY1B0ciwgZGF0YSkge1xuICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuX3dhc21BcHAuZXhwb3J0cy5jcmVhdGVBcmNWZWMoQmlnSW50KHZlY1B0ciksIEJpZ0ludChkYXRhLmxlbmd0aCksIEJpZ0ludChnZXRXcmZQYXJhbVR5cGUoZGF0YSwgdHJ1ZSkpKSk7XG4gICAgfVxuICAgIGRlcHNMb2FkZWQoZGVwcykge1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMigyKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoZGVwcy5sZW5ndGgpO1xuICAgICAgICBmb3IgKGNvbnN0IGRlcCBvZiBkZXBzKSB7XG4gICAgICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFN0cmluZyhkZXAubmFtZSk7XG4gICAgICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihkZXAudmVjUHRyKTtcbiAgICAgICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKGRlcC52ZWNMZW4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGluaXQoaW5mbykge1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMigzKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGMzIoaW5mby53aWR0aCk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjMyKGluZm8uaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGMzIoaW5mby5kcGlGYWN0b3IpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihpbmZvLnhyQ2FuUHJlc2VudCA/IDEgOiAwKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoaW5mby5jYW5GdWxsc2NyZWVuID8gMSA6IDApO1xuICAgIH1cbiAgICByZXNpemUoaW5mbykge1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMig0KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGMzIoaW5mby53aWR0aCk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjMyKGluZm8uaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGMzIoaW5mby5kcGlGYWN0b3IpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihpbmZvLnhySXNQcmVzZW50aW5nID8gMSA6IDApO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihpbmZvLnhyQ2FuUHJlc2VudCA/IDEgOiAwKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoaW5mby5pc0Z1bGxzY3JlZW4gPyAxIDogMCk7XG4gICAgfVxuICAgIGFuaW1hdGlvbkZyYW1lKCkge1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMig1KTtcbiAgICB9XG4gICAgZmluZ2VyRG93bihmaW5nZXIpIHtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoNik7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjMyKGZpbmdlci54KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGMzIoZmluZ2VyLnkpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihmaW5nZXIuYnV0dG9uKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoZmluZ2VyLmRpZ2l0KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoZmluZ2VyLnRvdWNoID8gMSA6IDApO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihmaW5nZXIubW9kaWZpZXJzKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGNjQoZmluZ2VyLnRpbWUpO1xuICAgIH1cbiAgICBmaW5nZXJVcChmaW5nZXIpIHtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoNyk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjMyKGZpbmdlci54KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGMzIoZmluZ2VyLnkpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihmaW5nZXIuYnV0dG9uKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoZmluZ2VyLmRpZ2l0KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoZmluZ2VyLnRvdWNoID8gMSA6IDApO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihmaW5nZXIubW9kaWZpZXJzKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGNjQoZmluZ2VyLnRpbWUpO1xuICAgIH1cbiAgICBmaW5nZXJNb3ZlKGZpbmdlcikge1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMig4KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGMzIoZmluZ2VyLngpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZEYzMihmaW5nZXIueSk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKGZpbmdlci5kaWdpdCk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKGZpbmdlci50b3VjaCA/IDEgOiAwKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoZmluZ2VyLm1vZGlmaWVycyk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjY0KGZpbmdlci50aW1lKTtcbiAgICB9XG4gICAgZmluZ2VySG92ZXIoZmluZ2VyKSB7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKDkpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZEYzMihmaW5nZXIueCk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjMyKGZpbmdlci55KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoZmluZ2VyLm1vZGlmaWVycyk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjY0KGZpbmdlci50aW1lKTtcbiAgICB9XG4gICAgZmluZ2VyU2Nyb2xsKGZpbmdlcikge1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMigxMCk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjMyKGZpbmdlci54KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGMzIoZmluZ2VyLnkpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZEYzMihmaW5nZXIuc2Nyb2xsWCk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjMyKGZpbmdlci5zY3JvbGxZKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoZmluZ2VyLmlzV2hlZWwgPyAxIDogMCk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKGZpbmdlci5tb2RpZmllcnMpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZEY2NChmaW5nZXIudGltZSk7XG4gICAgfVxuICAgIGZpbmdlck91dChmaW5nZXIpIHtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoMTEpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZEYzMihmaW5nZXIueCk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjMyKGZpbmdlci55KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoZmluZ2VyLm1vZGlmaWVycyk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kRjY0KGZpbmdlci50aW1lKTtcbiAgICB9XG4gICAga2V5RG93bihkYXRhKSB7XG4gICAgICAgIHplcmRlS2V5Ym9hcmRIYW5kbGVycy5rZXlEb3duKHRoaXMuX3plcmRlQnVpbGRlciwgZGF0YSk7XG4gICAgfVxuICAgIGtleVVwKGRhdGEpIHtcbiAgICAgICAgemVyZGVLZXlib2FyZEhhbmRsZXJzLmtleVVwKHRoaXMuX3plcmRlQnVpbGRlciwgZGF0YSk7XG4gICAgfVxuICAgIHRleHRJbnB1dChkYXRhKSB7XG4gICAgICAgIHplcmRlS2V5Ym9hcmRIYW5kbGVycy50ZXh0SW5wdXQodGhpcy5femVyZGVCdWlsZGVyLCBkYXRhKTtcbiAgICB9XG4gICAgdGV4dENvcHkoKSB7XG4gICAgICAgIHplcmRlS2V5Ym9hcmRIYW5kbGVycy50ZXh0Q29weSh0aGlzLl96ZXJkZUJ1aWxkZXIpO1xuICAgIH1cbiAgICB0aW1lckZpcmVkKGlkKSB7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKDE4KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRGNjQoaWQpO1xuICAgIH1cbiAgICB3aW5kb3dGb2N1cyhpc0ZvY3VzKSB7XG4gICAgICAgIC8vIFRPRE8gQ0FMTCBUSElTXG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKDE5KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoaXNGb2N1cyA/IDEgOiAwKTtcbiAgICB9XG4gICAgeHJVcGRhdGVIZWFkKF9pbnB1dHNMZW4sIF90aW1lKSB7XG4gICAgICAgIC8vdGhpcy5femVyZGVfYnVpbGRlci5zZW5kX2Y2NCh0aW1lKTtcbiAgICB9XG4gICAgeHJVcGRhdGVJbnB1dHMoX3hyRnJhbWUsIF94clNlc3Npb25zLCBfdGltZSwgX3hyUG9zZSwgX3hyUmVmZXJlbmNlU3BhY2UpIHtcbiAgICAgICAgLy8gc2VuZF9wb3NlX3RyYW5zZm9ybShwb3NlX3RyYW5zZm9ybSkge1xuICAgICAgICAvLyAgICAgbGV0IHBvcyA9IHRoaXMuX2ZpdCg3KVxuICAgICAgICAvLyAgICAgbGV0IGludl9vcmllbnQgPSBwb3NlX3RyYW5zZm9ybS5pbnZlcnNlLm9yaWVudGF0aW9uO1xuICAgICAgICAvLyAgICAgdGhpcy5fZjMyW3BvcysrXSA9IGludl9vcmllbnQueDtcbiAgICAgICAgLy8gICAgIHRoaXMuX2YzMltwb3MrK10gPSBpbnZfb3JpZW50Lnk7XG4gICAgICAgIC8vICAgICB0aGlzLl9mMzJbcG9zKytdID0gaW52X29yaWVudC56O1xuICAgICAgICAvLyAgICAgdGhpcy5fZjMyW3BvcysrXSA9IGludl9vcmllbnQudztcbiAgICAgICAgLy8gICAgIGxldCB0cG9zID0gcG9zZV90cmFuc2Zvcm0ucG9zaXRpb247XG4gICAgICAgIC8vICAgICB0aGlzLl9mMzJbcG9zKytdID0gdHBvcy54O1xuICAgICAgICAvLyAgICAgdGhpcy5fZjMyW3BvcysrXSA9IHRwb3MueTtcbiAgICAgICAgLy8gICAgIHRoaXMuX2YzMltwb3MrK10gPSB0cG9zLno7XG4gICAgICAgIC8vIH1cbiAgICAgICAgLy8gbGV0IGlucHV0X2xlbiA9IHhyX3Nlc3Npb24uaW5wdXRTb3VyY2VzLmxlbmd0aDtcbiAgICAgICAgLy8gbGV0IHBvcyA9IHRoaXMuZml0KDIpO1xuICAgICAgICAvLyB0aGlzLm11MzJbcG9zICsrXSA9IDIwO1xuICAgICAgICAvLyB0aGlzLm11MzJbcG9zICsrXSA9IGlucHV0X2xlbjtcbiAgICAgICAgLy8gdGhpcy5femVyZGVfYnVpbGRlci5zZW5kX2Y2NCh0aW1lIC8gMTAwMC4wKTtcbiAgICAgICAgLy8gdGhpcy5zZW5kX3Bvc2VfdHJhbnNmb3JtKHhyX3Bvc2UudHJhbnNmb3JtKTtcbiAgICAgICAgLy8gZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dF9sZW47IGkgKyspIHtcbiAgICAgICAgLy8gICAgIGxldCBpbnB1dCA9IHhyX3Nlc3Npb24uaW5wdXRTb3VyY2VzW2ldO1xuICAgICAgICAvLyAgICAgbGV0IGdyaXBfcG9zZSA9IHhyX2ZyYW1lLmdldFBvc2UoaW5wdXQuZ3JpcFNwYWNlLCB4cl9yZWZlcmVuY2Vfc3BhY2UpO1xuICAgICAgICAvLyAgICAgbGV0IHJheV9wb3NlID0geHJfZnJhbWUuZ2V0UG9zZShpbnB1dC50YXJnZXRSYXlTcGFjZSwgeHJfcmVmZXJlbmNlX3NwYWNlKTtcbiAgICAgICAgLy8gICAgIGlmIChncmlwX3Bvc2UgPT0gbnVsbCB8fCByYXlfcG9zZSA9PSBudWxsKSB7XG4gICAgICAgIC8vICAgICAgICAgbGV0IHBvcyA9IHRoaXMuZml0KDEpO1xuICAgICAgICAvLyAgICAgICAgIHRoaXMubXUzMltwb3MgKytdID0gMDtcbiAgICAgICAgLy8gICAgICAgICBjb250aW51ZVxuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyAgICAgbGV0IHBvcyA9IHRoaXMuZml0KDEpO1xuICAgICAgICAvLyAgICAgdGhpcy5tdTMyW3BvcyArK10gPSAxO1xuICAgICAgICAvLyAgICAgdGhpcy5zZW5kX3Bvc2VfdHJhbnNmb3JtKGdyaXBfcG9zZS50cmFuc2Zvcm0pXG4gICAgICAgIC8vICAgICB0aGlzLnNlbmRfcG9zZV90cmFuc2Zvcm0ocmF5X3Bvc2UudHJhbnNmb3JtKVxuICAgICAgICAvLyAgICAgbGV0IGJ1dHRvbnMgPSBpbnB1dC5nYW1lcGFkLmJ1dHRvbnM7XG4gICAgICAgIC8vICAgICBsZXQgYXhlcyA9IGlucHV0LmdhbWVwYWQuYXhlcztcbiAgICAgICAgLy8gICAgIGxldCBidXR0b25zX2xlbiA9IGJ1dHRvbnMubGVuZ3RoO1xuICAgICAgICAvLyAgICAgbGV0IGF4ZXNfbGVuID0gYXhlcy5sZW5ndGg7XG4gICAgICAgIC8vICAgICBwb3MgPSB0aGlzLmZpdCgzICsgYnV0dG9uc19sZW4gKiAyICsgYXhlc19sZW4pO1xuICAgICAgICAvLyAgICAgdGhpcy5tdTMyW3BvcyArK10gPSBpbnB1dC5oYW5kZWRuZXNzID09IFwibGVmdFwiPyAxOiBpbnB1dC5oYW5kZWRuZXNzID09IFwicmlnaHRcIj8gMjogMDtcbiAgICAgICAgLy8gICAgIHRoaXMubXUzMltwb3MgKytdID0gYnV0dG9uc19sZW47XG4gICAgICAgIC8vICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1dHRvbnNfbGVuOyBpICsrKSB7XG4gICAgICAgIC8vICAgICAgICAgdGhpcy5tdTMyW3BvcyArK10gPSBidXR0b25zW2ldLnByZXNzZWQ/IDE6IDA7XG4gICAgICAgIC8vICAgICAgICAgdGhpcy5tZjMyW3BvcyArK10gPSBidXR0b25zW2ldLnZhbHVlO1xuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyAgICAgdGhpcy5tdTMyW3BvcyArK10gPSBheGVzX2xlbjtcbiAgICAgICAgLy8gICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhlc19sZW47IGkgKyspIHtcbiAgICAgICAgLy8gICAgICAgICB0aGlzLm1mMzJbcG9zICsrXSA9IGF4ZXNbaV1cbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfVxuICAgIH1cbiAgICBwYWludERpcnR5KF90aW1lLCBfZnJhbWVEYXRhKSB7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKDIxKTtcbiAgICB9XG4gICAgaHR0cFNlbmRSZXNwb25zZShzaWduYWxJZCwgc3VjY2Vzcykge1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMigyMik7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKHNpZ25hbElkKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoc3VjY2Vzcyk7XG4gICAgfVxuICAgIHNlbmRFdmVudEZyb21BbnlUaHJlYWQoZXZlbnRQdHIpIHtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoMjYpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFU2NChldmVudFB0cik7XG4gICAgfVxuICAgIHdlYnNvY2tldE1lc3NhZ2UodXJsLCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IHZlY0xlbiA9IGRhdGEuYnl0ZUxlbmd0aDtcbiAgICAgICAgY29uc3QgdmVjUHRyID0gdGhpcy5jcmVhdGVXYXNtQnVmZmVyKG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoMjMpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMih2ZWNQdHIpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMih2ZWNMZW4pO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFN0cmluZyh1cmwpO1xuICAgIH1cbiAgICB3ZWJzb2NrZXRFcnJvcih1cmwsIGVycm9yKSB7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKDI0KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRTdHJpbmcodXJsKTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRTdHJpbmcoZXJyb3IpO1xuICAgIH1cbiAgICBhcHBPcGVuRmlsZXMoZmlsZUhhbmRsZXMpIHtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoMjUpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihmaWxlSGFuZGxlcy5sZW5ndGgpO1xuICAgICAgICBmb3IgKGNvbnN0IGZpbGVIYW5kbGUgb2YgZmlsZUhhbmRsZXMpIHtcbiAgICAgICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKGZpbGVIYW5kbGUuaWQpO1xuICAgICAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVNjQoQmlnSW50KGZpbGVIYW5kbGUuZmlsZS5zaXplKSk7XG4gICAgICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFN0cmluZyhmaWxlSGFuZGxlLmJhc2VuYW1lKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkcmFnZW50ZXIoKSB7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKDI3KTtcbiAgICB9XG4gICAgZHJhZ2xlYXZlKCkge1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMigyOCk7XG4gICAgfVxuICAgIGRyYWdvdmVyKHgsIHkpIHtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoMjkpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMih4KTtcbiAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIoeSk7XG4gICAgfVxuICAgIGNhbGxSdXN0KG5hbWUsIHBhcmFtcywgY2FsbGJhY2tJZCkge1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMigzMCk7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kU3RyaW5nKG5hbWUpO1xuICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihwYXJhbXMubGVuZ3RoKTtcbiAgICAgICAgZm9yIChjb25zdCBwYXJhbSBvZiBwYXJhbXMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcGFyYW0gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihXcmZQYXJhbVR5cGUuU3RyaW5nKTtcbiAgICAgICAgICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFN0cmluZyhwYXJhbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoXCJidWZmZXJEYXRhXCIgaW4gcGFyYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIocGFyYW0uYnVmZmVyRGF0YS5wYXJhbVR5cGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW0uYnVmZmVyRGF0YS5yZWFkb25seSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIocGFyYW0uYnVmZmVyRGF0YS5hcmNQdHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIocGFyYW0uYnVmZmVyRGF0YS5idWZmZXJQdHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIocGFyYW0uYnVmZmVyRGF0YS5idWZmZXJMZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5femVyZGVCdWlsZGVyLnNlbmRVMzIocGFyYW0uYnVmZmVyRGF0YS5idWZmZXJDYXApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2ZWNMZW4gPSBwYXJhbS5ieXRlTGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2ZWNQdHIgPSB0aGlzLmNyZWF0ZVdhc21CdWZmZXIocGFyYW0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl96ZXJkZUJ1aWxkZXIuc2VuZFUzMihnZXRXcmZQYXJhbVR5cGUocGFyYW0sIGZhbHNlKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKHZlY1B0cik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKHZlY0xlbik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKHZlY0xlbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKGNhbGxiYWNrSWQpO1xuICAgIH1cbiAgICBlbmQoKSB7XG4gICAgICAgIHRoaXMuX3plcmRlQnVpbGRlci5zZW5kVTMyKDApO1xuICAgICAgICBjb25zdCB7IGJ1ZmZlciwgYnl0ZU9mZnNldCB9ID0gdGhpcy5femVyZGVCdWlsZGVyLmdldERhdGEoKTtcbiAgICAgICAgLy8gRmlsbCBpbiB0aGUgY3VycmVudCB0aW1lc3RhbXAgdGhhdCB3ZSByZXNlcnZlZCBzcGFjZSBmb3IgYXQgdGhlIGJlZ2lubmluZy5cbiAgICAgICAgbmV3IEZsb2F0NjRBcnJheShidWZmZXIsIGJ5dGVPZmZzZXQsIDIpWzFdID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwLjA7XG4gICAgICAgIHJldHVybiBieXRlT2Zmc2V0O1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./zerde_eventloop_events.ts\n");

/***/ }),

/***/ "./zerde_keyboard_handlers.ts":
/*!************************************!*\
  !*** ./zerde_keyboard_handlers.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"packKeyModifier\": () => (/* binding */ packKeyModifier),\n/* harmony export */   \"zerdeKeyboardHandlers\": () => (/* binding */ zerdeKeyboardHandlers)\n/* harmony export */ });\n// Copyright (c) 2021-present, Cruise LLC\n//\n// This source code is licensed under the Apache License, Version 2.0,\n// found in the LICENSE-APACHE file in the root directory of this source tree.\n// You may not use this file except in compliance with the License.\nfunction packKeyModifier(e) {\n    return ((e.shiftKey ? 1 : 0) |\n        (e.ctrlKey ? 2 : 0) |\n        (e.altKey ? 4 : 0) |\n        (e.metaKey ? 8 : 0));\n}\nconst zerdeKeyboardHandlers = {\n    keyDown(zerdeBuilder, data) {\n        zerdeBuilder.sendU32(12);\n        zerdeBuilder.sendU32(data.event.keyCode);\n        zerdeBuilder.sendU32(data.event.repeat ? 1 : 0);\n        zerdeBuilder.sendU32(packKeyModifier(data.event));\n        zerdeBuilder.sendF64(performance.now() / 1000.0);\n    },\n    keyUp(zerdeBuilder, data) {\n        zerdeBuilder.sendU32(13);\n        zerdeBuilder.sendU32(data.event.keyCode);\n        zerdeBuilder.sendU32(data.event.repeat ? 1 : 0);\n        zerdeBuilder.sendU32(packKeyModifier(data.event));\n        zerdeBuilder.sendF64(performance.now() / 1000.0);\n    },\n    textInput(zerdeBuilder, data) {\n        zerdeBuilder.sendU32(14);\n        zerdeBuilder.sendU32(data.wasPaste ? 1 : 0),\n            zerdeBuilder.sendU32(data.replaceLast ? 1 : 0),\n            zerdeBuilder.sendString(data.input);\n    },\n    textCopy(zerdeBuilder) {\n        zerdeBuilder.sendU32(17);\n    },\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi96ZXJkZV9rZXlib2FyZF9oYW5kbGVycy50cy5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL3dyZi8uL3plcmRlX2tleWJvYXJkX2hhbmRsZXJzLnRzPzk2NDQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDIxLXByZXNlbnQsIENydWlzZSBMTENcbi8vXG4vLyBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAsXG4vLyBmb3VuZCBpbiB0aGUgTElDRU5TRS1BUEFDSEUgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbi8vIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbmV4cG9ydCBmdW5jdGlvbiBwYWNrS2V5TW9kaWZpZXIoZSkge1xuICAgIHJldHVybiAoKGUuc2hpZnRLZXkgPyAxIDogMCkgfFxuICAgICAgICAoZS5jdHJsS2V5ID8gMiA6IDApIHxcbiAgICAgICAgKGUuYWx0S2V5ID8gNCA6IDApIHxcbiAgICAgICAgKGUubWV0YUtleSA/IDggOiAwKSk7XG59XG5leHBvcnQgY29uc3QgemVyZGVLZXlib2FyZEhhbmRsZXJzID0ge1xuICAgIGtleURvd24oemVyZGVCdWlsZGVyLCBkYXRhKSB7XG4gICAgICAgIHplcmRlQnVpbGRlci5zZW5kVTMyKDEyKTtcbiAgICAgICAgemVyZGVCdWlsZGVyLnNlbmRVMzIoZGF0YS5ldmVudC5rZXlDb2RlKTtcbiAgICAgICAgemVyZGVCdWlsZGVyLnNlbmRVMzIoZGF0YS5ldmVudC5yZXBlYXQgPyAxIDogMCk7XG4gICAgICAgIHplcmRlQnVpbGRlci5zZW5kVTMyKHBhY2tLZXlNb2RpZmllcihkYXRhLmV2ZW50KSk7XG4gICAgICAgIHplcmRlQnVpbGRlci5zZW5kRjY0KHBlcmZvcm1hbmNlLm5vdygpIC8gMTAwMC4wKTtcbiAgICB9LFxuICAgIGtleVVwKHplcmRlQnVpbGRlciwgZGF0YSkge1xuICAgICAgICB6ZXJkZUJ1aWxkZXIuc2VuZFUzMigxMyk7XG4gICAgICAgIHplcmRlQnVpbGRlci5zZW5kVTMyKGRhdGEuZXZlbnQua2V5Q29kZSk7XG4gICAgICAgIHplcmRlQnVpbGRlci5zZW5kVTMyKGRhdGEuZXZlbnQucmVwZWF0ID8gMSA6IDApO1xuICAgICAgICB6ZXJkZUJ1aWxkZXIuc2VuZFUzMihwYWNrS2V5TW9kaWZpZXIoZGF0YS5ldmVudCkpO1xuICAgICAgICB6ZXJkZUJ1aWxkZXIuc2VuZEY2NChwZXJmb3JtYW5jZS5ub3coKSAvIDEwMDAuMCk7XG4gICAgfSxcbiAgICB0ZXh0SW5wdXQoemVyZGVCdWlsZGVyLCBkYXRhKSB7XG4gICAgICAgIHplcmRlQnVpbGRlci5zZW5kVTMyKDE0KTtcbiAgICAgICAgemVyZGVCdWlsZGVyLnNlbmRVMzIoZGF0YS53YXNQYXN0ZSA/IDEgOiAwKSxcbiAgICAgICAgICAgIHplcmRlQnVpbGRlci5zZW5kVTMyKGRhdGEucmVwbGFjZUxhc3QgPyAxIDogMCksXG4gICAgICAgICAgICB6ZXJkZUJ1aWxkZXIuc2VuZFN0cmluZyhkYXRhLmlucHV0KTtcbiAgICB9LFxuICAgIHRleHRDb3B5KHplcmRlQnVpbGRlcikge1xuICAgICAgICB6ZXJkZUJ1aWxkZXIuc2VuZFUzMigxNyk7XG4gICAgfSxcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./zerde_keyboard_handlers.ts\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = __webpack_modules__;
/******/ 	
/******/ 	// the startup function
/******/ 	__webpack_require__.x = () => {
/******/ 		// Load entry module and return exports
/******/ 		// This entry module depends on other loaded chunks and execution need to be delayed
/******/ 		var __webpack_exports__ = __webpack_require__.O(undefined, ["rpc_types_ts-wrf_buffer_ts"], () => (__webpack_require__("./wrf_wasm_worker.ts")))
/******/ 		__webpack_exports__ = __webpack_require__.O(__webpack_exports__);
/******/ 		return __webpack_exports__;
/******/ 	};
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/chunk loaded */
/******/ 	(() => {
/******/ 		var deferred = [];
/******/ 		__webpack_require__.O = (result, chunkIds, fn, priority) => {
/******/ 			if(chunkIds) {
/******/ 				priority = priority || 0;
/******/ 				for(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];
/******/ 				deferred[i] = [chunkIds, fn, priority];
/******/ 				return;
/******/ 			}
/******/ 			var notFulfilled = Infinity;
/******/ 			for (var i = 0; i < deferred.length; i++) {
/******/ 				var [chunkIds, fn, priority] = deferred[i];
/******/ 				var fulfilled = true;
/******/ 				for (var j = 0; j < chunkIds.length; j++) {
/******/ 					if ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {
/******/ 						chunkIds.splice(j--, 1);
/******/ 					} else {
/******/ 						fulfilled = false;
/******/ 						if(priority < notFulfilled) notFulfilled = priority;
/******/ 					}
/******/ 				}
/******/ 				if(fulfilled) {
/******/ 					deferred.splice(i--, 1)
/******/ 					var r = fn();
/******/ 					if (r !== undefined) result = r;
/******/ 				}
/******/ 			}
/******/ 			return result;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/ensure chunk */
/******/ 	(() => {
/******/ 		__webpack_require__.f = {};
/******/ 		// This file contains only the entry chunk.
/******/ 		// The chunk loading function for additional chunks
/******/ 		__webpack_require__.e = (chunkId) => {
/******/ 			return Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {
/******/ 				__webpack_require__.f[key](chunkId, promises);
/******/ 				return promises;
/******/ 			}, []));
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/get javascript chunk filename */
/******/ 	(() => {
/******/ 		// This function allow to reference async chunks and sibling chunks for the entrypoint
/******/ 		__webpack_require__.u = (chunkId) => {
/******/ 			// return url for filenames based on template
/******/ 			return "" + chunkId + ".js";
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/publicPath */
/******/ 	(() => {
/******/ 		var scriptUrl;
/******/ 		if (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + "";
/******/ 		var document = __webpack_require__.g.document;
/******/ 		if (!scriptUrl && document) {
/******/ 			if (document.currentScript)
/******/ 				scriptUrl = document.currentScript.src
/******/ 			if (!scriptUrl) {
/******/ 				var scripts = document.getElementsByTagName("script");
/******/ 				if(scripts.length) scriptUrl = scripts[scripts.length - 1].src
/******/ 			}
/******/ 		}
/******/ 		// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration
/******/ 		// or pass an empty string ("") and set the __webpack_public_path__ variable from your code to use your own logic.
/******/ 		if (!scriptUrl) throw new Error("Automatic publicPath is not supported in this browser");
/******/ 		scriptUrl = scriptUrl.replace(/#.*$/, "").replace(/\?.*$/, "").replace(/\/[^\/]+$/, "/");
/******/ 		__webpack_require__.p = scriptUrl;
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/importScripts chunk loading */
/******/ 	(() => {
/******/ 		// no baseURI
/******/ 		
/******/ 		// object to store loaded chunks
/******/ 		// "1" means "already loaded"
/******/ 		var installedChunks = {
/******/ 			"wrf_wasm_worker_ts": 1
/******/ 		};
/******/ 		
/******/ 		// importScripts chunk loading
/******/ 		var installChunk = (data) => {
/******/ 			var [chunkIds, moreModules, runtime] = data;
/******/ 			for(var moduleId in moreModules) {
/******/ 				if(__webpack_require__.o(moreModules, moduleId)) {
/******/ 					__webpack_require__.m[moduleId] = moreModules[moduleId];
/******/ 				}
/******/ 			}
/******/ 			if(runtime) runtime(__webpack_require__);
/******/ 			while(chunkIds.length)
/******/ 				installedChunks[chunkIds.pop()] = 1;
/******/ 			parentChunkLoadingFunction(data);
/******/ 		};
/******/ 		__webpack_require__.f.i = (chunkId, promises) => {
/******/ 			// "1" is the signal for "already loaded"
/******/ 			if(!installedChunks[chunkId]) {
/******/ 				if(true) { // all chunks have JS
/******/ 					importScripts(__webpack_require__.p + __webpack_require__.u(chunkId));
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 		
/******/ 		var chunkLoadingGlobal = self["webpackChunkwrf"] = self["webpackChunkwrf"] || [];
/******/ 		var parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);
/******/ 		chunkLoadingGlobal.push = installChunk;
/******/ 		
/******/ 		// no HMR
/******/ 		
/******/ 		// no HMR manifest
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/startup chunk dependencies */
/******/ 	(() => {
/******/ 		var next = __webpack_require__.x;
/******/ 		__webpack_require__.x = () => {
/******/ 			return __webpack_require__.e("rpc_types_ts-wrf_buffer_ts").then(next);
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// run startup
/******/ 	var __webpack_exports__ = __webpack_require__.x();
/******/ 	
/******/ 	return __webpack_exports__;
/******/ })()
;
});